!function(i,e,s,n){s.modules({"webengage/conversion":[function(i,e,n){"use strict";function t(i){function e(e,s){var t=s.notificationId||s.id;if(t&&i.nIds.join().indexOf(t)>=0){var o=v.getGoalsCookie()||{};switch(o[n]=o[n]||{},e){case"open":s.isNotificationClickable?(o[n].canids=o[n].canids||[],o[n].canids.join().indexOf(s.notificationId)<0&&o[n].canids.push(s.notificationId)):(o[n].snids=o[n].snids||[],o[n].snids.join().indexOf(s.notificationId)<0&&o[n].snids.push(s.notificationId)),v.setGoalsCookie(o);break;case"click":o[n].cnids=o[n].cnids||[],o[n].cnids.join().indexOf(s.notificationId)<0&&o[n].cnids.push(s.notificationId),v.setGoalsCookie(o);break;case"view":case"abs_view":var a="view"===e?"intc":"aintc";o[n][a]||(o[n][a]=1),"abs_view"===e&&(o[n].anids=o[n].anids||[],d.indexOfArray(o[n].anids,t)<0&&d.indexOfArray(o[n].anids,t+"#")<0&&o[n].anids.push(t)),v.setGoalsCookie(o)}}}var n=i.id;s.notification.onOpen(function(i){e("open",i)}),s.notification.onClick(function(i){e("click",i)}),r.subscribe("event.system",function(i,s,n){"notification_view"===i?e("view",{notificationId:n.id}):"notification_abs_view"===i&&e("abs_view",{notificationId:n.id})})}function o(i){function e(e,s){var t=s.surveyId||s.id;if(t&&i.sIds.join().indexOf(t)>=0){var o=v.getGoalsCookie()||{};switch(o[n]=o[n]||{},e){case"open":o[n].ssids=o[n].ssids||[],o[n].ssids.join().indexOf(t)<0&&o[n].ssids.push(t),v.setGoalsCookie(o);break;case"submit":case"complete":o[n].tsids=o[n].tsids||[],o[n].tsids.join().indexOf(t)<0&&o[n].tsids.push(t),v.setGoalsCookie(o),i.type&&"SURVEY_COMPLETION"===i.type&&"complete"===e&&v.logConversion(n);break;case"view":case"abs_view":var a="view"===e?"intc":"aintc";o[n][a]||(o[n][a]=1),"abs_view"===e&&(o[n].asids=o[n].asids||[],d.indexOfArray(o[n].asids,t)<0&&d.indexOfArray(o[n].asids,t+"#")<0&&o[n].asids.push(t)),v.setGoalsCookie(o)}}}var n=i.id;s.survey.onOpen(function(i){e("open",i)}),s.survey.onSubmit(function(i){e("submit",i)}),s.survey.onComplete(function(i){e("complete",i)}),r.subscribe("event.system",function(i,s,n){"survey_view"===i?e("view",{surveyId:n.id}):"survey_abs_view"===i&&e("abs_view",{surveyId:n.id})})}var a,d=s.require("webengage/util"),c=s.require("webengage/dom"),r=s.require("webengage/events"),l=s.require("webengage/rules"),g=s.require("webengage/state"),u=s.require("webengage/weq");a=location.host.match(/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/)?location.host:-1===location.host.indexOf(".")?location.host.split(":")[0]:location.host.split(":")[0].match(/[-\w]+(\.(?:[-\w]+\.xn--[-\w]+|[-\w]{3,}|[-\w]+\.[-\w]{2}))?$/i)[0];var f=null,v={setGoalsCookie:function(i){return i=i||{},c.cookie.setCookie("_we_wk_gls_ss_",d.compress.compressToBase64(d.stringify(i)),"","/",a,""),i},getGoalsCookie:function(){var i=d.getCookie("_we_wk_gls_ss_",!0)||null;return i&&("{"!==i.charAt(0)&&(i=d.compress.decompressFromBase64(i)),i=d.parseJSON(i)),i},findNonHashedIds:function(i,e){var s=[];if(i&&i[e]&&d.isArray(i[e]))for(var n=0;n<i[e].length;n++)i[e][n]&&i[e][n].indexOf("#")<0&&(s.push(i[e][n]),i[e][n]+="#");return s},getActiveIds:function(i,e){var s=[],n=g.getServerTimestamp()||null;if(i)for(var t=0;t<i.length;t++){var o=i[t].startTimestamp,a=i[t].endTimestamp;n&&(a&&n>a||o&&o>n)||s.push(i[t][e])}return s},getAllActiveNotifications:function(){return v.getActiveIds(f.notificationRuleList,"notificationEncId")},getAllActiveSurveys:function(){return v.getActiveIds(f.surveyRuleList,"surveyEncId")},idsToRetain:function h(i,e){var h=[],s=e?e.join():"";if(i&&s){for(var n=0;n<i.length;n++)s.indexOf(i[n])>=0&&h.push(i[n]);return h}},logConversion:function(i,e){if(i){var s=v.getGoalsCookie(),n={};if(s&&s[i]){var t=v.getAllActiveNotifications(),o=v.getAllActiveSurveys();if(t.length>0){var a=v.idsToRetain(d.isArray(s[i].snids)&&s[i].snids.length>0?s[i].snids:null,t),c=v.idsToRetain(d.isArray(s[i].cnids)&&s[i].cnids.length>0?s[i].cnids:null,t),l=v.idsToRetain(d.isArray(s[i].canids)&&s[i].canids.length>0?s[i].canids:null,t),g=v.idsToRetain(v.findNonHashedIds(s[i],"anids"),t);a&&a.length>0&&(n.snids=a),l&&l.length>0&&(n.ncnids=l),c&&c.length>0&&(n.cnids=c),g&&g.length>0&&(n.anids=g)}if(o.length>0){var f=v.idsToRetain(d.isArray(s[i].ssids)&&s[i].ssids.length>0?s[i].ssids:null,o),w=v.idsToRetain(d.isArray(s[i].tsids)&&s[i].tsids.length>0?s[i].tsids:null,o),h=v.idsToRetain(v.findNonHashedIds(s[i],"asids"),o);f&&f.length>0&&(n.ssids=f),w&&w.length>0&&(n.tsids=w),h&&h.length>0&&(n.asids=h)}}d.isEmptyObject(u.get("webengage.customData"))||d.copy(n,u.get("webengage.customData")||{}),d.isEmptyObject(u.get("webengage.notification.customData"))||d.copy(n,u.get("webengage.notification.customData")||{}),d.isEmptyObject(u.get("webengage.survey.customData"))||d.copy(n,u.get("webengage.survey.customData")||{}),d.isEmptyObject(e)||d.copy(n,e,!0),r.publish("event.system","goal_accomplish",n,{goal_id:i}),s&&s[i]&&(delete s[i].snids,delete s[i].cnids,delete s[i].canids,delete s[i].ssids,delete s[i].tsids,v.setGoalsCookie(s))}}},w={push:function(i,e){if(i&&f&&f.goals&&f.goals.length)for(var s,n=0;n<f.goals.length;n++)s=f.goals[n],s.id&&s.id===i&&v.logConversion(i,e)},init:function(i){i&&d.isArray(i.goals)&&i.goals.length>0&&(f=i,r.subscribe("event.system",function(i){"visitor_new_session"===i&&c.cookie.setCookie("_we_wk_gls_ss_","",-1,"/",a,"")}),s.onReady(function(){var i=g.getSession();1===i.pvc&&c.cookie.setCookie("_we_wk_gls_ss_","",-1,"/",a,"");for(var e=0;e<f.goals.length;e++){var s=f.goals[e],n=s.value,r=s.type;if(!r||"WEB_RULE"===r){var w=u.get("webengage.ruleData")||u.get("webengage.goals.ruleData")||{},h=l.execute("",n,w);h&&v.logConversion(s.id)}d.isArray(s.nIds)&&s.nIds.length>0&&t(s,f),d.isArray(s.sIds)&&s.sIds.length>0&&o(s,f)}}))}};e.exports=w},{}]},{},[])}(window,document,webengage);