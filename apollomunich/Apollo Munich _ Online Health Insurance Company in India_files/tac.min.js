var SecondScreenUtils=SecondScreenUtils||{};var _taq=_taq||{};(function(){var a=function(b){this.serverUrl=b;this.server=false;this.serverFrame=false;this._id=0;this.callbacks=[];this.queue=[];this.init()};a.prototype={constructor:a,init:function(){if(this.server||this.serverFrame){return}this.serverFrame=window.document.createElement("iframe");this.serverFrame.style.position="absolute";this.serverFrame.style.left=this.serverFrame.style.top="-999px";var b=this;if(window.addEventListener){window.addEventListener("message",function(c){b.onMessage(c)},false)}else{window.attachEvent("onmessage",function(c){b.onMessage(c)})}window.document.body.appendChild(this.serverFrame);this.serverFrame.src=this.serverUrl},onMessage:function(c){var b;try{b=JSON.parse(c.data)}catch(c){return}if(b.ready===true){this.server=this.serverFrame.contentWindow;this.processQueue();return}else{if(b.type==="get"){if(typeof this.callbacks[b._xds]!=="undefined"){this.callbacks[b._xds](b.val,b)}}else{if(b.type==="allget"){if(typeof this.callbacks[b._xds]!=="undefined"){this.callbacks[b._xds](b.dict,b)}}else{if(b.type==="prefixget"){if(typeof this.callbacks[b._xds]!=="undefined"){this.callbacks[b._xds](b.dict,b)}}else{if(b.type==="set"){if(typeof this.callbacks[b._xds]!=="undefined"){this.callbacks[b._xds](b)}}else{if(b.type==="del"){if(typeof this.callbacks[b._xds]!=="undefined"){this.callbacks[b._xds](b)}}}}}}}},processQueue:function(){if(!this.queue){return}if(!this.server){this.init();return}while(this.queue.length>0){this.server.postMessage(JSON.stringify(this.queue.shift()),"*")}},post:function(b,c){this._id++;b._xds=this._id;if(typeof c!=="undefined"&&c!==null&&c!==false){this.callbacks[this._id]=c}if(this.server){this.server.postMessage(JSON.stringify(b),"*")}else{this.queue.push(b);this.init()}},getSSAllItems:function(b){this.post({type:"allget",store:"ss"},b)},getSSPrefixItems:function(b,c){this.post({type:"prefixget",prefix:b,store:"ss"},c)},getSSItem:function(b,c){this.post({type:"get",key:b,store:"ss"},c)},setSSItem:function(b,c,d){this.post({type:"set",key:b,val:c,store:"ss"},d)},removeSSItem:function(b,c){this.post({type:"del",key:b,store:"ss"},c)},getLSAllItems:function(b){this.post({type:"allget",store:"ls"},b)},getLSPrefixItems:function(b,c){this.post({type:"prefixget",prefix:b,store:"ls"},c)},getLSItem:function(b,c){this.post({type:"get",key:b,store:"ls"},c)},setLSItem:function(b,c,d){this.post({type:"set",key:b,val:c,store:"ls"},d)},removeLSItem:function(b,c){this.post({type:"del",key:b,store:"ls"},c)}};SecondScreenUtils.xds=a;_taq.libs=_taq.libs||{};_taq.libs.xds=a})();var swfobject=function(){var F="undefined",t="object",U="Shockwave Flash",Y="ShockwaveFlash.ShockwaveFlash",s="application/x-shockwave-flash",T="SWFObjectExprInst",z="onreadystatechange",Q=window,k=document,v=navigator,V=false,W=[i],q=[],P=[],K=[],n,S,G,D,L=false,a=false,p,I,o=true,O=function(){var ac=typeof k.getElementById!=F&&typeof k.getElementsByTagName!=F&&typeof k.createElement!=F,aj=v.userAgent.toLowerCase(),aa=v.platform.toLowerCase(),ag=aa?/win/.test(aa):/win/.test(aj),ae=aa?/mac/.test(aa):/mac/.test(aj),ah=/webkit/.test(aj)?parseFloat(aj.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,Z=!+"\v1",ai=[0,0,0],ad=null;if(typeof v.plugins!=F&&typeof v.plugins[U]==t){ad=v.plugins[U].description;if(ad&&!(typeof v.mimeTypes!=F&&v.mimeTypes[s]&&!v.mimeTypes[s].enabledPlugin)){V=true;Z=false;ad=ad.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ai[0]=parseInt(ad.replace(/^(.*)\..*$/,"$1"),10);ai[1]=parseInt(ad.replace(/^.*\.(.*)\s.*$/,"$1"),10);ai[2]=/[a-zA-Z]/.test(ad)?parseInt(ad.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof Q.ActiveXObject!=F){try{var af=new ActiveXObject(Y);if(af){ad=af.GetVariable("$version");if(ad){Z=true;ad=ad.split(" ")[1].split(",");ai=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}}catch(ab){}}}return{w3:ac,pv:ai,wk:ah,ie:Z,win:ag,mac:ae}}(),m=function(){if(!O.w3){return}if((typeof k.readyState!=F&&k.readyState=="complete")||(typeof k.readyState==F&&(k.getElementsByTagName("body")[0]||k.body))){g()}if(!L){if(typeof k.addEventListener!=F){k.addEventListener("DOMContentLoaded",g,false)}if(O.ie&&O.win){k.attachEvent(z,function(){if(k.readyState=="complete"){k.detachEvent(z,arguments.callee);g()}});if(Q==top){(function(){if(L){return}try{k.documentElement.doScroll("left")}catch(Z){setTimeout(arguments.callee,0);return}g()})()}}if(O.wk){(function(){if(L){return}if(!/loaded|complete/.test(k.readyState)){setTimeout(arguments.callee,0);return}g()})()}u(g)}}();function g(){if(L){return}try{var ab=k.getElementsByTagName("body")[0].appendChild(E("span"));ab.parentNode.removeChild(ab)}catch(ac){return}L=true;var Z=W.length;for(var aa=0;aa<Z;aa++){W[aa]()}}function M(Z){if(L){Z()}else{W[W.length]=Z}}function u(aa){if(typeof Q.addEventListener!=F){Q.addEventListener("load",aa,false)}else{if(typeof k.addEventListener!=F){k.addEventListener("load",aa,false)}else{if(typeof Q.attachEvent!=F){j(Q,"onload",aa)}else{if(typeof Q.onload=="function"){var Z=Q.onload;Q.onload=function(){Z();aa()}}else{Q.onload=aa}}}}}function i(){if(false){X()}else{J()}}function X(){var Z=k.getElementsByTagName("body")[0];var ac=E(t);ac.setAttribute("type",s);var ab=Z.appendChild(ac);if(ab){var aa=0;(function(){if(typeof ab.GetVariable!=F){var ad=ab.GetVariable("$version");if(ad){ad=ad.split(" ")[1].split(",");O.pv=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}else{if(aa<10){aa++;setTimeout(arguments.callee,10);return}}Z.removeChild(ac);ab=null;J()})()}else{J()}}function J(){var ai=q.length;if(ai>0){for(var ah=0;ah<ai;ah++){var aa=q[ah].id;var ad=q[ah].callbackFn;var ac={success:false,id:aa};if(O.pv[0]>0){var ag=c(aa);if(ag){if(H(q[ah].swfVersion)&&!(O.wk&&O.wk<312)){y(aa,true);if(ad){ac.success=true;ac.ref=B(aa);ad(ac)}}else{if(q[ah].expressInstall&&C()){var ak={};ak.data=q[ah].expressInstall;ak.width=ag.getAttribute("width")||"0";ak.height=ag.getAttribute("height")||"0";if(ag.getAttribute("class")){ak.styleclass=ag.getAttribute("class")}if(ag.getAttribute("align")){ak.align=ag.getAttribute("align")}var aj={};var Z=ag.getElementsByTagName("param");var ae=Z.length;for(var af=0;af<ae;af++){if(Z[af].getAttribute("name").toLowerCase()!="movie"){aj[Z[af].getAttribute("name")]=Z[af].getAttribute("value")}}R(ak,aj,aa,ad)}else{r(ag);if(ad){ad(ac)}}}}}else{y(aa,true);if(ad){var ab=B(aa);if(ab&&typeof ab.SetVariable!=F){ac.success=true;ac.ref=ab}ad(ac)}}}}}function B(ac){var Z=null;var aa=c(ac);if(aa&&aa.nodeName=="OBJECT"){if(typeof aa.SetVariable!=F){Z=aa}else{var ab=aa.getElementsByTagName(t)[0];if(ab){Z=ab}}}return Z}function C(){return !a&&H("6.0.65")&&(O.win||O.mac)&&!(O.wk&&O.wk<312)}function R(ac,ad,Z,ab){a=true;G=ab||null;D={success:false,id:Z};var ag=c(Z);if(ag){if(ag.nodeName=="OBJECT"){n=h(ag);S=null}else{n=ag;S=Z}ac.id=T;if(typeof ac.width==F||(!/%$/.test(ac.width)&&parseInt(ac.width,10)<310)){ac.width="310"}if(typeof ac.height==F||(!/%$/.test(ac.height)&&parseInt(ac.height,10)<137)){ac.height="137"}k.title=k.title.slice(0,47)+" - Flash Player Installation";var af=O.ie&&O.win?"ActiveX":"PlugIn",ae="MMredirectURL="+Q.location.toString().replace(/&/g,"%26")+"&MMplayerType="+af+"&MMdoctitle="+k.title;if(typeof ad.flashvars!=F){ad.flashvars+="&"+ae}else{ad.flashvars=ae}if(O.ie&&O.win&&ag.readyState!=4){var aa=E("div");Z+="SWFObjectNew";aa.setAttribute("id",Z);ag.parentNode.insertBefore(aa,ag);ag.style.display="none";(function(){if(ag.readyState==4){ag.parentNode.removeChild(ag)}else{setTimeout(arguments.callee,10)}})()}w(ac,ad,Z)}}function r(aa){if(O.ie&&O.win&&aa.readyState!=4){var Z=E("div");aa.parentNode.insertBefore(Z,aa);Z.parentNode.replaceChild(h(aa),Z);aa.style.display="none";(function(){if(aa.readyState==4){aa.parentNode.removeChild(aa)}else{setTimeout(arguments.callee,10)}})()}else{aa.parentNode.replaceChild(h(aa),aa)}}function h(ae){var ad=E("div");if(O.win&&O.ie){ad.innerHTML=ae.innerHTML}else{var aa=ae.getElementsByTagName(t)[0];if(aa){var af=aa.childNodes;if(af){var Z=af.length;for(var ab=0;ab<Z;ab++){if(!(af[ab].nodeType==1&&af[ab].nodeName=="PARAM")&&!(af[ab].nodeType==8)){ad.appendChild(af[ab].cloneNode(true))}}}}}return ad}function w(ak,ai,aa){var Z,ac=c(aa);if(O.wk&&O.wk<312){return Z}if(ac){if(typeof ak.id==F){ak.id=aa}if(O.ie&&O.win){var aj="";for(var ag in ak){if(ak[ag]!=Object.prototype[ag]){if(ag.toLowerCase()=="data"){ai.movie=ak[ag]}else{if(ag.toLowerCase()=="styleclass"){aj+=' class="'+ak[ag]+'"'}else{if(ag.toLowerCase()!="classid"){aj+=" "+ag+'="'+ak[ag]+'"'}}}}}var ah="";for(var af in ai){if(ai[af]!=Object.prototype[af]){ah+='<param name="'+af+'" value="'+ai[af]+'" />'}}ac.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+aj+">"+ah+"</object>";P[P.length]=ak.id;Z=c(ak.id)}else{var ab=E(t);ab.setAttribute("type",s);for(var ae in ak){if(ak[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="styleclass"){ab.setAttribute("class",ak[ae])}else{if(ae.toLowerCase()!="classid"){ab.setAttribute(ae,ak[ae])}}}}for(var ad in ai){if(ai[ad]!=Object.prototype[ad]&&ad.toLowerCase()!="movie"){f(ab,ad,ai[ad])}}ac.parentNode.replaceChild(ab,ac);Z=ab}}return Z}function f(ab,Z,aa){var ac=E("param");ac.setAttribute("name",Z);ac.setAttribute("value",aa);ab.appendChild(ac)}function A(aa){var Z=c(aa);if(Z&&Z.nodeName=="OBJECT"){if(O.ie&&O.win){Z.style.display="none";(function(){if(Z.readyState==4){b(aa)}else{setTimeout(arguments.callee,10)}})()}else{Z.parentNode.removeChild(Z)}}}function b(ab){var aa=c(ab);if(aa){for(var Z in aa){if(typeof aa[Z]=="function"){aa[Z]=null}}aa.parentNode.removeChild(aa)}}function c(ab){var Z=null;try{Z=k.getElementById(ab)}catch(aa){}return Z}function E(Z){return k.createElement(Z)}function j(ab,Z,aa){ab.attachEvent(Z,aa);K[K.length]=[ab,Z,aa]}function H(ab){var aa=O.pv,Z=ab.split(".");Z[0]=parseInt(Z[0],10);Z[1]=parseInt(Z[1],10)||0;Z[2]=parseInt(Z[2],10)||0;return(aa[0]>Z[0]||(aa[0]==Z[0]&&aa[1]>Z[1])||(aa[0]==Z[0]&&aa[1]==Z[1]&&aa[2]>=Z[2]))?true:false}function x(ae,aa,af,ad){if(O.ie&&O.mac){return}var ac=k.getElementsByTagName("head")[0];if(!ac){return}var Z=(af&&typeof af=="string")?af:"screen";if(ad){p=null;I=null}if(!p||I!=Z){var ab=E("style");ab.setAttribute("type","text/css");ab.setAttribute("media",Z);p=ac.appendChild(ab);if(O.ie&&O.win&&typeof k.styleSheets!=F&&k.styleSheets.length>0){p=k.styleSheets[k.styleSheets.length-1]}I=Z}if(O.ie&&O.win){if(p&&typeof p.addRule==t){p.addRule(ae,aa)}}else{if(p&&typeof k.createTextNode!=F){p.appendChild(k.createTextNode(ae+" {"+aa+"}"))}}}function y(ab,Z){if(!o){return}var aa=Z?"visible":"hidden";if(L&&c(ab)){c(ab).style.visibility=aa}else{x("#"+ab,"visibility:"+aa)}}function N(aa){var ab=/[\\\"<>\.;]/;var Z=ab.exec(aa)!=null;return Z&&typeof encodeURIComponent!=F?encodeURIComponent(aa):aa}var d=function(){if(O.ie&&O.win){window.attachEvent("onunload",function(){var ae=K.length;for(var ad=0;ad<ae;ad++){K[ad][0].detachEvent(K[ad][1],K[ad][2])}var ab=P.length;for(var ac=0;ac<ab;ac++){A(P[ac])}for(var aa in O){O[aa]=null}O=null;for(var Z in swfobject){swfobject[Z]=null}swfobject=null})}}();return{registerObject:function(ad,Z,ac,ab){if(O.w3&&ad&&Z){var aa={};aa.id=ad;aa.swfVersion=Z;aa.expressInstall=ac;aa.callbackFn=ab;q[q.length]=aa;y(ad,false)}else{if(ab){ab({success:false,id:ad})}}},getObjectById:function(Z){if(O.w3){return B(Z)}},embedSWF:function(ad,aj,ag,ai,aa,ac,ab,af,ah,ae){var Z={success:false,id:aj};if(O.w3&&!(O.wk&&O.wk<312)&&ad&&aj&&ag&&ai&&aa){y(aj,false);M(function(){ag+="";ai+="";var al={};if(ah&&typeof ah===t){for(var an in ah){al[an]=ah[an]}}al.data=ad;al.width=ag;al.height=ai;var ao={};if(af&&typeof af===t){for(var am in af){ao[am]=af[am]}}if(ab&&typeof ab===t){for(var ak in ab){if(typeof ao.flashvars!=F){ao.flashvars+="&"+ak+"="+ab[ak]}else{ao.flashvars=ak+"="+ab[ak]}}}if(H(aa)){var ap=w(al,ao,aj);if(al.id==aj){y(aj,true)}Z.success=true;Z.ref=ap}else{if(ac&&C()){al.data=ac;R(al,ao,aj,ae);return}else{y(aj,true)}}if(ae){ae(Z)}})}else{if(ae){ae(Z)}}},switchOffAutoHideShow:function(){o=false},ua:O,getFlashPlayerVersion:function(){return{major:O.pv[0],minor:O.pv[1],release:O.pv[2]}},hasFlashPlayerVersion:H,createSWF:function(ab,aa,Z){if(O.w3){return w(ab,aa,Z)}else{return undefined}},showExpressInstall:function(ab,ac,Z,aa){if(O.w3&&C()){R(ab,ac,Z,aa)}},removeSWF:function(Z){if(O.w3){A(Z)}},createCSS:function(ac,ab,aa,Z){if(O.w3){x(ac,ab,aa,Z)}},addDomLoadEvent:M,addLoadEvent:u,getQueryParamValue:function(ac){var ab=k.location.search||k.location.hash;if(ab){if(/\?/.test(ab)){ab=ab.split("?")[1]}if(ac==null){return N(ab)}var aa=ab.split("&");for(var Z=0;Z<aa.length;Z++){if(aa[Z].substring(0,aa[Z].indexOf("="))==ac){return N(aa[Z].substring((aa[Z].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var Z=c(T);if(Z&&n){Z.parentNode.replaceChild(n,Z);if(S){y(S,true);if(O.ie&&O.win){n.style.display="block"}}if(G){G(D)}}a=false}}}}();(function(){if(window.WEB_SOCKET_FORCE_FLASH){}else{if(window.WebSocket){return}else{if(window.MozWebSocket){window.WebSocket=MozWebSocket;return}}}var a;if(window.WEB_SOCKET_LOGGER){a=WEB_SOCKET_LOGGER}else{if(window.console&&window.console.log&&window.console.error){a=window.console}else{a={log:function(){},error:function(){}}}}if(swfobject.getFlashPlayerVersion().major<10){a.error("Flash Player >= 10.0.0 is required.");return}if(location.protocol=="file:"){a.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...")}window.WebSocket=function(d,f,c,h,g){var b=this;b.__id=WebSocket.__nextId++;WebSocket.__instances[b.__id]=b;b.readyState=WebSocket.CONNECTING;b.bufferedAmount=0;b.__events={};if(!f){f=[]}else{if(typeof f=="string"){f=[f]}}b.__createTask=setTimeout(function(){WebSocket.__addTask(function(){b.__createTask=null;WebSocket.__flash.create(b.__id,d,f,c||null,h||0,g||null)})},0)};WebSocket.prototype.send=function(c){if(this.readyState==WebSocket.CONNECTING){throw"INVALID_STATE_ERR: Web Socket connection has not been established"}var b=WebSocket.__flash.send(this.__id,encodeURIComponent(c));if(b<0){return true}else{this.bufferedAmount+=b;return false}};WebSocket.prototype.close=function(){if(this.__createTask){clearTimeout(this.__createTask);this.__createTask=null;this.readyState=WebSocket.CLOSED;return}if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING){return}this.readyState=WebSocket.CLOSING;WebSocket.__flash.close(this.__id)};WebSocket.prototype.addEventListener=function(c,d,b){if(!(c in this.__events)){this.__events[c]=[]}this.__events[c].push(d)};WebSocket.prototype.removeEventListener=function(f,g,b){if(!(f in this.__events)){return}var d=this.__events[f];for(var c=d.length-1;c>=0;--c){if(d[c]===g){d.splice(c,1);break}}};WebSocket.prototype.dispatchEvent=function(f){var c=this.__events[f.type]||[];for(var b=0;b<c.length;++b){c[b](f)}var d=this["on"+f.type];if(d){d.apply(this,[f])}};WebSocket.prototype.__handleEvent=function(d){if("readyState" in d){this.readyState=d.readyState}if("protocol" in d){this.protocol=d.protocol}var b;if(d.type=="open"||d.type=="error"){b=this.__createSimpleEvent(d.type)}else{if(d.type=="close"){b=this.__createSimpleEvent("close");b.wasClean=d.wasClean?true:false;b.code=d.code;b.reason=d.reason}else{if(d.type=="message"){var c=decodeURIComponent(d.message);b=this.__createMessageEvent("message",c)}else{throw"unknown event type: "+d.type}}}this.dispatchEvent(b)};WebSocket.prototype.__createSimpleEvent=function(b){if(document.createEvent&&window.Event){var c=document.createEvent("Event");c.initEvent(b,false,false);return c}else{return{type:b,bubbles:false,cancelable:false}}};WebSocket.prototype.__createMessageEvent=function(b,d){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");c.initMessageEvent("message",false,false,d,null,null,window,null);return c}else{return{type:b,data:d,bubbles:false,cancelable:false}}};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__isFlashImplementation=true;WebSocket.__initialized=false;WebSocket.__flash=null;WebSocket.__instances={};WebSocket.__tasks=[];WebSocket.__nextId=0;WebSocket.loadFlashPolicyFile=function(b){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(b)})};WebSocket.__initialize=function(){if(WebSocket.__initialized){return}WebSocket.__initialized=true;if(WebSocket.__swfLocation){window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation}if(!window.WEB_SOCKET_SWF_LOCATION){a.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return}if(!window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&!WEB_SOCKET_SWF_LOCATION.match(/(^|\/)WebSocketMainInsecure\.swf(\?.*)?$/)&&WEB_SOCKET_SWF_LOCATION.match(/^\w+:\/\/([^\/]+)/)){var d=RegExp.$1;if(location.host!=d){a.error("[WebSocket] You must host HTML and WebSocketMain.swf in the same host ('"+location.host+"' != '"+d+"'). See also 'How to host HTML file and SWF file in different domains' section in README.md. If you use WebSocketMainInsecure.swf, you can suppress this message by WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR = true;")}}var b=document.createElement("div");b.id="webSocketContainer";b.style.position="absolute";if(WebSocket.__isFlashLite()){b.style.left="0px";b.style.top="0px"}else{b.style.left="-100px";b.style.top="-100px"}var c=document.createElement("div");c.id="webSocketFlash";b.appendChild(c);document.body.appendChild(b);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:true,swliveconnect:true,allowScriptAccess:"always"},null,function(f){if(!f.success){a.error("[WebSocket] swfobject.embedSWF failed")}})};WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var b=0;b<WebSocket.__tasks.length;++b){WebSocket.__tasks[b]()}WebSocket.__tasks=[]},0)};WebSocket.__onFlashEvent=function(){setTimeout(function(){try{var c=WebSocket.__flash.receiveEvents();for(var b=0;b<c.length;++b){WebSocket.__instances[c[b].webSocketId].__handleEvent(c[b])}}catch(d){a.error(d)}},0);return true};WebSocket.__log=function(b){a.log(decodeURIComponent(b))};WebSocket.__error=function(b){a.error(decodeURIComponent(b))};WebSocket.__addTask=function(b){if(WebSocket.__flash){b()}else{WebSocket.__tasks.push(b)}};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes){return false}var b=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!b||!b.enabledPlugin||!b.enabledPlugin.filename){return false}return b.enabledPlugin.filename.match(/flashlite/i)?true:false};if(!window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION){swfobject.addDomLoadEvent(function(){setTimeout(function(){WebSocket.__initialize()},0)})}})();(function(v){var h=v.MutationObserver||v.WebKitMutationObserver||v.MozMutationObserver;if(typeof h!="function"&&typeof h!="object"){return}var a="matchesSelector";if("webkitMatchesSelector" in Element.prototype){a="webkitMatchesSelector"}else{if("mozMatchesSelector" in Element.prototype){a="mozMatchesSelector"}}var q="__mutation_summary_node_map_id__";var n=1;function u(E){if(!E[q]){E[q]=n++;return true}return false}function r(){this.map_={}}r.prototype={set:function(E,F){u(E);this.map_[E[q]]={k:E,v:F}},get:function(F){if(u(F)){return}var E=this.map_[F[q]];if(E){return E.v}},has:function(E){return !u(E)&&E[q] in this.map_},delete_:function(E){if(u(E)){return}delete this.map_[E[q]]},keys:function(){var E=[];for(var F in this.map_){E.push(this.map_[F].k)}return E}};function k(F,E){return Object.prototype.hasOwnProperty.call(F,E)}var g=0;var m=1;var C=2;var o=3;var s=4;var j=5;function x(E){return E==m||E==o}var y=Array.prototype.forEach.call.bind(Array.prototype.forEach);function c(E,G,F){this.rootNode=E;this.elementFilter=G;this.calcReordered=F}c.prototype={getChange:function(E){var F=this.changeMap.get(E);if(!F){F={target:E};this.changeMap.set(E,F)}if(E.nodeType==Node.ELEMENT_NODE){F.matchCaseInsensitive=E instanceof HTMLElement&&E.ownerDocument instanceof HTMLDocument}return F},getParentChange:function(E){var F=this.getChange(E);if(!F.childList){F.childList=true;F.oldParentNode=null}return F},handleChildList:function(E){this.childListChanges=true;y(E.removedNodes,function(F){var G=this.getParentChange(F);if(G.added||G.oldParentNode){G.added=false}else{G.oldParentNode=E.target}},this);y(E.addedNodes,function(F){var G=this.getParentChange(F);G.added=true},this)},handleAttributes:function(F){this.attributesChanges=true;var G=this.getChange(F.target);if(!G.attributes){G.attributes=true;G.attributeOldValues={}}var E=G.attributeOldValues;if(!k(E,F.attributeName)){E[F.attributeName]=F.oldValue}},handleCharacterData:function(E){this.characterDataChanges=true;var F=this.getChange(E.target);if(F.characterData){return}F.characterData=true;F.characterDataOldValue=E.oldValue},processMutations:function(F){this.mutations=F;this.changeMap=new r;this.mutations.forEach(function(O){switch(O.type){case"childList":this.handleChildList(O);break;case"attributes":this.handleAttributes(O);break;case"characterData":this.handleCharacterData(O);break}},this);var I=this.entered=[];var M=this.exited=[];var K=this.stayedIn=new r;if(!this.childListChanges&&!this.attributesChanges){return}var H=this.matchabilityChange.bind(this);var G=this.reachabilityChange.bind(this);var L=this.wasReordered.bind(this);var J=new r;var N=this;function E(R,P){if(J.has(R)){return}J.set(R,true);var T=N.changeMap.get(R);var Q=P;if((T&&T.childList)||Q==undefined){Q=G(R)}if(Q==g){return}H(R);if(Q==m){I.push(R)}else{if(Q==o){M.push(R)}else{if(Q==C){var O=C;if(T&&T.childList){if(T.oldParentNode!==R.parentNode){O=s}else{if(N.calcReordered&&L(R)){O=j}}}K.set(R,O)}}}if(Q==C){return}for(var S=R.firstChild;S;S=S.nextSibling){E(S,Q)}}this.changeMap.keys().forEach(function(O){E(O)})},getChanged:function(F){var E=this.matchabilityChange.bind(this);this.entered.forEach(function(G){var H=E(G);if(H==m||H==C){F.added.push(G)}});this.stayedIn.keys().forEach(function(H){var I=E(H);if(I==m){F.added.push(H)}else{if(I==o){F.removed.push(H)}else{if(I==C&&(F.reparented||F.reordered)){var G=this.stayedIn.get(H);if(F.reparented&&G==s){F.reparented.push(H)}else{if(F.reordered&&G==j){F.reordered.push(H)}}}}}},this);this.exited.forEach(function(G){var H=E(G);if(H==o||H==C){F.removed.push(G)}})},getOldParentNode:function(F){var G=this.changeMap.get(F);if(G&&G.childList){return G.oldParentNode?G.oldParentNode:null}var E=this.reachabilityChange(F);if(E==g||E==m){throw Error("getOldParentNode requested on invalid node.")}return F.parentNode},getOldPreviousSibling:function(E){var F=this.childlistChanges.get(E.parentNode);if(!F||!this.wasReordered(E)){throw Error("getOldPreviousSibling requested on invalid node.")}return F.oldPreviousSibling.get(E)},getOldAttribute:function(F,E){var G=this.changeMap.get(F);if(!G||!G.attributes){throw Error("getOldAttribute requested on invalid node.")}if(G.matchCaseInsensitive){E=E.toLowerCase()}if(!k(G.attributeOldValues,E)){throw Error("getOldAttribute requested for unchanged attribute name.")}return G.attributeOldValues[E]},getAttributesChanged:function(K){if(!this.attributesChanges){return{}}var F;var H;if(K){F={};H={};K.forEach(function(O){F[O]=true;var P=O.toLowerCase();if(O!=P){H[P]=O}})}var N={};var E=this.changeMap.keys();for(var J=0;J<E.length;J++){var G=E[J];var L=this.changeMap.get(G);if(!L.attributes){continue}if(C!=this.reachabilityChange(G)||C!=this.matchabilityChange(G)){continue}var I=G;var M=L.attributeOldValues;Object.keys(M).forEach(function(P){var O=P;if(L.matchCaseInsensitive&&H&&H[P]){O=H[P]}if(F&&!F[O]){return}if(I.getAttribute(P)==M[P]){return}if(!N[O]){N[O]=[]}N[O].push(I)})}return N},getOldCharacterData:function(E){var F=this.changeMap.get(E);if(!F||!F.characterData){throw Error("getOldCharacterData requested on invalid node.")}return F.characterDataOldValue},getCharacterDataChanged:function(){if(!this.characterDataChanges){return[]}var F=this.changeMap.keys();var E=[];for(var G=0;G<F.length;G++){var H=F[G];if(C!=this.reachabilityChange(H)||C!=this.matchabilityChange(H)){continue}var I=this.changeMap.get(H);if(!I.characterData||H.textContent==I.characterDataOldValue){continue}E.push(H)}return E},reachabilityChange:function(H){this.reachableCache=this.reachableCache||new r;this.wasReachableCache=this.wasReachableCache||new r;var F=this.rootNode;var G=this.changeMap;var L=this.reachableCache;var I=this.wasReachableCache;function E(M){var N=G.get(M);if(N&&N.childList){if(N.oldParentNode){return N.oldParentNode}if(N.added){return null}}return M.parentNode}function K(M){if(M===F){return true}if(!M){return false}var N=L.get(M);if(N===undefined){N=K(M.parentNode);L.set(M,N)}return N}function J(M){if(M===F){return true}if(!M){return false}var N=I.get(M);if(N===undefined){N=J(E(M));I.set(M,N)}return N}if(K(H)){return J(H)?C:m}else{return J(H)?o:g}},checkWasMatching:function(H,F,M){var Q=this.changeMap.get(H);if(!Q||!Q.attributeOldValues){return M}var J=F.tagName;if(Q.matchCaseInsensitive&&J!="*"&&k(F,"caseInsensitiveTagName")){J=F.caseInsensitiveTagName}if(J!="*"&&J!=H.tagName){return false}var E=Q.attributeOldValues;var G=F.qualifiers.some(function(R){if(R.klass){return k(E,"class")}else{if(R.id){return k(E,"id")}else{return Q.matchCaseInsensitive&&k(R,"caseInsensitiveAttrName")?k(E,R.caseInsensitiveAttrName):k(E,R.attrName)}}});if(!G){return M}for(var L=0;L<F.qualifiers.length;L++){var O=F.qualifiers[L];var P;if(O.klass){P="class"}else{if(O.id){P="id"}else{if(Q.matchCaseInsensitive&&k(O,"caseInsensitiveAttrName")){P=O.caseInsensitiveAttrName}else{P=O.attrName}}}var K=O.klass?true:O.contains;var I=k(E,P)?E[P]:H.getAttribute(P);if(I==null){return false}if(O.hasOwnProperty("attrValue")){if(!K&&O.attrValue!==I){return false}var N=I.split(" ").some(function(R){return R==O.attrValue});if(!N){return false}}}return true},matchabilityChange:function(J){if(this.filterCharacterData){switch(J.nodeType){case Node.COMMENT_NODE:case Node.TEXT_NODE:return C;default:return g}}if(!this.elementFilter){return C}if(J.nodeType!==Node.ELEMENT_NODE){return g}var H=J;function I(M){if(!this.matchCache){this.matchCache={}}if(!this.matchCache[M.selectorString]){this.matchCache[M.selectorString]=new r}var L=this.matchCache[M.selectorString];var K=L.get(H);if(K!==undefined){return K}var N=H[a](M.selectorString);var O=this.checkWasMatching(H,M,N);if(N){K=O?C:m}else{K=O?o:g}L.set(H,K);return K}var F=this.elementFilter.map(I,this);var E=g;var G=0;while(E!=C&&G<F.length){switch(F[G]){case C:E=C;break;case m:if(E==o){E=C}else{E=m}break;case o:if(E==m){E=C}else{E=o}break}G++}return E},processChildlistChanges:function(){if(this.childlistChanges){return}var F=this.childlistChanges=new r;function E(H){var I=F.get(H);if(!I){I={added:new r,removed:new r,maybeMoved:new r,oldPrevious:new r};F.set(H,I)}return I}var G=this.reachabilityChange.bind(this);this.mutations.forEach(function(I){if(I.type!="childList"){return}if(G(I.target)!=C){return}var K=E(I.target);var H=I.previousSibling;function J(M,L){if(!M||K.oldPrevious.has(M)||K.added.has(M)||K.maybeMoved.has(M)){return}if(L&&(K.added.has(L)||K.maybeMoved.has(L))){return}K.oldPrevious.set(M,L)}y(I.removedNodes,function(L){J(L,H);if(K.added.has(L)){K.added.delete_(L)}else{K.removed.set(L,true);K.maybeMoved.delete_(L,true)}H=L});J(I.nextSibling,H);y(I.addedNodes,function(L){if(K.removed.has(L)){K.removed.delete_(L);K.maybeMoved.set(L,true)}else{K.added.set(L,true)}})})},wasReordered:function(F){if(!this.childListChanges){return false}this.processChildlistChanges();var J=this.childlistChanges.get(F.parentNode);if(J.moved){return J.moved.get(F)}var K=J.moved=new r;var E=new r;function G(O){while(O=O.previousSibling){if(E.has(O)){return false}}return true}function I(O){if(!O){return false}if(!J.maybeMoved.has(O)){return false}var P=K.get(O);if(P!==undefined){return P}if(E.has(O)){P=G(O)}else{E.set(O,true);P=N(O)!==M(O)}if(E.has(O)){E.delete_(O);K.set(O,P)}else{P=K.get(O)}return P}var L=J.oldPreviousSibling=new r;function M(P){var O=L.get(P);if(O!==undefined){return O}O=J.oldPrevious.get(P);while(O&&(J.removed.has(O)||I(O))){O=M(O)}if(O===undefined){O=P.previousSibling}L.set(P,O);return O}var H=new r;function N(P){if(H.has(P)){return H.get(P)}var O=P.previousSibling;while(O&&(J.added.has(O)||I(O))){O=O.previousSibling}H.set(P,O);return O}J.maybeMoved.keys().forEach(I);return J.moved.get(F)}};var w=/[a-zA-Z_]+/;var B=/[a-zA-Z0-9_\-]+/;function D(Q){var N=[];var K;var M;function P(){if(K){if(M){K.qualifiers.push(M);M=undefined}N.push(K)}K={qualifiers:[]}}function O(){if(M){K.qualifiers.push(M)}M={}}var ae=/\s/;var E;var F="Invalid or unsupported selector syntax.";var L=1;var X=2;var R=3;var Y=4;var ac=5;var V=6;var G=7;var aa=8;var H=9;var W=10;var ad=11;var J=12;var U=13;var T=14;var I=L;var Z=0;while(Z<Q.length){var ab=Q[Z++];switch(I){case L:if(ab.match(w)){P();K.tagName=ab;I=X;break}if(ab=="*"){P();K.tagName="*";I=R;break}if(ab=="."){P();O();K.tagName="*";M.klass=true;I=Y;break}if(ab=="#"){P();O();K.tagName="*";M.id=true;I=Y;break}if(ab=="["){P();O();K.tagName="*";M.attrName="";I=V;break}if(ab.match(ae)){break}throw Error(F);case X:if(ab.match(B)){K.tagName+=ab;break}if(ab=="."){O();M.klass=true;I=Y;break}if(ab=="#"){O();M.id=true;I=Y;break}if(ab=="["){O();M.attrName="";I=V;break}if(ab.match(ae)){I=T;break}if(ab==","){I=L;break}throw Error(F);case R:if(ab=="."){O();M.klass=true;I=Y;break}if(ab=="#"){O();M.id=true;I=Y;break}if(ab=="["){O();M.attrName="";I=V;break}if(ab.match(ae)){I=T;break}if(ab==","){I=L;break}throw Error(F);case Y:if(ab.match(w)){M.attrValue=ab;I=ac;break}throw Error(F);case ac:if(ab.match(B)){M.attrValue+=ab;break}if(ab=="."){O();M.klass=true;I=Y;break}if(ab=="#"){O();M.id=true;I=Y;break}if(ab=="["){O();I=V;break}if(ab.match(ae)){I=T;break}if(ab==","){I=L;break}throw Error(F);case V:if(ab.match(w)){M.attrName=ab;I=G;break}if(ab.match(ae)){break}throw Error(F);case G:if(ab.match(B)){M.attrName+=ab;break}if(ab.match(ae)){I=aa;break}if(ab=="~"){M.contains=true;I=H;break}if(ab=="="){M.attrValue="";I=ad;break}if(ab=="]"){I=R;break}throw Error(F);case aa:if(ab=="~"){M.contains=true;I=H;break}if(ab=="="){M.attrValue="";I=ad;break}if(ab=="]"){I=R;break}if(ab.match(ae)){break}throw Error(F);case H:if(ab=="="){M.attrValue="";I=ad;break}throw Error(F);case W:if(ab=="]"){I=R;break}if(ab.match(ae)){break}throw Error(F);case ad:if(ab.match(ae)){break}if(ab=='"'||ab=="'"){E=ab;I=U;break}M.attrValue+=ab;I=J;break;case J:if(ab.match(ae)){I=W;break}if(ab=="]"){I=R;break}if(ab=="'"||ab=='"'){throw Error(F)}M.attrValue+=ab;break;case U:if(ab==E){I=W;break}M.attrValue+=ab;break;case T:if(ab.match(ae)){break}if(ab==","){I=L;break}throw Error(F)}}switch(I){case L:case X:case R:case ac:case T:P();break;default:throw Error(F)}if(!N.length){throw Error(F)}function S(af){return'"'+af.replace(/"/,'\\"')+'"'}N.forEach(function(af){var ah=af.tagName.toUpperCase();if(af.tagName!=ah){af.caseInsensitiveTagName=ah}var ag=af.tagName;af.qualifiers.forEach(function(ai){if(ai.klass){ag+="."+ai.attrValue}else{if(ai.id){ag+="#"+ai.attrValue}else{var aj=ai.attrName.toLowerCase();if(ai.attrName!=aj){ai.caseInsensitiveAttrName=aj}if(ai.contains){ag+="["+ai.attrName+"~="+S(ai.attrValue)+"]"}else{ag+="["+ai.attrName;if(ai.hasOwnProperty("attrValue")){ag+="="+S(ai.attrValue)}ag+="]"}}}});af.selectorString=ag});return N}var f=/^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/;function b(E){if(typeof E!="string"){throw Error("Invalid request opion. attribute must be a non-zero length string.")}E=E.trim();if(!E){throw Error("Invalid request opion. attribute must be a non-zero length string.")}if(!E.match(f)){throw Error("Invalid request option. invalid attribute name: "+E)}return E}function i(J){if(!J.trim().length){throw Error("Invalid request option: elementAttributes must contain at least one attribute.")}var I={};var E={};var H=J.split(/\s+/);for(var F=0;F<H.length;F++){var G=H[F];if(!G){continue}var G=b(G);if(I.hasOwnProperty(G.toLowerCase())){throw Error("Invalid request option: observing multiple case varitations of the same attribute is not supported.")}E[G]=true;I[G.toLowerCase()]=true}return Object.keys(E)}function d(E){var L={callback:true,queries:true,rootNode:true,observeOwnChanges:true};var J={};for(var G in E){if(!(G in L)){throw Error("Invalid option: "+G)}}if(typeof E.callback!=="function"){throw Error("Invalid options: callback is required and must be a function")}J.callback=E.callback;J.rootNode=E.rootNode||document;J.observeOwnChanges=E.observeOwnChanges;if(!E.queries||!E.queries.length){throw Error("Invalid options: queries must contain at least one query request object.")}J.queries=[];for(var F=0;F<E.queries.length;F++){var I=E.queries[F];if(I.all){if(Object.keys(I).length>1){throw Error("Invalid request option. all has no options.")}J.queries.push({all:true});continue}if(I.hasOwnProperty("attribute")){var K={attribute:b(I.attribute)};K.elementFilter=D("*["+K.attribute+"]");if(Object.keys(I).length>1){throw Error("Invalid request option. attribute has no options.")}J.queries.push(K);continue}if(I.hasOwnProperty("element")){var H=Object.keys(I).length;var K={element:I.element,elementFilter:D(I.element)};if(I.hasOwnProperty("elementAttributes")){K.elementAttributes=i(I.elementAttributes);H--}if(H>1){throw Error("Invalid request option. element only allows elementAttributes option.")}J.queries.push(K);continue}if(I.characterData){if(Object.keys(I).length>1){throw Error("Invalid request option. characterData has no options.")}J.queries.push({characterData:true});continue}throw Error("Invalid request option. Unknown query request.")}return J}function p(F){var E={};F.forEach(function(G){G.qualifiers.forEach(function(H){if(H.klass){E["class"]=true}else{if(H.id){E.id=true}else{E[H.attrName]=true}}})});return Object.keys(E)}function t(F){var H={childList:true,subtree:true};var E;function G(I){if(H.attributes&&!E){return}H.attributes=true;H.attributeOldValue=true;if(!I){E=undefined;return}E=E||{};I.forEach(function(J){E[J]=true;E[J.toLowerCase()]=true})}F.forEach(function(J){if(J.characterData){H.characterData=true;H.characterDataOldValue=true;return}if(J.all){G();H.characterData=true;H.characterDataOldValue=true;return}if(J.attribute){G([J.attribute.trim()]);return}if(J.elementFilter&&J.elementFilter.some(function(K){return K.className})){G(["class"])}var I=p(J.elementFilter).concat(J.elementAttributes||[]);if(I.length){G(I)}});if(E){H.attributeFilter=Object.keys(E)}return H}function z(E,F,J){E.elementFilter=J.elementFilter;E.filterCharacterData=J.characterData;var G={target:F,type:"summary",added:[],removed:[]};G.getOldParentNode=E.getOldParentNode.bind(E);if(J.all||J.element){G.reparented=[]}if(J.all){G.reordered=[]}E.getChanged(G);if(J.all||J.attribute||J.elementAttributes){var I=J.attribute?[J.attribute]:J.elementAttributes;var H=E.getAttributesChanged(I);if(J.attribute){G.valueChanged=[];if(H[J.attribute]){G.valueChanged=H[J.attribute]}G.getOldAttribute=function(L){return E.getOldAttribute(L,J.attribute)}}else{G.attributeChanged=H;if(J.elementAttributes){J.elementAttributes.forEach(function(L){if(!G.attributeChanged.hasOwnProperty(L)){G.attributeChanged[L]=[]}})}G.getOldAttribute=E.getOldAttribute.bind(E)}}if(J.all||J.characterData){var K=E.getCharacterDataChanged();G.getOldCharacterData=E.getOldCharacterData.bind(E);if(J.characterData){G.valueChanged=K}else{G.characterDataChanged=K}}if(G.reordered){G.getOldPreviousSibling=E.getOldPreviousSibling.bind(E)}return G}function A(F){var H=false;var R=d(F);var E=t(R.queries);var M=R.rootNode;var O=R.callback;var N=Array.prototype.concat.apply([],R.queries.map(function(S){return S.elementFilter?S.elementFilter:[]}));if(!N.length){N=undefined}var P=R.queries.some(function(S){return S.all});var Q=[];if(A.createQueryValidator){Q=R.queries.map(function(S){return A.createQueryValidator(M,S)})}function J(){Q.forEach(function(S){if(S){S.recordPreviousState()}})}function I(S){Q.forEach(function(U,T){if(U){U.validate(S[T])}})}function G(T){if(!T||!T.length){return[]}var S=new c(M,N,P);S.processMutations(T);return R.queries.map(function(U){return z(S,M,U)})}function L(S){return S.some(function(T){var V=["added","removed","reordered","reparented","valueChanged","characterDataChanged"];if(V.some(function(W){return T[W]&&T[W].length})){return true}if(T.attributeChanged){var U=Object.keys(T.attributeChanged).some(function(W){return T.attributeChanged[W].length});if(U){return true}}return false})}var K=new h(function(S){if(!R.observeOwnChanges){K.disconnect()}var T=G(S);I(T);if(R.observeOwnChanges){J()}if(L(T)){O(T)}if(!R.observeOwnChanges){J();K.observe(M,E)}});this.reconnect=function(){if(H){throw Error("Already connected")}K.observe(M,E);H=true;J()};this.disconnect=function(){if(!H){throw Error("Not connected")}var S;if(typeof K.takeRecords=="function"){S=K.takeRecords()}else{console.log("Warning: MutationObserver.takeRecords not implemented. Current changes cannot be reported.")}K.disconnect();H=false;var T=G(S);if(L(T)){return T}};this.reconnect()}v.MutationSummary=A;v.MutationSummary.NodeMap=r;v.MutationSummary.parseElementFilter=D})(this);function TreeMirror(a,b){this.root=a;this.idMap={};this.delegate=b}TreeMirror.prototype={initialize:function(a,c){this.idMap[a]=this.root;for(var b=0;b<c.length;b++){this.deserializeNode(c[b],this.root)}},deserializeNode:function(a,c){if(a===null){return null}if(typeof a=="number"){return this.idMap[a]}var f=this.root;var d;switch(a.nodeType){case Node.COMMENT_NODE:d=f.createComment(a.textContent);break;case Node.TEXT_NODE:d=f.createTextNode(a.textContent);break;case Node.DOCUMENT_TYPE_NODE:d=f.implementation.createDocumentType(a.name,a.publicId,a.systemId);break;case Node.ELEMENT_NODE:if(this.delegate&&this.delegate.createElement){d=this.delegate.createElement(a.tagName)}if(!d){d=f.createElement(a.tagName)}Object.keys(a.attributes).forEach(function(g){if(g!="onload"&&g!="onerror"){if(!this.delegate||!this.delegate.setAttribute||!this.delegate.setAttribute(d,g,a.attributes[g])){try{d.setAttribute(g,a.attributes[g])}catch(h){}}}},this);break}this.idMap[a.id]=d;if(c){c.appendChild(d)}if(a.childNodes){for(var b=0;b<a.childNodes.length;b++){this.deserializeNode(a.childNodes[b],d)}}return d},applyChanged:function(f,d,a,h){function g(j){if(j.parentNode){j.parentNode.removeChild(j)}}function i(n){var j=n.parentNode;var m=n.previousSibling;var k=n.node;j.insertBefore(k,m?m.nextSibling:j.firstChild)}function c(k){var j=this.deserializeNode(k.node);Object.keys(k.attributes).forEach(function(n){var m=k.attributes[n];if(m===null){j.removeAttribute(n)}else{if(!this.delegate||!this.delegate.setAttribute||!this.delegate.setAttribute(j,n,m)){try{j.setAttribute(n,m)}catch(o){}}}},this)}function b(k){var j=this.deserializeNode(k.node);j.textContent=k.textContent}d.forEach(function(j){j.node=this.deserializeNode(j.node);j.previousSibling=this.deserializeNode(j.previousSibling);j.parentNode=this.deserializeNode(j.parentNode);g(j.node)},this);f.map(this.deserializeNode,this).forEach(g);d.forEach(i);a.forEach(c,this);h.forEach(b,this);f.forEach(function(j){delete this.idMap[j]},this)}};function TreeMirrorClient(h,g,f){this.target=h;this.mirror=g;this.knownNodes=new MutationSummary.NodeMap;var a=this.serializeNode(h).id;var d=[];for(var i=h.firstChild;i;i=i.nextSibling){d.push(this.serializeNode(i,true))}this.mirror.initialize(a,d);var b=this;var c=[{all:true}];if(f){c=c.concat(f)}this.mutationSummary=new MutationSummary({rootNode:h,callback:function(j){b.applyChanged(j)},queries:c})}TreeMirrorClient.prototype={nextId:1,disconnect:function(){if(this.mutationSummary){this.mutationSummary.disconnect();this.mutationSummary=undefined}},rememberNode:function(a){var b=this.nextId++;this.knownNodes.set(a,b);return b},forgetNode:function(a){delete this.knownNodes.delete_(a)},serializeNode:function(d,b){if(d===null){return null}var h=this.knownNodes.get(d);if(h!==undefined){return h}var f={nodeType:d.nodeType,id:this.rememberNode(d)};switch(f.nodeType){case Node.DOCUMENT_TYPE_NODE:f.name=d.name;f.publicId=d.publicId;f.systemId=d.systemId;break;case Node.COMMENT_NODE:case Node.TEXT_NODE:f.textContent=d.textContent;break;case Node.ELEMENT_NODE:f.tagName=d.tagName;f.attributes={};for(var c=0;c<d.attributes.length;c++){var a=d.attributes.item(c);f.attributes[a.name]=a.value}if(b&&d.childNodes.length){f.childNodes=[];for(var g=d.firstChild;g;g=g.nextSibling){f.childNodes.push(this.serializeNode(g,true))}}break}return f},serializeAddedAndMoved:function(d){var b=d.added.concat(d.reparented).concat(d.reordered);var c=new MutationSummary.NodeMap;b.forEach(function(h){var g=h.parentNode;var f=c.get(g);if(!f){f=new MutationSummary.NodeMap;c.set(g,f)}f.set(h,true)});var a=[];c.keys().forEach(function(g){var f=c.get(g);var i=f.keys();while(i.length){var h=i[0];while(h.previousSibling&&f.has(h.previousSibling)){h=h.previousSibling}while(h&&f.has(h)){a.push({node:this.serializeNode(h),previousSibling:this.serializeNode(h.previousSibling),parentNode:this.serializeNode(h.parentNode)});f.delete_(h);h=h.nextSibling}var i=f.keys()}},this);return a},serializeAttributeChanges:function(a){var b=new MutationSummary.NodeMap;Object.keys(a).forEach(function(c){a[c].forEach(function(f){var d=b.get(f);if(!d){d={node:this.serializeNode(f),attributes:{}};b.set(f,d)}d.attributes[c]=f.getAttribute(c)},this)},this);return b.keys().map(function(c){return b.get(c)})},serializeCharacterDataChange:function(a){return{node:this.serializeNode(a),textContent:a.textContent}},applyChanged:function(c){var g=c[0];var d=g.removed.map(this.serializeNode,this);var b=this.serializeAddedAndMoved(g);var a=this.serializeAttributeChanges(g.attributeChanged);var f=g.characterDataChanged.map(this.serializeCharacterDataChange,this);this.mirror.applyChanged(d,b,a,f);g.removed.forEach(this.forgetNode,this)}};var SecondScreenUtils=SecondScreenUtils||{};(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var d=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function b(n){var h,k,f;var m,j,g;f=n.length;k=0;h="";while(k<f){m=n.charCodeAt(k++)&255;if(k==f){h+=a.charAt(m>>2);h+=a.charAt((m&3)<<4);h+="==";break}j=n.charCodeAt(k++);if(k==f){h+=a.charAt(m>>2);h+=a.charAt(((m&3)<<4)|((j&240)>>4));h+=a.charAt((j&15)<<2);h+="=";break}g=n.charCodeAt(k++);h+=a.charAt(m>>2);h+=a.charAt(((m&3)<<4)|((j&240)>>4));h+=a.charAt(((j&15)<<2)|((g&192)>>6));h+=a.charAt(g&63)}return h}function c(o){var n,m,j,g;var k,f,h;f=o.length;k=0;h="";while(k<f){do{n=d[o.charCodeAt(k++)&255]}while(k<f&&n==-1);if(n==-1){break}do{m=d[o.charCodeAt(k++)&255]}while(k<f&&m==-1);if(m==-1){break}h+=String.fromCharCode((n<<2)|((m&48)>>4));do{j=o.charCodeAt(k++)&255;if(j==61){return h}j=d[j]}while(k<f&&j==-1);if(j==-1){break}h+=String.fromCharCode(((m&15)<<4)|((j&60)>>2));do{g=o.charCodeAt(k++)&255;if(g==61){return h}g=d[g]}while(k<f&&g==-1);if(g==-1){break}h+=String.fromCharCode(((j&3)<<6)|g)}return h}SecondScreenUtils.base64encode=b;SecondScreenUtils.base64decode=c})();var SecondScreenUtils=SecondScreenUtils||{};(function(){function a(c){return c.replace(/\\u/g,"\\\\u").replace(/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,function(d){var g="";for(var f=0;f<d.length;f++){var h=d.charCodeAt(f).toString(16);g+="\\u"+("0000"+h).substr(h.length)}return g})}function b(c){return c.replace(/(.?)\\u([0-9,a-f,A-F]{4})/g,function(f,g,d){if(g!="\\"){return g+String.fromCharCode(parseInt(d,16))}else{return f}}).replace(/\\\\u/g,"\\u")}SecondScreenUtils.unicode_encode=a;SecondScreenUtils.unicode_decode=b})();var SecondScreenUtils=SecondScreenUtils||{};(function(){function a(p,j,k){var f={};var o=(p+"").split("");var m=[];var g;var h=o[0];var c=256;var n=0;var d=setInterval(function(){n++;for(;n<o.length;n++){g=o[n];if(f.hasOwnProperty(h+g)){h+=g}else{m.push(h.length>1?f[h]:h.charCodeAt(0));if(c<=55295){f[h+g]=c;c++}h=g}if(n%100000==0){k(n,o.length);break}}if(n==o.length){clearInterval(d);k(n,o.length);m.push(h.length>1?f[h]:h.charCodeAt(0));for(var i=0;i<m.length;i++){m[i]=String.fromCharCode(m[i])}j(m.join(""))}},50)}function b(o){var d={};var n=(o+"").split("");var g=n[0];var f=g;var k=[g];var c=256;var h;for(var m=1;m<n.length;m++){var j=n[m].charCodeAt(0);if(j<256){h=n[m]}else{h=d[j]?d[j]:(f+g)}k.push(h);g=h.charAt(0);d[c]=f+g;c++;f=h}return k.join("")}SecondScreenUtils.lzw_encode=a;SecondScreenUtils.lzw_decode=b})();(function(){function a(){this.Diff_Timeout=1;this.Diff_EditCost=4;this.Match_Threshold=0.5;this.Match_Distance=1000;this.Patch_DeleteThreshold=0.5;this.Patch_Margin=4;this.Match_MaxBits=32}a.prototype.diff_main=function(i,h,o,n){"undefined"==typeof n&&(n=0>=this.Diff_Timeout?Number.MAX_VALUE:(new Date).getTime()+1000*this.Diff_Timeout);if(null==i||null==h){throw Error("Null input. (diff_main)")}if(i==h){return i?[[0,i]]:[]}"undefined"==typeof o&&(o=!0);var m=o,k=this.diff_commonPrefix(i,h);o=i.substring(0,k);i=i.substring(k);h=h.substring(k);var k=this.diff_commonSuffix(i,h),j=i.substring(i.length-k);i=i.substring(0,i.length-k);h=h.substring(0,h.length-k);i=this.diff_compute_(i,h,m,n);o&&i.unshift([0,o]);j&&i.push([0,j]);this.diff_cleanupMerge(i);return i};a.prototype.diff_compute_=function(i,h,o,n){if(!i){return[[1,h]]}if(!h){return[[-1,i]]}var m=i.length>h.length?i:h,k=i.length>h.length?h:i,j=m.indexOf(k);return -1!=j?(o=[[1,m.substring(0,j)],[0,k],[1,m.substring(j+k.length)]],i.length>h.length&&(o[0][0]=o[2][0]=-1),o):1==k.length?[[-1,i],[1,h]]:(m=this.diff_halfMatch_(i,h))?(k=m[0],i=m[1],j=m[2],h=m[3],m=m[4],k=this.diff_main(k,j,o,n),o=this.diff_main(i,h,o,n),k.concat([[0,m]],o)):o&&100<i.length&&100<h.length?this.diff_lineMode_(i,h,n):this.diff_bisect_(i,h,n)};a.prototype.diff_lineMode_=function(i,h,o){var n=this.diff_linesToChars_(i,h);i=n.chars1;h=n.chars2;n=n.lineArray;i=this.diff_main(i,h,!1,o);this.diff_charsToLines_(i,n);this.diff_cleanupSemantic(i);i.push([0,""]);for(var m=n=h=0,k="",j="";h<i.length;){switch(i[h][0]){case 1:m++;j+=i[h][1];break;case -1:n++;k+=i[h][1];break;case 0:if(1<=n&&1<=m){i.splice(h-n-m,n+m);h=h-n-m;n=this.diff_main(k,j,!1,o);for(m=n.length-1;0<=m;m--){i.splice(h,0,n[m])}h+=n.length}n=m=0;j=k=""}h++}i.pop();return i};a.prototype.diff_bisect_=function(R,Q,P){for(var O=R.length,N=Q.length,M=Math.ceil((O+N)/2),L=M,K=2*M,I=Array(K),J=Array(K),H=0;H<K;H++){I[H]=-1,J[H]=-1}I[L+1]=0;J[L+1]=0;for(var H=O-N,C=0!=H%2,B=0,z=0,D=0,o=0,x=0;x<M&&!((new Date).getTime()>P);x++){for(var E=-x+B;E<=x-z;E+=2){var G=L+E,F;F=E==-x||E!=x&&I[G-1]<I[G+1]?I[G+1]:I[G-1]+1;for(var A=F-E;F<O&&A<N&&R.charAt(F)==Q.charAt(A);){F++,A++}I[G]=F;if(F>O){z+=2}else{if(A>N){B+=2}else{if(C&&(G=L+H-E,0<=G&&G<K&&-1!=J[G])){var y=O-J[G];if(F>=y){return this.diff_bisectSplit_(R,Q,F,A,P)}}}}}for(E=-x+D;E<=x-o;E+=2){G=L+E;y=E==-x||E!=x&&J[G-1]<J[G+1]?J[G+1]:J[G-1]+1;for(F=y-E;y<O&&F<N&&R.charAt(O-y-1)==Q.charAt(N-F-1);){y++,F++}J[G]=y;if(y>O){o+=2}else{if(F>N){D+=2}else{if(!C&&(G=L+H-E,0<=G&&(G<K&&-1!=I[G])&&(F=I[G],A=L+F-G,y=O-y,F>=y))){return this.diff_bisectSplit_(R,Q,F,A,P)}}}}}return[[-1,R],[1,Q]]};a.prototype.diff_bisectSplit_=function(i,h,o,n,m){var k=i.substring(0,o),j=h.substring(0,n);i=i.substring(o);h=h.substring(n);k=this.diff_main(k,j,!1,m);m=this.diff_main(i,h,!1,m);return k.concat(m)};a.prototype.diff_linesToChars_=function(i,h){function o(p){for(var d="",u=0,t=-1,s=n.length;t<p.length-1;){t=p.indexOf("\n",u);-1==t&&(t=p.length-1);var q=p.substring(u,t+1),u=t+1;(m.hasOwnProperty?m.hasOwnProperty(q):void 0!==m[q])?d+=String.fromCharCode(m[q]):(d+=String.fromCharCode(s),m[q]=s,n[s++]=q)}return d}var n=[],m={};n[0]="";var k=o(i),j=o(h);return{chars1:k,chars2:j,lineArray:n}};a.prototype.diff_charsToLines_=function(h,g){for(var m=0;m<h.length;m++){for(var k=h[m][1],j=[],i=0;i<k.length;i++){j[i]=g[k.charCodeAt(i)]}h[m][1]=j.join("")}};a.prototype.diff_commonPrefix=function(h,g){if(!h||!g||h.charAt(0)!=g.charAt(0)){return 0}for(var m=0,k=Math.min(h.length,g.length),j=k,i=0;m<j;){h.substring(i,j)==g.substring(i,j)?i=m=j:k=j,j=Math.floor((k-m)/2+m)}return j};a.prototype.diff_commonSuffix=function(h,g){if(!h||!g||h.charAt(h.length-1)!=g.charAt(g.length-1)){return 0}for(var m=0,k=Math.min(h.length,g.length),j=k,i=0;m<j;){h.substring(h.length-j,h.length-i)==g.substring(g.length-j,g.length-i)?i=m=j:k=j,j=Math.floor((k-m)/2+m)}return j};a.prototype.diff_commonOverlap_=function(h,g){var m=h.length,k=g.length;if(0==m||0==k){return 0}m>k?h=h.substring(m-k):m<k&&(g=g.substring(0,m));m=Math.min(m,k);if(h==g){return m}for(var k=0,j=1;;){var i=h.substring(m-j),i=g.indexOf(i);if(-1==i){return k}j+=i;if(0==i||h.substring(m-j)==g.substring(0,j)){k=j,j++}}};a.prototype.diff_halfMatch_=function(s,r){function q(C,B,A){for(var z=C.substring(A,A+Math.floor(C.length/4)),y=-1,x="",w,v,f,u;-1!=(y=B.indexOf(z,y+1));){var t=n.diff_commonPrefix(C.substring(A),B.substring(y)),D=n.diff_commonSuffix(C.substring(0,A),B.substring(0,y));x.length<D+t&&(x=B.substring(y-D,y)+B.substring(y,y+t),w=C.substring(0,A-D),v=C.substring(A+t),f=B.substring(0,y-D),u=B.substring(y+t))}return 2*x.length>=C.length?[w,v,f,u,x]:null}if(0>=this.Diff_Timeout){return null}var p=s.length>r.length?s:r,o=s.length>r.length?r:s;if(4>p.length||2*o.length<p.length){return null}var n=this,m=q(p,o,Math.ceil(p.length/4)),p=q(p,o,Math.ceil(p.length/2)),k;if(!m&&!p){return null}k=p?m?m[4].length>p[4].length?m:p:p:m;var i;s.length>r.length?(m=k[0],p=k[1],o=k[2],i=k[3]):(o=k[0],i=k[1],m=k[2],p=k[3]);k=k[4];return[m,p,o,i,k]};a.prototype.diff_cleanupSemantic=function(u){for(var t=!1,s=[],r=0,q=null,p=0,o=0,n=0,k=0,m=0;p<u.length;){0==u[p][0]?(s[r++]=p,o=k,n=m,m=k=0,q=u[p][1]):(1==u[p][0]?k+=u[p][1].length:m+=u[p][1].length,q&&(q.length<=Math.max(o,n)&&q.length<=Math.max(k,m))&&(u.splice(s[r-1],0,[-1,q]),u[s[r-1]+1][0]=1,r--,r--,p=0<r?s[r-1]:-1,m=k=n=o=0,q=null,t=!0)),p++}t&&this.diff_cleanupMerge(u);this.diff_cleanupSemanticLossless(u);for(p=1;p<u.length;){if(-1==u[p-1][0]&&1==u[p][0]){t=u[p-1][1];s=u[p][1];r=this.diff_commonOverlap_(t,s);q=this.diff_commonOverlap_(s,t);if(r>=q){if(r>=t.length/2||r>=s.length/2){u.splice(p,0,[0,s.substring(0,r)]),u[p-1][1]=t.substring(0,t.length-r),u[p+1][1]=s.substring(r),p++}}else{if(q>=t.length/2||q>=s.length/2){u.splice(p,0,[0,t.substring(0,q)]),u[p-1][0]=1,u[p-1][1]=s.substring(0,s.length-q),u[p+1][0]=-1,u[p+1][1]=t.substring(q),p++}}p++}p++}};a.prototype.diff_cleanupSemanticLossless=function(w){function v(F,E){if(!F||!E){return 6}var D=F.charAt(F.length-1),C=E.charAt(0),B=D.match(a.nonAlphaNumericRegex_),A=C.match(a.nonAlphaNumericRegex_),z=B&&D.match(a.whitespaceRegex_),y=A&&C.match(a.whitespaceRegex_),D=z&&D.match(a.linebreakRegex_),C=y&&C.match(a.linebreakRegex_),x=D&&F.match(a.blanklineEndRegex_),k=C&&E.match(a.blanklineStartRegex_);return x||k?5:D||C?4:B&&!z&&y?3:z||y?2:B||A?1:0}for(var u=1;u<w.length-1;){if(0==w[u-1][0]&&0==w[u+1][0]){var t=w[u-1][1],s=w[u][1],r=w[u+1][1],q=this.diff_commonSuffix(t,s);if(q){var p=s.substring(s.length-q),t=t.substring(0,t.length-q),s=p+s.substring(0,s.length-q),r=p+r}for(var q=t,p=s,n=r,o=v(t,s)+v(s,r);s.charAt(0)===r.charAt(0);){var t=t+s.charAt(0),s=s.substring(1)+r.charAt(0),r=r.substring(1),m=v(t,s)+v(s,r);m>=o&&(o=m,q=t,p=s,n=r)}w[u-1][1]!=q&&(q?w[u-1][1]=q:(w.splice(u-1,1),u--),w[u][1]=p,n?w[u+1][1]=n:(w.splice(u+1,1),u--))}u++}};a.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;a.whitespaceRegex_=/\s/;a.linebreakRegex_=/[\r\n]/;a.blanklineEndRegex_=/\n\r?\n$/;a.blanklineStartRegex_=/^\r?\n\r?\n/;a.prototype.diff_cleanupEfficiency=function(u){for(var t=!1,s=[],r=0,q=null,p=0,o=!1,n=!1,k=!1,m=!1;p<u.length;){if(0==u[p][0]){u[p][1].length<this.Diff_EditCost&&(k||m)?(s[r++]=p,o=k,n=m,q=u[p][1]):(r=0,q=null),k=m=!1}else{if(-1==u[p][0]?m=!0:k=!0,q&&(o&&n&&k&&m||q.length<this.Diff_EditCost/2&&3==o+n+k+m)){u.splice(s[r-1],0,[-1,q]),u[s[r-1]+1][0]=1,r--,q=null,o&&n?(k=m=!0,r=0):(r--,p=0<r?s[r-1]:-1,k=m=!1),t=!0}}p++}t&&this.diff_cleanupMerge(u)};a.prototype.diff_cleanupMerge=function(i){i.push([0,""]);for(var h=0,o=0,n=0,m="",k="",j;h<i.length;){switch(i[h][0]){case 1:n++;k+=i[h][1];h++;break;case -1:o++;m+=i[h][1];h++;break;case 0:1<o+n?(0!==o&&0!==n&&(j=this.diff_commonPrefix(k,m),0!==j&&(0<h-o-n&&0==i[h-o-n-1][0]?i[h-o-n-1][1]+=k.substring(0,j):(i.splice(0,0,[0,k.substring(0,j)]),h++),k=k.substring(j),m=m.substring(j)),j=this.diff_commonSuffix(k,m),0!==j&&(i[h][1]=k.substring(k.length-j)+i[h][1],k=k.substring(0,k.length-j),m=m.substring(0,m.length-j))),0===o?i.splice(h-n,o+n,[1,k]):0===n?i.splice(h-o,o+n,[-1,m]):i.splice(h-o-n,o+n,[-1,m],[1,k]),h=h-o-n+(o?1:0)+(n?1:0)+1):0!==h&&0==i[h-1][0]?(i[h-1][1]+=i[h][1],i.splice(h,1)):h++,o=n=0,k=m=""}}""===i[i.length-1][1]&&i.pop();o=!1;for(h=1;h<i.length-1;){0==i[h-1][0]&&0==i[h+1][0]&&(i[h][1].substring(i[h][1].length-i[h-1][1].length)==i[h-1][1]?(i[h][1]=i[h-1][1]+i[h][1].substring(0,i[h][1].length-i[h-1][1].length),i[h+1][1]=i[h-1][1]+i[h+1][1],i.splice(h-1,1),o=!0):i[h][1].substring(0,i[h+1][1].length)==i[h+1][1]&&(i[h-1][1]+=i[h+1][1],i[h][1]=i[h][1].substring(i[h+1][1].length)+i[h+1][1],i.splice(h+1,1),o=!0)),h++}o&&this.diff_cleanupMerge(i)};a.prototype.diff_xIndex=function(i,h){var o=0,n=0,m=0,k=0,j;for(j=0;j<i.length;j++){1!==i[j][0]&&(o+=i[j][1].length);-1!==i[j][0]&&(n+=i[j][1].length);if(o>h){break}m=o;k=n}return i.length!=j&&-1===i[j][0]?k:k+(h-m)};a.prototype.diff_prettyHtml=function(s){for(var r=[],q=/&/g,p=/</g,o=/>/g,n=/\n/g,m=0;m<s.length;m++){var k=s[m][0],i=s[m][1],i=i.replace(q,"&amp;").replace(p,"&lt;").replace(o,"&gt;").replace(n,"&para;<br>");switch(k){case 1:r[m]='<ins style="background:#e6ffe6;">'+i+"</ins>";break;case -1:r[m]='<del style="background:#ffe6e6;">'+i+"</del>";break;case 0:r[m]="<span>"+i+"</span>"}}return r.join("")};a.prototype.diff_text1=function(f){for(var d=[],g=0;g<f.length;g++){1!==f[g][0]&&(d[g]=f[g][1])}return d.join("")};a.prototype.diff_text2=function(f){for(var d=[],g=0;g<f.length;g++){-1!==f[g][0]&&(d[g]=f[g][1])}return d.join("")};a.prototype.diff_levenshtein=function(i){for(var h=0,o=0,n=0,m=0;m<i.length;m++){var k=i[m][0],j=i[m][1];switch(k){case 1:o+=j.length;break;case -1:n+=j.length;break;case 0:h+=Math.max(o,n),n=o=0}}return h+=Math.max(o,n)};a.prototype.diff_toDelta=function(f){for(var d=[],g=0;g<f.length;g++){switch(f[g][0]){case 1:d[g]="+"+encodeURI(f[g][1]);break;case -1:d[g]="-"+f[g][1].length;break;case 0:d[g]="="+f[g][1].length}}return d.join("\t").replace(/%20/g," ")};a.prototype.diff_fromDelta=function(u,t){for(var s=[],r=0,q=0,p=t.split(/\t/g),o=0;o<p.length;o++){var n=p[o].substring(1);switch(p[o].charAt(0)){case"+":try{s[r++]=[1,decodeURI(n)]}catch(k){throw Error("Illegal escape in diff_fromDelta: "+n)}break;case"-":case"=":var m=parseInt(n,10);if(isNaN(m)||0>m){throw Error("Invalid number in diff_fromDelta: "+n)}n=u.substring(q,q+=m);"="==p[o].charAt(0)?s[r++]=[0,n]:s[r++]=[-1,n];break;default:if(p[o]){throw Error("Invalid diff operation in diff_fromDelta: "+p[o])}}}if(q!=u.length){throw Error("Delta length ("+q+") does not equal source text length ("+u.length+").")}return s};a.prototype.match_main=function(f,d,g){if(null==f||null==d||null==g){throw Error("Null input. (match_main)")}g=Math.max(0,Math.min(g,f.length));return f==d?0:f.length?f.substring(g,g+d.length)==d?g:this.match_bitap_(f,d,g):-1};a.prototype.match_bitap_=function(E,D,C){function B(b,h){var f=b/D.length,c=Math.abs(C-h);return !z.Match_Distance?c?1:f:f+c/z.Match_Distance}if(D.length>this.Match_MaxBits){throw Error("Pattern too long for this browser.")}var A=this.match_alphabet_(D),z=this,y=this.Match_Threshold,x=E.indexOf(D,C);-1!=x&&(y=Math.min(B(0,x),y),x=E.lastIndexOf(D,C+D.length),-1!=x&&(y=Math.min(B(0,x),y)));for(var u=1<<D.length-1,x=-1,v,s,n=D.length+E.length,m,G=0;G<D.length;G++){v=0;for(s=n;v<s;){B(G,C+s)<=y?v=s:n=s,s=Math.floor((n-v)/2+v)}n=s;v=Math.max(1,C-s+1);var o=Math.min(C+s,E.length)+D.length;s=Array(o+2);for(s[o+1]=(1<<G)-1;o>=v;o--){var F=A[E.charAt(o-1)];s[o]=0===G?(s[o+1]<<1|1)&F:(s[o+1]<<1|1)&F|((m[o+1]|m[o])<<1|1)|m[o+1];if(s[o]&u&&(F=B(G,o-1),F<=y)){if(y=F,x=o-1,x>C){v=Math.max(1,2*C-x)}else{break}}}if(B(G+1,C)>y){break}m=s}return x};a.prototype.match_alphabet_=function(f){for(var d={},g=0;g<f.length;g++){d[f.charAt(g)]=0}for(g=0;g<f.length;g++){d[f.charAt(g)]|=1<<f.length-g-1}return d};a.prototype.patch_addContext_=function(g,f){if(0!=f.length){for(var i=f.substring(g.start2,g.start2+g.length1),h=0;f.indexOf(i)!=f.lastIndexOf(i)&&i.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;){h+=this.Patch_Margin,i=f.substring(g.start2-h,g.start2+g.length1+h)}h+=this.Patch_Margin;(i=f.substring(g.start2-h,g.start2))&&g.diffs.unshift([0,i]);(h=f.substring(g.start2+g.length1,g.start2+g.length1+h))&&g.diffs.push([0,h]);g.start1-=i.length;g.start2-=i.length;g.length1+=i.length+h.length;g.length2+=i.length+h.length}};a.prototype.patch_make=function(w,v,u){var t;if("string"==typeof w&&"string"==typeof v&&"undefined"==typeof u){t=w,v=this.diff_main(t,v,!0),2<v.length&&(this.diff_cleanupSemantic(v),this.diff_cleanupEfficiency(v))}else{if(w&&"object"==typeof w&&"undefined"==typeof v&&"undefined"==typeof u){v=w,t=this.diff_text1(v)}else{if("string"==typeof w&&v&&"object"==typeof v&&"undefined"==typeof u){t=w}else{if("string"==typeof w&&"string"==typeof v&&u&&"object"==typeof u){t=w,v=u}else{throw Error("Unknown call format to patch_make.")}}}}if(0===v.length){return[]}u=[];w=new a.patch_obj;for(var s=0,r=0,q=0,p=t,n=0;n<v.length;n++){var o=v[n][0],m=v[n][1];!s&&0!==o&&(w.start1=r,w.start2=q);switch(o){case 1:w.diffs[s++]=v[n];w.length2+=m.length;t=t.substring(0,q)+m+t.substring(q);break;case -1:w.length1+=m.length;w.diffs[s++]=v[n];t=t.substring(0,q)+t.substring(q+m.length);break;case 0:m.length<=2*this.Patch_Margin&&s&&v.length!=n+1?(w.diffs[s++]=v[n],w.length1+=m.length,w.length2+=m.length):m.length>=2*this.Patch_Margin&&s&&(this.patch_addContext_(w,p),u.push(w),w=new a.patch_obj,s=0,p=t,r=q)}1!==o&&(r+=m.length);-1!==o&&(q+=m.length)}s&&(this.patch_addContext_(w,p),u.push(w));return u};a.prototype.patch_deepCopy=function(h){for(var g=[],m=0;m<h.length;m++){var k=h[m],j=new a.patch_obj;j.diffs=[];for(var i=0;i<k.diffs.length;i++){j.diffs[i]=k.diffs[i].slice()}j.start1=k.start1;j.start2=k.start2;j.length1=k.length1;j.length2=k.length2;g[m]=j}return g};a.prototype.patch_apply=function(y,x){if(0==y.length){return[x,[]]}y=this.patch_deepCopy(y);var w=this.patch_addPadding(y);x=w+x+w;this.patch_splitMax(y);for(var v=0,u=[],t=0;t<y.length;t++){var s=y[t].start2+v,r=this.diff_text1(y[t].diffs),o,p=-1;if(r.length>this.Match_MaxBits){if(o=this.match_main(x,r.substring(0,this.Match_MaxBits),s),-1!=o&&(p=this.match_main(x,r.substring(r.length-this.Match_MaxBits),s+r.length-this.Match_MaxBits),-1==p||o>=p)){o=-1}}else{o=this.match_main(x,r,s)}if(-1==o){u[t]=!1,v-=y[t].length2-y[t].length1}else{if(u[t]=!0,v=o-s,s=-1==p?x.substring(o,o+r.length):x.substring(o,p+this.Match_MaxBits),r==s){x=x.substring(0,o)+this.diff_text2(y[t].diffs)+x.substring(o+r.length)}else{if(s=this.diff_main(r,s,!1),r.length>this.Match_MaxBits&&this.diff_levenshtein(s)/r.length>this.Patch_DeleteThreshold){u[t]=!1}else{this.diff_cleanupSemanticLossless(s);for(var r=0,n,p=0;p<y[t].diffs.length;p++){var m=y[t].diffs[p];0!==m[0]&&(n=this.diff_xIndex(s,r));1===m[0]?x=x.substring(0,o+n)+m[1]+x.substring(o+n):-1===m[0]&&(x=x.substring(0,o+n)+x.substring(o+this.diff_xIndex(s,r+m[1].length)));-1!==m[0]&&(r+=m[1].length)}}}}}x=x.substring(w.length,x.length-w.length);return[x,u]};a.prototype.patch_addPadding=function(h){for(var g=this.Patch_Margin,m="",k=1;k<=g;k++){m+=String.fromCharCode(k)}for(k=0;k<h.length;k++){h[k].start1+=g,h[k].start2+=g}var k=h[0],j=k.diffs;if(0==j.length||0!=j[0][0]){j.unshift([0,m]),k.start1-=g,k.start2-=g,k.length1+=g,k.length2+=g}else{if(g>j[0][1].length){var i=g-j[0][1].length;j[0][1]=m.substring(j[0][1].length)+j[0][1];k.start1-=i;k.start2-=i;k.length1+=i;k.length2+=i}}k=h[h.length-1];j=k.diffs;0==j.length||0!=j[j.length-1][0]?(j.push([0,m]),k.length1+=g,k.length2+=g):g>j[j.length-1][1].length&&(i=g-j[j.length-1][1].length,j[j.length-1][1]+=m.substring(0,i),k.length1+=i,k.length2+=i);return m};a.prototype.patch_splitMax=function(u){for(var t=this.Match_MaxBits,s=0;s<u.length;s++){if(!(u[s].length1<=t)){var r=u[s];u.splice(s--,1);for(var q=r.start1,p=r.start2,o="";0!==r.diffs.length;){var n=new a.patch_obj,k=!0;n.start1=q-o.length;n.start2=p-o.length;""!==o&&(n.length1=n.length2=o.length,n.diffs.push([0,o]));for(;0!==r.diffs.length&&n.length1<t-this.Patch_Margin;){var o=r.diffs[0][0],m=r.diffs[0][1];1===o?(n.length2+=m.length,p+=m.length,n.diffs.push(r.diffs.shift()),k=!1):-1===o&&1==n.diffs.length&&0==n.diffs[0][0]&&m.length>2*t?(n.length1+=m.length,q+=m.length,k=!1,n.diffs.push([o,m]),r.diffs.shift()):(m=m.substring(0,t-n.length1-this.Patch_Margin),n.length1+=m.length,q+=m.length,0===o?(n.length2+=m.length,p+=m.length):k=!1,n.diffs.push([o,m]),m==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(m.length))}o=this.diff_text2(n.diffs);o=o.substring(o.length-this.Patch_Margin);m=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);""!==m&&(n.length1+=m.length,n.length2+=m.length,0!==n.diffs.length&&0===n.diffs[n.diffs.length-1][0]?n.diffs[n.diffs.length-1][1]+=m:n.diffs.push([0,m]));k||u.splice(++s,0,n)}}}};a.prototype.patch_toText=function(f){for(var d=[],g=0;g<f.length;g++){d[g]=f[g]}return d.join("")};a.prototype.patch_fromText=function(j){var i=[];if(!j){return i}j=j.split("\n");for(var q=0,p=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;q<j.length;){var o=j[q].match(p);if(!o){throw Error("Invalid patch string: "+j[q])}var n=new a.patch_obj;i.push(n);n.start1=parseInt(o[1],10);""===o[2]?(n.start1--,n.length1=1):"0"==o[2]?n.length1=0:(n.start1--,n.length1=parseInt(o[2],10));n.start2=parseInt(o[3],10);""===o[4]?(n.start2--,n.length2=1):"0"==o[4]?n.length2=0:(n.start2--,n.length2=parseInt(o[4],10));for(q++;q<j.length;){o=j[q].charAt(0);try{var m=decodeURI(j[q].substring(1))}catch(k){throw Error("Illegal escape in patch_fromText: "+m)}if("-"==o){n.diffs.push([-1,m])}else{if("+"==o){n.diffs.push([1,m])}else{if(" "==o){n.diffs.push([0,m])}else{if("@"==o){break}else{if(""!==o){throw Error('Invalid patch mode "'+o+'" in: '+m)}}}}}q++}}return i};a.patch_obj=function(){this.diffs=[];this.start2=this.start1=null;this.length2=this.length1=0};a.patch_obj.prototype.toString=function(){var f,d;f=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1;d=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;f=["@@ -"+f+" +"+d+" @@\n"];var g;for(d=0;d<this.diffs.length;d++){switch(this.diffs[d][0]){case 1:g="+";break;case -1:g="-";break;case 0:g=" "}f[d+1]=g+encodeURI(this.diffs[d][1])+"\n"}return f.join("").replace(/%20/g," ")};SecondScreenUtils.diff_match_patch=a;SecondScreenUtils.DIFF_DELETE=-1;SecondScreenUtils.DIFF_INSERT=1;SecondScreenUtils.DIFF_EQUAL=0})();
/*! peerjs build:0.3.13, development. Copyright(c) 2013 Michelle Bu <michelle@michellebu.com> */
(function e(b,g,d){function c(m,j){if(!g[m]){if(!b[m]){var i=typeof require=="function"&&require;if(!j&&i){return i(m,!0)}if(a){return a(m,!0)}var k=new Error("Cannot find module '"+m+"'");throw k.code="MODULE_NOT_FOUND",k}var h=g[m]={exports:{}};b[m][0].call(h.exports,function(o){var p=b[m][1][o];return c(p?p:o)},h,h.exports,e,b,g,d)}return g[m].exports}var a=typeof require=="function"&&require;for(var f=0;f<d.length;f++){c(d[f])}return c})({1:[function(b,c,a){c.exports.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription;c.exports.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;c.exports.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate},{}],2:[function(f,g,d){var c=f("./util");var i=f("eventemitter3");var h=f("./negotiator");var a=f("reliable");function b(k,m,j){if(!(this instanceof b)){return new b(k,m,j)}i.call(this);this.options=c.extend({serialization:"binary",reliable:false},j);this.open=false;this.type="data";this.peer=k;this.provider=m;this.id=this.options.connectionId||b._idPrefix+c.randomToken();this.label=this.options.label||this.id;this.metadata=this.options.metadata;this.serialization=this.options.serialization;this.reliable=this.options.reliable;this._buffer=[];this._buffering=false;this.bufferSize=0;this._chunkedData={};if(this.options._payload){this._peerBrowser=this.options._payload.browser}h.startConnection(this,this.options._payload||{originator:true})}c.inherits(b,i);b._idPrefix="dc_";b.prototype.initialize=function(j){this._dc=this.dataChannel=j;this._configureDataChannel()};b.prototype._configureDataChannel=function(){var j=this;if(c.supports.sctp){this._dc.binaryType="arraybuffer"}this._dc.onopen=function(){c.log("Data channel connection success");j.open=true;j.emit("open")};if(!c.supports.sctp&&this.reliable){this._reliable=new a(this._dc,c.debug)}if(this._reliable){this._reliable.onmessage=function(k){j.emit("data",k)}}else{this._dc.onmessage=function(k){j._handleDataMessage(k)}}this._dc.onclose=function(k){c.log("DataChannel closed for:",j.peer);j.close()}};b.prototype._handleDataMessage=function(p){var j=this;var o=p.data;var m=o.constructor;if(this.serialization==="binary"||this.serialization==="binary-utf8"){if(m===Blob){c.blobToArrayBuffer(o,function(r){o=c.unpack(r);j.emit("data",o)});return}else{if(m===ArrayBuffer){o=c.unpack(o)}else{if(m===String){var n=c.binaryStringToArrayBuffer(o);o=c.unpack(n)}}}}else{if(this.serialization==="json"){o=JSON.parse(o)}}if(o.__peerData){var q=o.__peerData;var k=this._chunkedData[q]||{data:[],count:0,total:o.total};k.data[o.n]=o.data;k.count+=1;if(k.total===k.count){delete this._chunkedData[q];o=new Blob(k.data);this._handleDataMessage({data:o})}this._chunkedData[q]=k;return}this.emit("data",o)};b.prototype.close=function(){if(!this.open){return}this.open=false;h.cleanup(this);this.emit("close")};b.prototype.send=function(o,n){if(!this.open){this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this._reliable){this._reliable.send(o);return}var m=this;if(this.serialization==="json"){this._bufferedSend(JSON.stringify(o))}else{if(this.serialization==="binary"||this.serialization==="binary-utf8"){var k=c.pack(o);var j=c.chunkedBrowsers[this._peerBrowser]||c.chunkedBrowsers[c.browser];if(j&&!n&&k.size>c.chunkedMTU){this._sendChunks(k);return}if(!c.supports.sctp){c.blobToBinaryString(k,function(p){m._bufferedSend(p)})}else{if(!c.supports.binaryBlob){c.blobToArrayBuffer(k,function(p){m._bufferedSend(p)})}else{this._bufferedSend(k)}}}else{this._bufferedSend(o)}}};b.prototype._bufferedSend=function(j){if(this._buffering||!this._trySend(j)){this._buffer.push(j);this.bufferSize=this._buffer.length}};b.prototype._trySend=function(m){try{this._dc.send(m)}catch(k){this._buffering=true;var j=this;setTimeout(function(){j._buffering=false;j._tryBuffer()},100);return false}return true};b.prototype._tryBuffer=function(){if(this._buffer.length===0){return}var j=this._buffer[0];if(this._trySend(j)){this._buffer.shift();this.bufferSize=this._buffer.length;this._tryBuffer()}};b.prototype._sendChunks=function(j){var n=c.chunk(j);for(var k=0,m=n.length;k<m;k+=1){var j=n[k];this.send(j,true)}};b.prototype.handleMessage=function(j){var k=j.payload;switch(j.type){case"ANSWER":this._peerBrowser=k.browser;h.handleSDP(j.type,this,k.sdp);break;case"CANDIDATE":h.handleCandidate(this,k.candidate);break;default:c.warn("Unrecognized message type:",j.type,"from peer:",this.peer);break}};g.exports=b},{"./negotiator":5,"./util":8,eventemitter3:9,reliable:12}],3:[function(b,c,a){window.Socket=b("./socket");window.MediaConnection=b("./mediaconnection");window.DataConnection=b("./dataconnection");window.Peer=b("./peer");window.RTCPeerConnection=b("./adapter").RTCPeerConnection;window.RTCSessionDescription=b("./adapter").RTCSessionDescription;window.RTCIceCandidate=b("./adapter").RTCIceCandidate;window.Negotiator=b("./negotiator");window.util=b("./util");window.BinaryPack=b("js-binarypack")},{"./adapter":1,"./dataconnection":2,"./mediaconnection":4,"./negotiator":5,"./peer":6,"./socket":7,"./util":8,"js-binarypack":10}],4:[function(d,f,c){var a=d("./util");var h=d("eventemitter3");var g=d("./negotiator");function b(j,k,i){if(!(this instanceof b)){return new b(j,k,i)}h.call(this);this.options=a.extend({},i);this.open=false;this.type="media";this.peer=j;this.provider=k;this.metadata=this.options.metadata;this.localStream=this.options._stream;this.id=this.options.connectionId||b._idPrefix+a.randomToken();if(this.localStream){g.startConnection(this,{_stream:this.localStream,originator:true})}}a.inherits(b,h);b._idPrefix="mc_";b.prototype.addStream=function(i){a.log("Receiving stream",i);this.remoteStream=i;this.emit("stream",i)};b.prototype.handleMessage=function(i){var j=i.payload;switch(i.type){case"ANSWER":g.handleSDP(i.type,this,j.sdp);this.open=true;break;case"CANDIDATE":g.handleCandidate(this,j.candidate);break;default:a.warn("Unrecognized message type:",i.type,"from peer:",this.peer);break}};b.prototype.answer=function(n){if(this.localStream){a.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this.options._payload._stream=n;this.localStream=n;g.startConnection(this,this.options._payload);var m=this.provider._getMessages(this.id);for(var j=0,k=m.length;j<k;j+=1){this.handleMessage(m[j])}this.open=true};b.prototype.close=function(){if(!this.open){return}this.open=false;g.cleanup(this);this.emit("close")};f.exports=b},{"./negotiator":5,"./util":8,eventemitter3:9}],5:[function(c,f,b){var a=c("./util");var d=c("./adapter").RTCPeerConnection;var i=c("./adapter").RTCSessionDescription;var h=c("./adapter").RTCIceCandidate;var g={pcs:{data:{},media:{}},queue:[]};g._idPrefix="pc_";g.startConnection=function(k,o){var n=g._getPeerConnection(k,o);if(k.type==="media"&&o._stream){n.addStream(o._stream)}k.pc=k.peerConnection=n;if(o.originator){if(k.type==="data"){var m={};if(!a.supports.sctp){m={reliable:o.reliable}}var j=n.createDataChannel(k.label,m);k.initialize(j)}if(!a.supports.onnegotiationneeded){g._makeOffer(k)}}else{g.handleSDP("OFFER",k,o.sdp)}};g._getPeerConnection=function(j,n){if(!g.pcs[j.type]){a.error(j.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere.")}if(!g.pcs[j.type][j.peer]){g.pcs[j.type][j.peer]={}}var m=g.pcs[j.type][j.peer];var k;if(n.pc){k=g.pcs[j.type][j.peer][n.pc]}if(!k||k.signalingState!=="stable"){k=g._startPeerConnection(j)}return k};g._startPeerConnection=function(j){a.log("Creating RTCPeerConnection.");var n=g._idPrefix+a.randomToken();var m={};if(j.type==="data"&&!a.supports.sctp){m={optional:[{RtpDataChannels:true}]}}else{if(j.type==="media"){m={optional:[{DtlsSrtpKeyAgreement:true}]}}}var k=new d(j.provider.options.config,m);g.pcs[j.type][j.peer][n]=k;g._setupListeners(j,k,n);return k};g._setupListeners=function(k,m,n){var j=k.peer;var o=k.id;var p=k.provider;a.log("Listening for ICE candidates.");m.onicecandidate=function(q){if(q.candidate){a.log("Received ICE candidates for:",k.peer);p.socket.send({type:"CANDIDATE",payload:{candidate:q.candidate,type:k.type,connectionId:k.id},dst:j})}};m.oniceconnectionstatechange=function(){switch(m.iceConnectionState){case"disconnected":case"failed":a.log("iceConnectionState is disconnected, closing connections to "+j);k.close();break;case"completed":m.onicecandidate=a.noop;break}};m.onicechange=m.oniceconnectionstatechange;a.log("Listening for `negotiationneeded`");m.onnegotiationneeded=function(){a.log("`negotiationneeded` triggered");if(m.signalingState=="stable"){g._makeOffer(k)}else{a.log("onnegotiationneeded triggered when not stable. Is another connection being established?")}};a.log("Listening for data channel");m.ondatachannel=function(r){a.log("Received data channel");var q=r.channel;var s=p.getConnection(j,o);s.initialize(q)};a.log("Listening for remote stream");m.onaddstream=function(q){a.log("Received remote stream");var s=q.stream;var r=p.getConnection(j,o);if(r.type==="media"){r.addStream(s)}}};g.cleanup=function(j){a.log("Cleaning up PeerConnection to "+j.peer);var k=j.pc;if(!!k&&(k.readyState!=="closed"||k.signalingState!=="closed")){k.close();j.pc=null}};g._makeOffer=function(j){var k=j.pc;k.createOffer(function(m){a.log("Created offer.");if(!a.supports.sctp&&j.type==="data"&&j.reliable){m.sdp=Reliable.higherBandwidthSDP(m.sdp)}k.setLocalDescription(m,function(){a.log("Set localDescription: offer","for:",j.peer);j.provider.socket.send({type:"OFFER",payload:{sdp:m,type:j.type,label:j.label,connectionId:j.id,reliable:j.reliable,serialization:j.serialization,metadata:j.metadata,browser:a.browser},dst:j.peer})},function(n){j.provider.emitError("webrtc",n);a.log("Failed to setLocalDescription, ",n)})},function(m){j.provider.emitError("webrtc",m);a.log("Failed to createOffer, ",m)},j.options.constraints)};g._makeAnswer=function(j){var k=j.pc;k.createAnswer(function(m){a.log("Created answer.");if(!a.supports.sctp&&j.type==="data"&&j.reliable){m.sdp=Reliable.higherBandwidthSDP(m.sdp)}k.setLocalDescription(m,function(){a.log("Set localDescription: answer","for:",j.peer);j.provider.socket.send({type:"ANSWER",payload:{sdp:m,type:j.type,connectionId:j.id,browser:a.browser},dst:j.peer})},function(n){j.provider.emitError("webrtc",n);a.log("Failed to setLocalDescription, ",n)})},function(m){j.provider.emitError("webrtc",m);a.log("Failed to create answer, ",m)})};g.handleSDP=function(n,k,j){j=new i(j);var m=k.pc;a.log("Setting remote description",j);m.setRemoteDescription(j,function(){a.log("Set remoteDescription:",n,"for:",k.peer);if(n==="OFFER"){g._makeAnswer(k)}},function(o){k.provider.emitError("webrtc",o);a.log("Failed to setRemoteDescription, ",o)})};g.handleCandidate=function(k,n){var m=n.candidate;var j=n.sdpMLineIndex;k.pc.addIceCandidate(new h({sdpMLineIndex:j,candidate:m}));a.log("Added ICE candidate for:",k.peer)};f.exports=g},{"./adapter":1,"./util":8}],6:[function(d,b,f){var h=d("./util");var j=d("eventemitter3");var a=d("./socket");var c=d("./mediaconnection");var g=d("./dataconnection");function i(m,k){if(!(this instanceof i)){return new i(m,k)}j.call(this);if(m&&m.constructor==Object){k=m;m=undefined}else{if(m){m=m.toString()}}k=h.extend({debug:0,host:h.CLOUD_HOST,port:h.CLOUD_PORT,key:"peerjs",path:"/",token:h.randomToken(),config:h.defaultConfig},k);this.options=k;if(k.host==="/"){k.host=window.location.hostname}if(k.path[0]!=="/"){k.path="/"+k.path}if(k.path[k.path.length-1]!=="/"){k.path+="/"}if(k.secure===undefined&&k.host!==h.CLOUD_HOST){k.secure=h.isSecure()}if(k.logFunction){h.setLogFunction(k.logFunction)}h.setLogLevel(k.debug);if(!h.supports.audioVideo&&!h.supports.data){this._delayedAbort("browser-incompatible","The current browser does not support WebRTC");return}if(!h.validateId(m)){this._delayedAbort("invalid-id",'ID "'+m+'" is invalid');return}if(!h.validateKey(k.key)){this._delayedAbort("invalid-key",'API KEY "'+k.key+'" is invalid');return}if(k.secure&&k.host==="0.peerjs.com"){this._delayedAbort("ssl-unavailable","The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS.");return}this.destroyed=false;this.disconnected=false;this.open=false;this.connections={};this._lostMessages={};this._initializeServerConnection();if(m){this._initialize(m)}else{this._retrieveId()}}h.inherits(i,j);i.prototype._initializeServerConnection=function(){var k=this;this.socket=new a(this.options.secure,this.options.host,this.options.port,this.options.path,this.options.key);this.socket.on("message",function(m){k._handleMessage(m)});this.socket.on("error",function(m){k._abort("socket-error",m)});this.socket.on("disconnected",function(){if(!k.disconnected){k.emitError("network","Lost connection to server.");k.disconnect()}});this.socket.on("close",function(){if(!k.disconnected){k._abort("socket-closed","Underlying socket is already closed.")}})};i.prototype._retrieveId=function(k){var m=this;var o=new XMLHttpRequest();var p=this.options.secure?"https://":"http://";var n=p+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/id";var q="?ts="+new Date().getTime()+""+Math.random();n+=q;o.open("get",n,true);o.onerror=function(s){h.error("Error retrieving ID",s);var r="";if(m.options.path==="/"&&m.options.host!==h.CLOUD_HOST){r=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."}m._abort("server-error","Could not get an ID from the server."+r)};o.onreadystatechange=function(){if(o.readyState!==4){return}if(o.status!==200){o.onerror();return}m._initialize(o.responseText)};o.send(null)};i.prototype._initialize=function(k){this.id=k;this.socket.start(this.id,this.options.token)};i.prototype._handleMessage=function(u){var r=u.type;var s=u.payload;var q=u.src;var m;switch(r){case"OPEN":this.emit("open",this.id);this.open=true;break;case"ERROR":this._abort("server-error",s.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":h.log("Received leave message from",q);this._cleanupPeer(q);break;case"EXPIRE":this.emitError("peer-unavailable","Could not connect to peer "+q);break;case"OFFER":var p=s.connectionId;m=this.getConnection(q,p);if(m){h.warn("Offer received for existing Connection ID:",p)}else{if(s.type==="media"){m=new c(q,this,{connectionId:p,_payload:s,metadata:s.metadata});this._addConnection(q,m);this.emit("call",m)}else{if(s.type==="data"){m=new g(q,this,{connectionId:p,_payload:s,metadata:s.metadata,label:s.label,serialization:s.serialization,reliable:s.reliable});this._addConnection(q,m);this.emit("connection",m)}else{h.warn("Received malformed connection type:",s.type);return}}var n=this._getMessages(p);for(var o=0,t=n.length;o<t;o+=1){m.handleMessage(n[o])}}break;default:if(!s){h.warn("You received a malformed message from "+q+" of type "+r);return}var k=s.connectionId;m=this.getConnection(q,k);if(m&&m.pc){m.handleMessage(u)}else{if(k){this._storeMessage(k,u)}else{h.warn("You received an unrecognized message:",u)}}break}};i.prototype._storeMessage=function(m,k){if(!this._lostMessages[m]){this._lostMessages[m]=[]}this._lostMessages[m].push(k)};i.prototype._getMessages=function(m){var k=this._lostMessages[m];if(k){delete this._lostMessages[m];return k}else{return[]}};i.prototype.connect=function(n,m){if(this.disconnected){h.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available.");this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");return}var k=new g(n,this,m);this._addConnection(n,k);return k};i.prototype.call=function(n,o,k){if(this.disconnected){h.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect.");this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");return}if(!o){h.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}k=k||{};k._stream=o;var m=new c(n,this,k);this._addConnection(n,m);return m};i.prototype._addConnection=function(m,k){if(!this.connections[m]){this.connections[m]=[]}this.connections[m].push(k)};i.prototype.getConnection=function(o,p){var m=this.connections[o];if(!m){return null}for(var k=0,n=m.length;k<n;k++){if(m[k].id===p){return m[k]}}return null};i.prototype._delayedAbort=function(m,n){var k=this;h.setZeroTimeout(function(){k._abort(m,n)})};i.prototype._abort=function(k,m){h.error("Aborting!");if(!this._lastServerId){this.destroy()}else{this.disconnect()}this.emitError(k,m)};i.prototype.emitError=function(k,m){h.error("Error:",m);if(typeof m==="string"){m=new Error(m)}m.type=k;this.emit("error",m)};i.prototype.destroy=function(){if(!this.destroyed){this._cleanup();this.disconnect();this.destroyed=true}};i.prototype._cleanup=function(){if(this.connections){var k=Object.keys(this.connections);for(var m=0,n=k.length;m<n;m++){this._cleanupPeer(k[m])}}this.emit("close")};i.prototype._cleanupPeer=function(o){var m=this.connections[o];for(var k=0,n=m.length;k<n;k+=1){m[k].close()}};i.prototype.disconnect=function(){var k=this;h.setZeroTimeout(function(){if(!k.disconnected){k.disconnected=true;k.open=false;if(k.socket){k.socket.close()}k.emit("disconnected",k.id);k._lastServerId=k.id;k.id=null}})};i.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed){h.log("Attempting reconnection to server with ID "+this._lastServerId);this.disconnected=false;this._initializeServerConnection();this._initialize(this._lastServerId)}else{if(this.destroyed){throw new Error("This peer cannot reconnect to the server. It has already been destroyed.")}else{if(!this.disconnected&&!this.open){h.error("In a hurry? We're still trying to make the initial connection!")}else{throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!")}}}};i.prototype.listAllPeers=function(k){k=k||function(){};var m=this;var o=new XMLHttpRequest();var p=this.options.secure?"https://":"http://";var n=p+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/peers";var q="?ts="+new Date().getTime()+""+Math.random();n+=q;o.open("get",n,true);o.onerror=function(r){m._abort("server-error","Could not get peers from the server.");k([])};o.onreadystatechange=function(){if(o.readyState!==4){return}if(o.status===401){var r="";if(m.options.host!==h.CLOUD_HOST){r="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key."}else{r="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature."}k([]);throw new Error("It doesn't look like you have permission to list peers IDs. "+r)}else{if(o.status!==200){k([])}else{k(JSON.parse(o.responseText))}}};o.send(null)};b.exports=i},{"./dataconnection":2,"./mediaconnection":4,"./socket":7,"./util":8,eventemitter3:9}],7:[function(d,f,c){var b=d("./util");var g=d("eventemitter3");function a(o,m,h,n,i){if(!(this instanceof a)){return new a(o,m,h,n,i)}g.call(this);this.disconnected=false;this._queue=[];var k=o?"https://":"http://";var j=o?"wss://":"ws://";this._httpUrl=k+m+":"+h+n+i;this._wsUrl=j+m+":"+h+n+"peerjs?key="+i}b.inherits(a,g);a.prototype.start=function(i,h){this.id=i;this._httpUrl+="/"+i+"/"+h;this._wsUrl+="&id="+i+"&token="+h;this._startXhrStream();this._startWebSocket()};a.prototype._startWebSocket=function(i){var h=this;if(this._socket){return}this._socket=new WebSocket(this._wsUrl);this._socket.onmessage=function(j){try{var k=JSON.parse(j.data)}catch(m){b.log("Invalid server message",j.data);return}h.emit("message",k)};this._socket.onclose=function(j){b.log("Socket closed.");h.disconnected=true;h.emit("disconnected")};this._socket.onopen=function(){if(h._timeout){clearTimeout(h._timeout);setTimeout(function(){h._http.abort();h._http=null},5000)}h._sendQueuedMessages();b.log("Socket open")}};a.prototype._startXhrStream=function(j){try{var h=this;this._http=new XMLHttpRequest();this._http._index=1;this._http._streamIndex=j||0;this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,true);this._http.onerror=function(){clearTimeout(h._timeout);h.emit("disconnected")};this._http.onreadystatechange=function(){if(this.readyState==2&&this.old){this.old.abort();delete this.old}else{if(this.readyState>2&&this.status===200&&this.responseText){h._handleStream(this)}}};this._http.send(null);this._setHTTPTimeout()}catch(i){b.log("XMLHttpRequest not available; defaulting to WebSockets")}};a.prototype._handleStream=function(j){var m=j.responseText.split("\n");if(j._buffer){while(j._buffer.length>0){var i=j._buffer.shift();var h=m[i];try{h=JSON.parse(h)}catch(n){j._buffer.shift(i);break}this.emit("message",h)}}var k=m[j._index];if(k){j._index+=1;if(j._index===m.length){if(!j._buffer){j._buffer=[]}j._buffer.push(j._index-1)}else{try{k=JSON.parse(k)}catch(n){b.log("Invalid server message",k);return}this.emit("message",k)}}};a.prototype._setHTTPTimeout=function(){var h=this;this._timeout=setTimeout(function(){var i=h._http;if(!h._wsOpen()){h._startXhrStream(i._streamIndex+1);h._http.old=i}else{i.abort()}},25000)};a.prototype._wsOpen=function(){return this._socket&&this._socket.readyState==1};a.prototype._sendQueuedMessages=function(){for(var h=0,j=this._queue.length;h<j;h+=1){this.send(this._queue[h])}};a.prototype.send=function(k){if(this.disconnected){return}if(!this.id){this._queue.push(k);return}if(!k.type){this.emit("error","Invalid message");return}var j=JSON.stringify(k);if(this._wsOpen()){this._socket.send(j)}else{var i=new XMLHttpRequest();var h=this._httpUrl+"/"+k.type.toLowerCase();i.open("post",h,true);i.setRequestHeader("Content-Type","application/json");i.send(j)}};a.prototype.close=function(){if(!this.disconnected&&this._wsOpen()){this._socket.close();this.disconnected=true}};f.exports=a},{"./util":8,eventemitter3:9}],8:[function(d,g,c){var a={iceServers:[{url:"stun:stun.l.google.com:19302"}]};var i=1;var h=d("js-binarypack");var f=d("./adapter").RTCPeerConnection;var b={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:9000,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(k){var j=parseInt(k,10);if(!isNaN(parseInt(k,10))){b.logLevel=j}else{b.logLevel=k?3:0}b.log=b.warn=b.error=b.noop;if(b.logLevel>0){b.error=b._printWith("ERROR")}if(b.logLevel>1){b.warn=b._printWith("WARNING")}if(b.logLevel>2){b.log=b._print}},setLogFunction:function(j){if(j.constructor!==Function){b.warn("The log function you passed in is not a function. Defaulting to regular logs.")}else{b._print=j}},_printWith:function(j){return function(){var k=Array.prototype.slice.call(arguments);k.unshift(j);b._print.apply(b,k)}},_print:function(){var m=false;var n=Array.prototype.slice.call(arguments);n.unshift("PeerJS: ");for(var k=0,j=n.length;k<j;k++){if(n[k] instanceof Error){n[k]="("+n[k].name+") "+n[k].message;m=true}}m?console.error.apply(console,n):console.log.apply(console,n)},defaultConfig:a,browser:(function(){if(window.mozRTCPeerConnection){return"Firefox"}else{if(window.webkitRTCPeerConnection){return"Chrome"}else{if(window.RTCPeerConnection){return"Supported"}else{return"Unsupported"}}}})(),supports:(function(){if(typeof f==="undefined"){return{}}var q=true;var n=true;var o=false;var m=false;var r=!!window.webkitRTCPeerConnection;var t,u;try{t=new f(a,{optional:[{RtpDataChannels:true}]})}catch(s){q=false;n=false}if(q){try{u=t.createDataChannel("_PEERJSTEST")}catch(s){q=false}}if(q){try{u.binaryType="blob";o=true}catch(s){}var k=new f(a,{});try{var p=k.createDataChannel("_PEERJSRELIABLETEST",{});m=p.reliable}catch(s){}k.close()}if(n){n=!!t.addStream}if(!r&&q){var j=new f(a,{optional:[{RtpDataChannels:true}]});j.onnegotiationneeded=function(){r=true;if(b&&b.supports){b.supports.onnegotiationneeded=true}};j.createDataChannel("_PEERJSNEGOTIATIONTEST");setTimeout(function(){j.close()},1000)}if(t){t.close()}return{audioVideo:n,data:q,binaryBlob:o,binary:m,reliable:m,sctp:m,onnegotiationneeded:r}}()),validateId:function(j){return !j||/^[A-Za-z0-9_-]+(?:[ _-][A-Za-z0-9]+)*$/.exec(j)},validateKey:function(j){return !j||/^[A-Za-z0-9_-]+(?:[ _-][A-Za-z0-9]+)*$/.exec(j)},debug:false,inherits:function(k,j){k.super_=j;k.prototype=Object.create(j.prototype,{constructor:{value:k,enumerable:false,writable:true,configurable:true}})},extend:function(j,m){for(var k in m){if(m.hasOwnProperty(k)){j[k]=m[k]}}return j},pack:h.pack,unpack:h.unpack,log:function(){if(b.debug){var m=false;var n=Array.prototype.slice.call(arguments);n.unshift("PeerJS: ");for(var k=0,j=n.length;k<j;k++){if(n[k] instanceof Error){n[k]="("+n[k].name+") "+n[k].message;m=true}}m?console.error.apply(console,n):console.log.apply(console,n)}},setZeroTimeout:(function(n){var k=[];var j="zero-timeout-message";function m(p){k.push(p);n.postMessage(j,"*")}function o(p){if(p.source==n&&p.data==j){if(p.stopPropagation){p.stopPropagation()}if(k.length){k.shift()()}}}if(n.addEventListener){n.addEventListener("message",o,true)}else{if(n.attachEvent){n.attachEvent("onmessage",o)}}return m}(window)),chunk:function(r){var q=[];var n=r.size;var p=index=0;var o=Math.ceil(n/b.chunkedMTU);while(p<n){var k=Math.min(n,p+b.chunkedMTU);var j=r.slice(p,k);var m={__peerData:i,n:index,data:j,total:o};q.push(m);p=k;index+=1}i+=1;return q},blobToArrayBuffer:function(m,j){var k=new FileReader();k.onload=function(n){j(n.target.result)};k.readAsArrayBuffer(m)},blobToBinaryString:function(m,j){var k=new FileReader();k.onload=function(n){j(n.target.result)};k.readAsBinaryString(m)},binaryStringToArrayBuffer:function(m){var j=new Uint8Array(m.length);for(var k=0;k<m.length;k++){j[k]=m.charCodeAt(k)&255}return j.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return location.protocol==="https:"}};g.exports=b},{"./adapter":1,"js-binarypack":10}],9:[function(d,c,f){function n(q,o,p){this.fn=q;this.context=o;this.once=p||false}function m(){}m.prototype._events=undefined;m.prototype.listeners=function i(r){if(!this._events||!this._events[r]){return[]}for(var q=0,p=this._events[r].length,o=[];q<p;q++){o.push(this._events[r][q].fn)}return o};m.prototype.emit=function j(p,r,q,o,A,z){if(!this._events||!this._events[p]){return false}var y=this._events[p],s=y.length,w=arguments.length,v=y[0],x,u,t;if(1===s){if(v.once){this.removeListener(p,v.fn,true)}switch(w){case 1:return v.fn.call(v.context),true;case 2:return v.fn.call(v.context,r),true;case 3:return v.fn.call(v.context,r,q),true;case 4:return v.fn.call(v.context,r,q,o),true;case 5:return v.fn.call(v.context,r,q,o,A),true;case 6:return v.fn.call(v.context,r,q,o,A,z),true}for(u=1,x=new Array(w-1);u<w;u++){x[u-1]=arguments[u]}v.fn.apply(v.context,x)}else{for(u=0;u<s;u++){if(y[u].once){this.removeListener(p,y[u].fn,true)}switch(w){case 1:y[u].fn.call(y[u].context);break;case 2:y[u].fn.call(y[u].context,r);break;case 3:y[u].fn.call(y[u].context,r,q);break;default:if(!x){for(t=1,x=new Array(w-1);t<w;t++){x[t-1]=arguments[t]}}y[u].fn.apply(y[u].context,x)}}}return true};m.prototype.on=function h(q,p,o){if(!this._events){this._events={}}if(!this._events[q]){this._events[q]=[]}this._events[q].push(new n(p,o||this));return this};m.prototype.once=function b(q,p,o){if(!this._events){this._events={}}if(!this._events[q]){this._events[q]=[]}this._events[q].push(new n(p,o||this,true));return this};m.prototype.removeListener=function g(u,s,r){if(!this._events||!this._events[u]){return this}var q=this._events[u],p=[];if(s){for(var o=0,t=q.length;o<t;o++){if(q[o].fn!==s&&q[o].once!==r){p.push(q[o])}}}if(p.length){this._events[u]=p}else{this._events[u]=null}return this};m.prototype.removeAllListeners=function k(o){if(!this._events){return this}if(o){this._events[o]=null}else{this._events={}}return this};m.prototype.off=m.prototype.removeListener;m.prototype.addListener=m.prototype.on;m.prototype.setMaxListeners=function a(){return this};m.EventEmitter=m;m.EventEmitter2=m;m.EventEmitter3=m;if("object"===typeof c&&c.exports){c.exports=m}},{}],10:[function(d,b,g){var c=d("./bufferbuilder").BufferBuilder;var f=d("./bufferbuilder").binaryFeatures;var k={unpack:function(n){var m=new i(n);return m.unpack()},pack:function(n){var o=new h();o.pack(n);var m=o.getBuffer();return m}};b.exports=k;function i(m){this.index=0;this.dataBuffer=m;this.dataView=new Uint8Array(this.dataBuffer);this.length=this.dataBuffer.byteLength}i.prototype.unpack=function(){var p=this.unpack_uint8();if(p<128){var o=p;return o}else{if((p^224)<32){var m=(p^224)-32;return m}}var n;if((n=p^160)<=15){return this.unpack_raw(n)}else{if((n=p^176)<=15){return this.unpack_string(n)}else{if((n=p^144)<=15){return this.unpack_array(n)}else{if((n=p^128)<=15){return this.unpack_map(n)}}}}switch(p){case 192:return null;case 193:return undefined;case 194:return false;case 195:return true;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return undefined;case 213:return undefined;case 214:return undefined;case 215:return undefined;case 216:n=this.unpack_uint16();return this.unpack_string(n);case 217:n=this.unpack_uint32();return this.unpack_string(n);case 218:n=this.unpack_uint16();return this.unpack_raw(n);case 219:n=this.unpack_uint32();return this.unpack_raw(n);case 220:n=this.unpack_uint16();return this.unpack_array(n);case 221:n=this.unpack_uint32();return this.unpack_array(n);case 222:n=this.unpack_uint16();return this.unpack_map(n);case 223:n=this.unpack_uint32();return this.unpack_map(n)}};i.prototype.unpack_uint8=function(){var m=this.dataView[this.index]&255;this.index++;return m};i.prototype.unpack_uint16=function(){var m=this.read(2);var n=((m[0]&255)*256)+(m[1]&255);this.index+=2;return n};i.prototype.unpack_uint32=function(){var m=this.read(4);var n=((m[0]*256+m[1])*256+m[2])*256+m[3];this.index+=4;return n};i.prototype.unpack_uint64=function(){var m=this.read(8);var n=((((((m[0]*256+m[1])*256+m[2])*256+m[3])*256+m[4])*256+m[5])*256+m[6])*256+m[7];this.index+=8;return n};i.prototype.unpack_int8=function(){var m=this.unpack_uint8();return(m<128)?m:m-(1<<8)};i.prototype.unpack_int16=function(){var m=this.unpack_uint16();return(m<32768)?m:m-(1<<16)};i.prototype.unpack_int32=function(){var m=this.unpack_uint32();return(m<Math.pow(2,31))?m:m-Math.pow(2,32)};i.prototype.unpack_int64=function(){var m=this.unpack_uint64();return(m<Math.pow(2,63))?m:m-Math.pow(2,64)};i.prototype.unpack_raw=function(n){if(this.length<this.index+n){throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+n+" "+this.length)}var m=this.dataBuffer.slice(this.index,this.index+n);this.index+=n;return m};i.prototype.unpack_string=function(o){var m=this.read(o);var n=0,q="",r,p;while(n<o){r=m[n];if(r<128){q+=String.fromCharCode(r);n++}else{if((r^192)<32){p=((r^192)<<6)|(m[n+1]&63);q+=String.fromCharCode(p);n+=2}else{p=((r&15)<<12)|((m[n+1]&63)<<6)|(m[n+2]&63);q+=String.fromCharCode(p);n+=3}}}this.index+=o;return q};i.prototype.unpack_array=function(n){var o=new Array(n);for(var m=0;m<n;m++){o[m]=this.unpack()}return o};i.prototype.unpack_map=function(o){var q={};for(var n=0;n<o;n++){var m=this.unpack();var p=this.unpack();q[m]=p}return q};i.prototype.unpack_float=function(){var n=this.unpack_uint32();var m=n>>31;var p=((n>>23)&255)-127;var o=(n&8388607)|8388608;return(m==0?1:-1)*o*Math.pow(2,p-23)};i.prototype.unpack_double=function(){var r=this.unpack_uint32();var p=this.unpack_uint32();var n=r>>31;var q=((r>>20)&2047)-1023;var m=(r&1048575)|1048576;var o=m*Math.pow(2,q-20)+p*Math.pow(2,q-52);return(n==0?1:-1)*o};i.prototype.read=function(n){var m=this.index;if(m+n<=this.length){return this.dataView.subarray(m,m+n)}else{throw new Error("BinaryPackFailure: read index out of range")}};function h(){this.bufferBuilder=new c()}h.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};h.prototype.pack=function(o){var n=typeof(o);if(n=="string"){this.pack_string(o)}else{if(n=="number"){if(Math.floor(o)===o){this.pack_integer(o)}else{this.pack_double(o)}}else{if(n=="boolean"){if(o===true){this.bufferBuilder.append(195)}else{if(o===false){this.bufferBuilder.append(194)}}}else{if(n=="undefined"){this.bufferBuilder.append(192)}else{if(n=="object"){if(o===null){this.bufferBuilder.append(192)}else{var m=o.constructor;if(m==Array){this.pack_array(o)}else{if(m==Blob||m==File){this.pack_bin(o)}else{if(m==ArrayBuffer){if(f.useArrayBufferView){this.pack_bin(new Uint8Array(o))}else{this.pack_bin(o)}}else{if("BYTES_PER_ELEMENT" in o){if(f.useArrayBufferView){this.pack_bin(new Uint8Array(o.buffer))}else{this.pack_bin(o.buffer)}}else{if(m==Object){this.pack_object(o)}else{if(m==Date){this.pack_string(o.toString())}else{if(typeof o.toBinaryPack=="function"){this.bufferBuilder.append(o.toBinaryPack())}else{throw new Error('Type "'+m.toString()+'" not yet supported')}}}}}}}}}else{throw new Error('Type "'+n+'" not yet supported')}}}}}this.bufferBuilder.flush()};h.prototype.pack_bin=function(m){var n=m.length||m.byteLength||m.size;if(n<=15){this.pack_uint8(160+n)}else{if(n<=65535){this.bufferBuilder.append(218);this.pack_uint16(n)}else{if(n<=4294967295){this.bufferBuilder.append(219);this.pack_uint32(n)}else{throw new Error("Invalid length")}}}this.bufferBuilder.append(m)};h.prototype.pack_string=function(n){var m=j(n);if(m<=15){this.pack_uint8(176+m)}else{if(m<=65535){this.bufferBuilder.append(216);this.pack_uint16(m)}else{if(m<=4294967295){this.bufferBuilder.append(217);this.pack_uint32(m)}else{throw new Error("Invalid length")}}}this.bufferBuilder.append(n)};h.prototype.pack_array=function(n){var o=n.length;if(o<=15){this.pack_uint8(144+o)}else{if(o<=65535){this.bufferBuilder.append(220);this.pack_uint16(o)}else{if(o<=4294967295){this.bufferBuilder.append(221);this.pack_uint32(o)}else{throw new Error("Invalid length")}}}for(var m=0;m<o;m++){this.pack(n[m])}};h.prototype.pack_integer=function(m){if(-32<=m&&m<=127){this.bufferBuilder.append(m&255)}else{if(0<=m&&m<=255){this.bufferBuilder.append(204);this.pack_uint8(m)}else{if(-128<=m&&m<=127){this.bufferBuilder.append(208);this.pack_int8(m)}else{if(0<=m&&m<=65535){this.bufferBuilder.append(205);this.pack_uint16(m)}else{if(-32768<=m&&m<=32767){this.bufferBuilder.append(209);this.pack_int16(m)}else{if(0<=m&&m<=4294967295){this.bufferBuilder.append(206);this.pack_uint32(m)}else{if(-2147483648<=m&&m<=2147483647){this.bufferBuilder.append(210);this.pack_int32(m)}else{if(-9223372036854776000<=m&&m<=9223372036854776000){this.bufferBuilder.append(211);this.pack_int64(m)}else{if(0<=m&&m<=18446744073709552000){this.bufferBuilder.append(207);this.pack_uint64(m)}else{throw new Error("Invalid integer")}}}}}}}}}};h.prototype.pack_double=function(o){var n=0;if(o<0){n=1;o=-o}var t=Math.floor(Math.log(o)/Math.LN2);var s=o/Math.pow(2,t)-1;var q=Math.floor(s*Math.pow(2,52));var m=Math.pow(2,32);var r=(n<<31)|((t+1023)<<20)|(q/m)&1048575;var p=q%m;this.bufferBuilder.append(203);this.pack_int32(r);this.pack_int32(p)};h.prototype.pack_object=function(o){var n=Object.keys(o);var m=n.length;if(m<=15){this.pack_uint8(128+m)}else{if(m<=65535){this.bufferBuilder.append(222);this.pack_uint16(m)}else{if(m<=4294967295){this.bufferBuilder.append(223);this.pack_uint32(m)}else{throw new Error("Invalid length")}}}for(var p in o){if(o.hasOwnProperty(p)){this.pack(p);this.pack(o[p])}}};h.prototype.pack_uint8=function(m){this.bufferBuilder.append(m)};h.prototype.pack_uint16=function(m){this.bufferBuilder.append(m>>8);this.bufferBuilder.append(m&255)};h.prototype.pack_uint32=function(m){var o=m&4294967295;this.bufferBuilder.append((o&4278190080)>>>24);this.bufferBuilder.append((o&16711680)>>>16);this.bufferBuilder.append((o&65280)>>>8);this.bufferBuilder.append((o&255))};h.prototype.pack_uint64=function(n){var o=n/Math.pow(2,32);var m=n%Math.pow(2,32);this.bufferBuilder.append((o&4278190080)>>>24);this.bufferBuilder.append((o&16711680)>>>16);this.bufferBuilder.append((o&65280)>>>8);this.bufferBuilder.append((o&255));this.bufferBuilder.append((m&4278190080)>>>24);this.bufferBuilder.append((m&16711680)>>>16);this.bufferBuilder.append((m&65280)>>>8);this.bufferBuilder.append((m&255))};h.prototype.pack_int8=function(m){this.bufferBuilder.append(m&255)};h.prototype.pack_int16=function(m){this.bufferBuilder.append((m&65280)>>8);this.bufferBuilder.append(m&255)};h.prototype.pack_int32=function(m){this.bufferBuilder.append((m>>>24)&255);this.bufferBuilder.append((m&16711680)>>>16);this.bufferBuilder.append((m&65280)>>>8);this.bufferBuilder.append((m&255))};h.prototype.pack_int64=function(n){var o=Math.floor(n/Math.pow(2,32));var m=n%Math.pow(2,32);this.bufferBuilder.append((o&4278190080)>>>24);this.bufferBuilder.append((o&16711680)>>>16);this.bufferBuilder.append((o&65280)>>>8);this.bufferBuilder.append((o&255));this.bufferBuilder.append((m&4278190080)>>>24);this.bufferBuilder.append((m&16711680)>>>16);this.bufferBuilder.append((m&65280)>>>8);this.bufferBuilder.append((m&255))};function a(n){var o=n.charCodeAt(0);if(o<=2047){return"00"}if(o<=65535){return"000"}if(o<=2097151){return"0000"}if(o<=67108863){return"00000"}return"000000"}function j(m){if(m.length>600){return(new Blob([m])).size}else{return m.replace(/[^\u0000-\u007F]/g,a).length}}},{"./bufferbuilder":11}],11:[function(d,f,b){var a={};a.useBlobBuilder=(function(){try{new Blob([]);return false}catch(h){return true}})();a.useArrayBufferView=!a.useBlobBuilder&&(function(){try{return(new Blob([new Uint8Array([])])).size===0}catch(h){return true}})();f.exports.binaryFeatures=a;var g=f.exports.BlobBuilder;if(typeof window!="undefined"){g=f.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder}function c(){this._pieces=[];this._parts=[]}c.prototype.append=function(h){if(typeof h==="number"){this._pieces.push(h)}else{this.flush();this._parts.push(h)}};c.prototype.flush=function(){if(this._pieces.length>0){var h=new Uint8Array(this._pieces);if(!a.useArrayBufferView){h=h.buffer}this._parts.push(h);this._pieces=[]}};c.prototype.getBuffer=function(){this.flush();if(a.useBlobBuilder){var h=new g();for(var j=0,k=this._parts.length;j<k;j++){h.append(this._parts[j])}return h.getBlob()}else{return new Blob(this._parts)}};f.exports.BufferBuilder=c},{}],12:[function(d,f,c){var b=d("./util");function a(g,h){if(!(this instanceof a)){return new a(g)}this._dc=g;b.debug=h;this._outgoing={};this._incoming={};this._received={};this._window=1000;this._mtu=500;this._interval=0;this._count=0;this._queue=[];this._setupDC()}a.prototype.send=function(g){var h=b.pack(g);if(h.size<this._mtu){this._handleSend(["no",h]);return}this._outgoing[this._count]={ack:0,chunks:this._chunk(h)};if(b.debug){this._outgoing[this._count].timer=new Date()}this._sendWindowedChunks(this._count);this._count+=1};a.prototype._setupInterval=function(){var g=this;this._timeout=setInterval(function(){var k=g._queue.shift();if(k._multiple){for(var h=0,j=k.length;h<j;h+=1){g._intervalSend(k[h])}}else{g._intervalSend(k)}},this._interval)};a.prototype._intervalSend=function(h){var g=this;h=b.pack(h);b.blobToBinaryString(h,function(i){g._dc.send(i)});if(g._queue.length===0){clearTimeout(g._timeout);g._timeout=null}};a.prototype._processAcks=function(){for(var g in this._outgoing){if(this._outgoing.hasOwnProperty(g)){this._sendWindowedChunks(g)}}};a.prototype._handleSend=function(m){var g=true;for(var h=0,j=this._queue.length;h<j;h+=1){var k=this._queue[h];if(k===m){g=false}else{if(k._multiple&&k.indexOf(m)!==-1){g=false}}}if(g){this._queue.push(m);if(!this._timeout){this._setupInterval()}}};a.prototype._setupDC=function(){var g=this;this._dc.onmessage=function(j){var k=j.data;var h=k.constructor;if(h===String){var i=b.binaryStringToArrayBuffer(k);k=b.unpack(i);g._handleMessage(k)}}};a.prototype._handleMessage=function(i){var g=i[1];var j=this._incoming[g];var p=this._outgoing[g];var m;switch(i[0]){case"no":var r=g;if(!!r){this.onmessage(b.unpack(r))}break;case"end":m=j;this._received[g]=i[2];if(!m){break}this._ack(g);break;case"ack":m=p;if(!!m){var q=i[2];m.ack=Math.max(q,m.ack);if(m.ack>=m.chunks.length){b.log("Time: ",new Date()-m.timer);delete this._outgoing[g]}else{this._processAcks()}}break;case"chunk":m=j;if(!m){var k=this._received[g];if(k===true){break}m={ack:["ack",g,0],chunks:[]};this._incoming[g]=m}var h=i[2];var o=i[3];m.chunks[h]=new Uint8Array(o);if(h===m.ack[2]){this._calculateNextAck(g)}this._ack(g);break;default:this._handleSend(i);break}};a.prototype._chunk=function(n){var m=[];var j=n.size;var k=0;while(k<j){var h=Math.min(j,k+this._mtu);var g=n.slice(k,h);var i={payload:g};m.push(i);k=h}b.log("Created",m.length,"chunks.");return m};a.prototype._ack=function(h){var g=this._incoming[h].ack;if(this._received[h]===g[2]){this._complete(h);this._received[h]=true}this._handleSend(g)};a.prototype._calculateNextAck=function(m){var j=this._incoming[m];var k=j.chunks;for(var g=0,h=k.length;g<h;g+=1){if(k[g]===undefined){j.ack[2]=g;return}}j.ack[2]=k.length};a.prototype._sendWindowedChunks=function(n){b.log("sendWindowedChunks for: ",n);var k=this._outgoing[n];var j=k.chunks;var m=[];var g=Math.min(k.ack+this._window,j.length);for(var h=k.ack;h<g;h+=1){if(!j[h].sent||h===k.ack){j[h].sent=true;m.push(["chunk",n,h,j[h].payload])}}if(k.ack+this._window>=j.length){m.push(["end",n,j.length])}m._multiple=true;this._handleSend(m)};a.prototype._complete=function(j){b.log("Completed called for",j);var g=this;var i=this._incoming[j].chunks;var h=new Blob(i);b.blobToArrayBuffer(h,function(k){g.onmessage(b.unpack(k))});delete this._incoming[j]};a.higherBandwidthSDP=function(h){var g=navigator.appVersion.match(/Chrome\/(.*?) /);if(g){g=parseInt(g[1].split(".").shift());if(g<31){var j=h.split("b=AS:30");var i="b=AS:102400";if(j.length>1){return j[0]+i+j[1]}}}return h};a.prototype.onmessage=function(g){};f.exports.Reliable=a},{"./util":13}],13:[function(c,d,b){var f=c("js-binarypack");var a={debug:false,inherits:function(h,g){h.super_=g;h.prototype=Object.create(g.prototype,{constructor:{value:h,enumerable:false,writable:true,configurable:true}})},extend:function(g,i){for(var h in i){if(i.hasOwnProperty(h)){g[h]=i[h]}}return g},pack:f.pack,unpack:f.unpack,log:function(){if(a.debug){var h=[];for(var g=0;g<arguments.length;g++){h[g]=arguments[g]}h.unshift("Reliable: ");console.log.apply(console,h)}},setZeroTimeout:(function(j){var h=[];var g="zero-timeout-message";function i(m){h.push(m);j.postMessage(g,"*")}function k(m){if(m.source==j&&m.data==g){if(m.stopPropagation){m.stopPropagation()}if(h.length){h.shift()()}}}if(j.addEventListener){j.addEventListener("message",k,true)}else{if(j.attachEvent){j.attachEvent("onmessage",k)}}return i}(this)),blobToArrayBuffer:function(i,g){var h=new FileReader();h.onload=function(j){g(j.target.result)};h.readAsArrayBuffer(i)},blobToBinaryString:function(i,g){var h=new FileReader();h.onload=function(j){g(j.target.result)};h.readAsBinaryString(i)},binaryStringToArrayBuffer:function(j){var g=new Uint8Array(j.length);for(var h=0;h<j.length;h++){g[h]=j.charCodeAt(h)&255}return g.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};d.exports=a},{"js-binarypack":10}]},{},[3]);function SecondScreen(d,D,t,C,B,W,ah,A){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var U=SecondScreenUtils.$;var f="\u0002";var s=1;var E=2;var ag=3;var R=5;var al=8;var k=10;var p=12;var ar=15;var ao=17;var ac=18;var X=19;var T=20;var r=21;var v=31;var M=32;var n=33;var an=34;var ab=39;var q=48;var Q=63;var ae=64;var J=65;var h=66;var c=67;var F=101;var ak=102;var af=103;var V=110;var O=112;var at=113;var b=114;var x=115;var j=116;var a=119;var o=75;var ad=76;var P=77;var g=78;var aa=79;var H=80;var G=81;var am=82;var z=83;var au=84;var ai=85;var Z=86;var aq=87;var S=88;var m=89;var I=91;var Y=92;var L=93;var ap=95;var N=96;var y=97;var w=98;var u=this;u.user_data={};u.user_data.comp_id=C;u.user_data.cookie_id=d;u.user_data.heads="[]";u.already_joined=false;u.reconnect_count=0;u.MAX_RECONNECT_COUNT=720;u.chat_hist_recvd=false;u.pending_proactive_chats=[];u.pending_tasks=[];u.active=false;u.inactive_timeout=null;u.idle_timeout=null;u.agent_present=null;u.sess_conf=B;u.bk_svr=B.bk;u._onconnect=[];u._onchatstart=[];u._onchatend=[];u._onprochat=[];u._onagentchat=[];u.last_sent=0;u.last_chat_recv_at=null;u.last_chat_agent="Agent";u.unread_chat_count=0;u.unread_chat_show_interval=null;u.unread_chat_show_helper=0;u.pending_move_timeout=null;u.pushed_evs=W;u.pushed_handlers=ah;u.support_agent_name=null;u.agent_id=null;u.agent_name=null;u.agent_email=null;u.latest_chat_id=null;u.visitor_feedback=0;u.curr_agent_focus=null;u.cur_page_triggers=null;u.online_depts={};u.webrtc_key=null;u.peer=null;u.calltype=null;u.pc_name="";u.pc_email="";u.pc_data=null;u.mobile=false;u.chat_cont_h=null;if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)){U.each(U('meta[name="viewport"]'),function(i,aw){var av=U(aw).attr("content");if(av.indexOf("user-scalable=0")!=-1||av.indexOf("user-scalable=no")!=-1||av.indexOf("user-scalable = 0")!=-1||av.indexOf("user-scalable = no")!=-1){u.mobile=true}})}u.taq_convs=A;u.url_regex=/(https?:\/\/)?([a-z0-9\-]+\.)+([0-9]{1,3}|[a-z]{2}|biz|com|edu|gov|info|name|net|org)(:[0-9]+)?(\/\S*)?(?=\s+|$)/gi;for(var aj=0;aj<u.pushed_handlers.length;aj++){if(u.pushed_handlers[aj][0]=="connect"){u._onconnect.push(u.pushed_handlers[aj][1])}else{if(u.pushed_handlers[aj][0]=="chatstart"){u._onchatstart.push(u.pushed_handlers[aj][1])}else{if(u.pushed_handlers[aj][0]=="chatend"){u._onchatend.push(u.pushed_handlers[aj][1])}else{if(u.pushed_handlers[aj][0]=="prochat"){u._onprochat.push(u.pushed_handlers[aj][1])}else{if(u.pushed_handlers[aj][0]=="agentchat"){u._onagentchat.push(u.pushed_handlers[aj][1])}}}}}}u.pushed_handlers=[];var K=d+"-"+D+"-"+t;u.user_data.visitor_id=K;u.flick_title_interval=null;u.chat_enabled=true;u.chat_enabled_by_agent=false;u.prechat_enabled=false;u.offline_message_disabled=false;u.unavail_greet_enabled=false;if(_ss_track.options.chat_no_min){SecondScreen._write_sess_data("__ss_chat","1")}if(typeof _ss_track.options.chat_show!="undefined"&&_ss_track.options.chat_show==false){u.chat_enabled=false}if(typeof _ss_track.options.disable_chat!="undefined"&&_ss_track.options.disable_chat==true){u.chat_enabled=false}if(typeof _ss_track.options.enable_prechat!="undefined"&&_ss_track.options.enable_prechat==true){if(SecondScreen._read_sess_data("__ss_prechat")==null){u.prechat_enabled=true}}if(typeof _ss_track.options.disable_offline_message!="undefined"&&_ss_track.options.disable_offline_message==true){u.offline_message_disabled=true;if(typeof _ss_track.options.enable_unavail_greet!="undefined"&&_ss_track.options.enable_unavail_greet==true){u.unavail_greet_enabled=true}}if(typeof _ss_track.options.enable_chat_by_agent!="undefined"&&_ss_track.options.enable_chat_by_agent==true){u.chat_enabled_by_agent=true;if(SecondScreen._read_sess_data("__ss_chat")!=null){u.chat_enabled=true}}if(SecondScreen._read_sess_data("__ss_cobrowse")==="1"){u.show_cobrowse_stop()}if("https:"==window.location.protocol){u.ws=new WebSocket("wss://"+u.bk_svr.split(":")[0]+"/")}else{if(u.bk_svr.split(":")[1]=="443"){u.ws=new WebSocket("wss://"+u.bk_svr.split(":")[0]+"/")}else{u.ws=new WebSocket("ws://"+u.bk_svr+"/")}}u.ws.onopen=function(){U(window).on("beforeunload",function(){u.reconnect_count=u.MAX_RECONNECT_COUNT;u.hide_chat_widget();u.ws.close()});u.reconnect_count=0;if(u.already_joined){u.ws.send(String.fromCharCode(s)+u.user_data.visitor_id+f+u.user_data.comp_id+f+u.user_data.heads+f+u.user_data.cookie_id);u.chat_frame.find(".gmg_chat_content .gmg_chat_all div:not(:first-child)").remove();return}u.already_joined=true;if(u.chat_enabled){u.add_chat_widget();if(u.prechat_enabled){u.chat_frame.find(".gmg_chat_online").hide();u.chat_frame.find(".gmg_prechat_online").show()}if(u.offline_message_disabled&&!u.unavail_greet_enabled){u.hide_chat_widget()}}u.ws.send(String.fromCharCode(s)+u.user_data.visitor_id+f+u.user_data.comp_id+f+u.user_data.heads+f+u.user_data.cookie_id);for(var aw=0;aw<u.pushed_evs.length;aw++){u.push_event(u.pushed_evs[aw])}u.pushed_evs=[];for(var aw=0;aw<u._onconnect.length;aw++){(function(){var i=aw;setTimeout(function(){u._onconnect[i](u.new_sess)},0)})()}u.in_mirror=SecondScreen._read_sess_data("__ss_m");if(u.in_mirror){u.start_mirror()}var av=function(){var i=new Date().getTime();if(i-u.active>=30000){u.ws.send(String.fromCharCode(T));u.active=false;u.idle_timeout=setTimeout(function(){u.ws.send(String.fromCharCode(r))},180000)}else{setTimeout(av,30000-(i-u.active))}};U(document).mousemove(function(){if(!u.active){u.ws.send(String.fromCharCode(X));clearTimeout(u.idle_timeout);setTimeout(av,30000)}u.active=new Date().getTime()})};u.ws.onmessage=function(a0){var az=a0.data.charCodeAt(0);if(az==k&&!u.in_mirror){if(typeof(_ss_track.ASK_SCREEN_MIRROR_PERM)!="undefined"&&_ss_track.ASK_SCREEN_MIRROR_PERM){u.ask_and_start_mirror()}else{u.start_mirror()}}else{if(az==o){var aV=a0.data.substr(1);if(aV.length!=0){var aX=u.chat_frame.find(".gmg_chat_all");var aT=u.chat_frame.find(".gmg_chat_wrap");var aW=u.chat_frame.find(".gmg_chat_content");var aM=0;var aK=aV.split(f);var aY;var aJ=false;for(var a5=0;a5<aK.length;a5++){if(aK[a5].charAt(0)=="0"){var aZ=aK[a5].lastIndexOf("|");u.add_chat_message("You",aK[a5].substring(1,aZ))}else{if(aK[a5].charAt(0)=="9"){if(aK[a5].charAt(1)=="-"){u.add_info_message("Chat has ended. <a href='javascript:void(0)' onclick='window.open(\"//"+_ss_track.GMG_SERVER+"/chemail/"+_ss_track.id+"/"+aK[a5].substr(2)+"/"+window.location.hostname+'/","","width=400,height=300,menubar=no,location=no,resizable=yes,scrollbars=yes,status=no")\'>Click here</a> to mail yourself this chat transcript.')}else{u.add_info_message("Chat has ended. <a href='javascript:void(0)' onclick='window.open(\"//"+_ss_track.GMG_SERVER+"/vsrvy/"+_ss_track.id+"/"+aK[a5].substr(1)+"/"+window.location.hostname+'/","","width=400,height=500,menubar=no,location=no,resizable=yes,scrollbars=yes,status=no")\'>Click here</a> to provide your feedback or mail yourself this chat transcript.')}}else{if(aK[a5].charAt(0)=="1"||aK[a5].charAt(0)=="2"){var a1=aK[a5].substring(1);var a9=a1.indexOf("|");var aZ=a1.lastIndexOf("|");if(aK[a5].charAt(0)=="2"){aM=aX.height()+aW.height()}var aR;if(aJ){aR=aY}else{aR=a1.substring(0,a9)}u.add_chat_message(aR,a1.substring((a9+1),aZ));u.last_chat_recv_at=a1.substring(aZ+1);u.last_chat_agent=a1.substring(0,a9)}else{if(aK[a5].charAt(0)=="4"){var aL=aK[a5].substring(1);var aA=aL.indexOf("|");aY=aL.substring(aA+1);u.add_info_message(aY+" has joined the chat")}else{if(aK[a5].charAt(0)=="7"){if(aK[a5].charAt(1)=="1"){aJ=true}else{if(aK[a5].charAt(1)=="2"){aJ=false}}}}}}}}if(u.last_chat_recv_at!=null){u.last_chat_recv_at=new Date(u.last_chat_recv_at*1000);u.update_last_chat_recv_at()}if(aM>0&&aX.children().length>1){aT.css("min-height",aM+"px")}aW.stop().scrollTop(aW[0].scrollHeight)}if(SecondScreen._read_sess_data("__ss_chat")=="1"){u.chat_show()}if(u.pending_proactive_chats.length>0){if(!u.chat_enabled){return}var aX=u.chat_frame.find(".gmg_chat_all");var aT=u.chat_frame.find(".gmg_chat_wrap");var aW=u.chat_frame.find(".gmg_chat_content");var aM=0;for(var a5=0;a5<u.pending_proactive_chats.length;a5++){aM=aX.height()+aW.height();u.add_chat_message(u.pending_proactive_chats[a5][0],u.pending_proactive_chats[a5][1]);for(var a5=0;a5<u._onprochat.length;a5++){(function(){var i=a5;setTimeout(function(){u._onprochat[i]()},0)})()}}if(aM>0&&aX.children().length>1){aT.css("min-height",aM+"px")}u.pending_proactive_chats=[];u.chat_show()}u.chat_hist_recvd=true}else{if(az==aa){if(SecondScreen._read_sess_data("__ss_chat")=="0"||SecondScreen._read_sess_data("__ss_chat")==null){u.chat_show()}SecondScreen._write_sess_data("chatafterprochat",1)}else{if(az==ad){if(!u.chat_enabled&&u.chat_enabled_by_agent){u.chat_enabled=true;u.add_chat_widget()}var a1=a0.data.substr(1);var a9=a1.indexOf("|");var aR,ax;aR=a1.substring(0,a9);ax=a1.substring(a9+1);u.add_chat_message(aR,ax);for(var a5=0;a5<u._onagentchat.length;a5++){(function(){var i=a5;setTimeout(function(){u._onagentchat[i]()},0)})()}if((SecondScreen._read_sess_data("__ss_chat")==null||SecondScreen._read_sess_data("__ss_chat")=="0")&&!!!SecondScreen._read_sess_data("__ss_dont_open_on_agent_chat")){u.chat_show()}u.last_chat_agent=aR;u.last_chat_recv_at=new Date();u.update_last_chat_recv_at();SecondScreen._write_sess_data("chatafterprochat",1);u.play_and_flick("chat");if(window.AndroidInterface){window.AndroidInterface.notifyChat(aR,ax)}}else{if(az==x){u.in_mirror=false;SecondScreen._write_sess_data("__ss_m",0);U(window).off(".__ss");U(document).off(".__ss");clearTimeout(u.mouse_scroll_intr);if(typeof u.diff_intr!="undefined"){clearTimeout(u.diff_intr)}if(typeof u.mirror_client!="undefined"){u.mirror_client.disconnect()}}else{if(az==E){u.agent_present=false;u._check_pending_tasks();if(!u.chat_enabled){return}u.stop_flick();u.chat_frame.find(".gmg_chat_textarea").attr("placeholder","No agents are currently available and hence cannot chat.");u.chat_frame.find(".gmg_chat_textarea").attr("disabled","disabled");if(u.chat_frame.find(".gmg_chat_line").length>0){return}if(u.offline_message_disabled&&!u.unavail_greet_enabled){u.hide_chat_widget();return}if(u.prechat_enabled){u.chat_frame.find(".gmg_prechat_online").hide()}else{u.chat_frame.find(".gmg_chat_online").hide()}if(!u.offline_message_disabled){u.chat_frame.find(".gmg_chat_offline").show();u.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.offline_title)}else{u.chat_frame.find(".gmg_chat_unavail").show();u.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.unavail_title)}if(u.chat_shown){U("iframe.gmg_chat").css("height",u.chat_frame.css("height"))}}else{if(az==ac){u.agent_present=true;u._check_pending_tasks();if(!u.chat_enabled){return}u.chat_frame.find(".gmg_chat_textarea").attr("placeholder",_ss_track.options.msg_hint);u.chat_frame.find(".gmg_chat_textarea").removeAttr("disabled");if(u.chat_frame.find(".gmg_chat_line").length>0){return}if(u.offline_message_disabled&&!u.unavail_greet_enabled){u.show_chat_widget();return}if(u.prechat_enabled){u.chat_frame.find(".gmg_prechat_online").show()}else{u.chat_frame.find(".gmg_chat_online").show()}if(!u.offline_message_disabled){u.chat_frame.find(".gmg_chat_offline").hide()}else{u.chat_frame.find(".gmg_chat_unavail").hide()}if(u.chat_shown){U("iframe.gmg_chat").css("height",u.chat_frame.css("height"))}u.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.online_title)}else{if(az==G){u.chat_frame.find(".gmg_chat_info").text(u.last_chat_agent+" is typing")}else{if(az==z){u.update_last_chat_recv_at()}else{if(az==ar){var ba=a0.data.substr(1).split(",");for(var a5=0;a5<ba.length;a5++){u.online_depts[ba[a5]]=true}u.update_online_depts()}else{if(az==v){var aS=a0.data.substr(1).split(",");for(var a5=0;a5<aS.length;a5++){u.online_depts[aS[a5]]=null}u.update_online_depts()}else{if(az==ai){var aB=a0.data.substr(1);window.location.href=aB}else{if(az==aq){var a7=a0.data.substr(1).split(f);var aD=a7[0];var aR=a7[1];if(a7.length==4){var aC=a7[2];var a6=a7[3]}else{var a6=a7[2];var aC=""}u.agent_id=aD;u.agent_name=aR;u.agent_email=aC;if(_ss_track.options.img_enable){U(".gmg_chat").contents().find(".chat_agent_img_ico").css("background-image","url("+location.protocol+"//"+_ss_track.FE_SERVER+"/agent_img/"+aD+"/"+_taq.id+"/)");u.chat_frame.find(".gmg_agent_name").text(aR||"Agent");u.chat_frame.find(".gmg_agent_name").attr("title",aR||"Agent");u.chat_frame.find(".gmg_agent_img").css("background-image","url("+location.protocol+"//"+_ss_track.FE_SERVER+"/agent_img/"+aD+"/"+_taq.id+"/)");u.chat_frame.find(".gmg_agent_des").text(a6);u.chat_frame.find(".gmg_agent_des").attr("title",a6);u.chat_frame.find(".gmg_agent_info").show()}u.visitor_calloption();u.feedback_status()}else{if(az==ao){SecondScreen._write_sess_data("__ss_support",1);var a7=a0.data.substr(1).split(f);var aD=a7[0];var aR=a7[1];if(a7.length==4){var aC=a7[2];var a6=a7[3]}else{var a6=a7[2];var aC=""}u.agent_id=aD;u.agent_name=aR;u.agent_email=aC;if(_ss_track.options.img_enable){u.last_chat_agent=aR;U(".gmg_chat").contents().find(".chat_agent_img_ico").css("background-image","url("+location.protocol+"//"+_ss_track.FE_SERVER+"/agent_img/"+aD+"/"+_taq.id+"/)");u.chat_frame.find(".gmg_agent_name").text(aR||"Agent");u.chat_frame.find(".gmg_agent_name").attr("title",aR||"Agent");u.chat_frame.find(".gmg_agent_img").css("background-image","url("+location.protocol+"//"+_ss_track.FE_SERVER+"/agent_img/"+aD+"/"+_taq.id+"/)");u.chat_frame.find(".gmg_agent_des").text(a6);u.chat_frame.find(".gmg_agent_des").attr("title",a6);u.chat_frame.find(".gmg_agent_info").show()}u.add_info_message(aR+" has joined the chat");u.visitor_calloption();u.feedback_status();for(var a5=0;a5<u._onchatstart.length;a5++){(function(){var i=a5;setTimeout(function(){u._onchatstart[i](d,u.agent_name,u.agent_email,u.pc_name,u.pc_email,u.pc_data)},0)})()}}else{if(az==g){SecondScreen._write_sess_data("__ss_support",0);for(var a5=0;a5<u._onchatend.length;a5++){(function(){var i=a5;setTimeout(function(){u._onchatend[i](d,u.agent_name,u.agent_email,u.pc_name,u.pc_email)},0)})()}if(u.chat_shown){U("iframe.gmg_chat").css("height",u.chat_frame.css("height"))}}else{if(az==Z){if(a0.data.charAt(1)=="-"){u.latest_chat_id=a0.data.substr(2);u.add_info_message("Chat has ended. <a href='javascript:void(0)' onclick='window.open(\"//"+_ss_track.GMG_SERVER+"/chemail/"+_ss_track.id+"/"+a0.data.substr(2)+"/"+window.location.hostname+'/","","width=400,height=300,menubar=no,location=no,resizable=yes,scrollbars=yes,status=no")\'>Click here</a> to mail yourself this chat transcript.')}else{u.latest_chat_id=a0.data.substr(1);u.add_info_message("Chat has ended. <a href='javascript:void(0)' onclick='window.open(\"//"+_ss_track.GMG_SERVER+"/vsrvy/"+_ss_track.id+"/"+a0.data.substr(1)+"/"+window.location.hostname+'/","","width=400,height=500,menubar=no,location=no,resizable=yes,scrollbars=yes,status=no")\'>Click here</a> to provide your feedback or mail yourself this chat transcript.')}}else{if(az==ab){u.add_info_message(_ss_track.options.busy_msg)}else{if(az==Y){var aw=a0.data.substr(1);console.log("Recieved accept call with key, "+aw);function av(){if(u.webrtc_key==null){window.setTimeout(av,200)}else{var i=u.peer.call(aw,window.localStream,{metadata:{calltype:u.calltype}});u.handle_call(i)}}av()}else{if(az==I){if(!util.supports.audioVideo){var aI=97;u.ws.send(String.fromCharCode(aI));return}if(window.localStream){if(window.localStream.getAudioTracks()[0]){window.localStream.getAudioTracks()[0].stop()}if(window.localStream.getVideoTracks()[0]){window.localStream.getVideoTracks()[0].stop()}}if(u.peer!=null){u.peer.destroy();u.peer=null}u.calltype=null;u.webrtc_key=null;u.initializePeer();function a3(){if(u.webrtc_key==null){window.setTimeout(a3,200)}else{console.log("webrtc_key for visitor-"+f+u.webrtc_key);u.ws.send(String.fromCharCode(N)+u.webrtc_key)}}a3()}else{if(az==L){console.log("received call reject from agent");u.visitor_calloption();if(window.localStream.getAudioTracks()[0]){window.localStream.getAudioTracks()[0].stop()}if(window.localStream.getVideoTracks()[0]){window.localStream.getVideoTracks()[0].stop()}if(window.existingCall){window.existingCall.close()}}else{if(az==S){u.add_info_message(a0.data.substr(1))}else{if(az==Q){u.ask_cobrowse_perm()}else{if(az==c){u.agent_cobrowse_stop()}else{if(az==O){var aH=a0.data.substr(1).split(f);var aQ=parseInt(aH[0]);var aN=parseInt(aH[1]);console.log(aQ,aN);var aG=aQ-U(window).scrollLeft();var aF=aN-U(window).scrollTop();var aE=new MouseEvent("click",{view:window,bubbles:true,cancelable:true,clientX:aG,clientY:aF});var a4=document.elementFromPoint(aG,aF);a4.dispatchEvent(aE);u.curr_agent_focus=a4;var aP=U(a4).prop("nodeName");var a9=U(aP).index(a4);u.ws.send(String.fromCharCode(V)+JSON.stringify([a9,aP]))}else{if(az==at){var a2=parseInt(a0.data.substr(1));console.log(a2);if(u.curr_agent_focus){console.log("here",u.curr_agent_focus);var aU=U(u.curr_agent_focus).val();if(a2==8){U(u.curr_agent_focus).val(aU.slice(0,-1))}else{U(u.curr_agent_focus).val(aU+String.fromCharCode(a2))}U(u.curr_agent_focus).trigger("input")}}else{if(az==b){var ay=parseInt(a0.data.substr(1));console.log(ay);U(window).scrollTop(U(window).scrollTop()+ay)}else{if(az==a){var a8=a0.data.substr(1).split(f);var a9=parseInt(a8[0]);var aO=a8[1];U("select").eq(a9).val(aO);U("select").eq(a9).trigger("change")}}}}}}}}}}}}}}}}}}}}}}}}}}}};u.ws.onclose=function(){if(u.reconnect_count<u.MAX_RECONNECT_COUNT){u.reconnect()}else{u.agent_present=false;if(!u.chat_enabled){return}u.stop_flick();if(u.offline_message_disabled&&!u.unavail_greet_enabled){u.hide_chat_widget();return}if(u.prechat_enabled){u.chat_frame.find(".gmg_prechat_online").hide()}else{u.chat_frame.find(".gmg_chat_online").hide()}if(!u.offline_message_disabled){u.chat_frame.find(".gmg_chat_offline").show();u.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.offline_title)}else{u.chat_frame.find(".gmg_chat_unavail").show();u.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.unavail_title)}if(u.chat_shown){U("iframe.gmg_chat").css("height",u.chat_frame.css("height"))}}}}SecondScreen.prototype.ask_cobrowse_perm=function(){var d=this;var h=SecondScreenUtils.$;var g=64;var c=65;var b=SecondScreen._read_sess_data("__ss_cobrowse");if(b=="-1"){d.ws.send(String.fromCharCode(c))}else{if(b=="1"){d.ws.send(String.fromCharCode(g));d.show_cobrowse_stop()}else{var h=SecondScreenUtils.$;var i=h(window).width();var f=422;if(i>=320&&i<=380){f=280}else{if(i>=381&&i<=480){f=320}}var a='<div id="__gamooga_cobrowse_ask" style="background-color:#F0EFF0; box-shadow:0 0 4px #888; font-size:11px; font-weight:400; left:calc(50% - '+(f/2)+"px); margin:0; padding:0; position:fixed; top:0; width:"+f+'px; z-index:2147483647" bgcolor="#F0EFF0" width="'+f+'"><div style="margin:0; padding:0 20px 10px 20px"><div style="display:inline-block; float:left; margin:15px 15px 0 0; padding:0; position:relative"><img src="//'+_ss_track.FE_SERVER+'/static/images/support.png" style="max-height:65px; max-width:65px"></div><div style="color:#000; display:inline-block; line-height:1.4em; margin:0; padding:10px 0 0 0; position:relative; text-align:left; width:calc(100% - 80px)" align="left" width="calc(100% - 80px)"><span style="color:#000; font-family:\'Open Sans\', sans-serif; font-size:14px; font-weight:700; line-height:1.4em; margin-bottom:5px; text-align:left" align="left">Do you want the agent to control this page?</span><p style="font-family:\'Open Sans\', sans-serif; font-size:12px; line-height:1.4em; margin:10px 0; padding:0; text-align:left" align="left">You can turn off this permission any time.</p></div><div style="clear: both;"><div style="float:right; margin:0; padding:0"><button style="background:linear-gradient(to bottom, #64b4f4, #0084f6); border:1px solid #42a2f2; border-radius:4px; box-shadow:none; box-sizing:border-box; color:#fff; cursor:pointer; display:inline-block; font-family:Arial; font-size:14px; font-weight:normal; height:26px; line-height:1.1em; margin:0; margin-right:20px; padding:5px; text-shadow:none; text-transform:none; width:90px" height="26" width="90" id="__gamooga_cobrowse_allow">Allow</button><button style="background:#FFF; border:1px solid #42a2f2; border-color:#CCC; border-radius:4px; box-shadow:none; box-sizing:border-box; color:#000; cursor:pointer; display:inline-block; font-family:Arial; font-size:14px; font-weight:normal; height:26px; line-height:1.1em; margin:0; padding:5px; text-shadow:none; text-transform:none; width:100px" height="26" width="100" id="__gamooga_cobrowse_deny">Deny</button></div><div style="clear:both"></div></div></div></div>';h("body").append(a);h("#__gamooga_cobrowse_deny").click(function(){h("#__gamooga_cobrowse_ask").remove();d.ws.send(String.fromCharCode(c));SecondScreen._write_sess_data("__ss_cobrowse","-1")});h("#__gamooga_cobrowse_allow").click(function(){h("#__gamooga_cobrowse_ask").remove();d.ws.send(String.fromCharCode(g));SecondScreen._write_sess_data("__ss_cobrowse","1");d.show_cobrowse_stop()})}}};SecondScreen.prototype.show_cobrowse_stop=function(){var a=this;var c=SecondScreenUtils.$;var b=66;if(c("#__gamooga_cobrowse_status").length==0){c("body").append('<div id="__gamooga_cobrowse_status" style="background-color:#F0EFF0; box-shadow:0 0 4px #888; font-size:13px; font-weight:bold; left:0; margin:1px; padding:5px 7px; position:fixed; top:0; opacity:0.7; z-index:2147483647" bgcolor="#F0EFF0"><a href="javascript:void(0)" id="__gamooga_cobrowse_stop" style="color:#ff0000">Stop agent control</a></div>');c("#__gamooga_cobrowse_stop").click(function(){a.ws.send(String.fromCharCode(b))})}};SecondScreen.prototype.agent_cobrowse_stop=function(){SecondScreen._del_sess_data("__ss_cobrowse");$("#__gamooga_cobrowse_status").remove()};SecondScreen.prototype.feedback_status=function(){var b=this;var c=SecondScreenUtils.$;var d=98;if(_ss_track.id!="206f307a-c1bf-41ec-8ac6-8d0b3a07ace5"&&_ss_track.id!="1b2bb765-95ef-4ba1-9333-428e00656f45"){b.chat_frame.find(".visitor-feedback").remove();var a='<div class="visitor-feedback" style="width:100%;height:30px;background-color:#e6e6e6;"><div class="call-inner" style="margin:0px;display:block;"><span class="connect" style="color:#fff;font-size:14px;margin:12px 0 0 10px;float:left;"></span><div style="float:right;"><p style="display:block;font-weight:500;margin:9px 7px 6px 2px;float:left;text-transform:uppercase;font-family:sans-serif;">Feedback:</p><div class="thumb-down" style="float:right;display:inline-block;cursor:pointer;"><img class="thumb-down-src" src="'+location.protocol+"//"+_ss_track.FE_SERVER+'/static/images/feedback/thumb-down.png" style="margin:6px 10px 0px 0px;width:18px;height:18px;vertical-align: middle;"/></div><div class="thumb-up" style="float:right;display:inline-block;cursor:pointer;"><img class="thumb-up-src" src="'+location.protocol+"//"+_ss_track.FE_SERVER+'/static/images/feedback/thumb-up.png" style="margin:4px 5px 0px 0px;width:18px;height:18px;vertical-align: middle;"/></div></div></div></div>';b.chat_frame.find(".gmg_chat_content").before("<div>"+a+"</div>");b.chat_frame.find(".thumb-up").click(function(){if(b.visitor_feedback!=1){b.visitor_feedback=1;c(".thumb-up-src",this).attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-up-active.png");c(".thumb-down-src",this).attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-down.png")}else{b.visitor_feedback=0;c(".thumb-up-src",this).attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-up.png")}c(this).siblings("div.thumb-down").children(".thumb-down-src").attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-down.png");if(b.latest_chat_id!==null){var f=location.protocol+"//"+_ss_track.FE_SERVER+"/manage/chat_feedback/?chid="+b.latest_chat_id+"&feedback="+b.visitor_feedback;c.ajax({type:"GET",url:f,dataType:"jsonp",success:function(g){}})}else{b.ws.send(String.fromCharCode(d)+b.visitor_feedback)}});b.chat_frame.find(".thumb-down").click(function(){if(b.visitor_feedback!=-1){b.visitor_feedback=-1;c(".thumb-down-src",this).attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-down-active.png");c(".thumb-up-src",this).attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-up.png")}else{b.visitor_feedback=0;c(".thumb-down-src",this).attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-down.png")}c(this).siblings("div.thumb-up").children(".thumb-up-src").attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/feedback/thumb-up.png");if(b.latest_chat_id!==null){var f=location.protocol+"//"+_ss_track.FE_SERVER+"/manage/chat_feedback/?chid="+b.latest_chat_id+"&feedback="+b.visitor_feedback;c.ajax({type:"GET",url:f,dataType:"jsonp",success:function(g){}})}else{b.ws.send(String.fromCharCode(d)+b.visitor_feedback)}});if(b.chat_shown){c("iframe.gmg_chat").css("height",b.chat_frame.css("height"))}}};SecondScreen.prototype.reconnect=function(){var a=this;var b=SecondScreenUtils.$;if(a.chat_frame){a.chat_frame.find(".gmg_chat_head b").html("Reconnecting, please wait...")}setTimeout(function(){var f=a.ws.onopen;var g=a.ws.onmessage;var c=a.ws.onclose;a.reconnect_count+=1;try{if("https:"==window.location.protocol){a.ws=new WebSocket("wss://"+a.bk_svr.split(":")[0]+"/")}else{if(a.bk_svr.split(":")[1]=="443"){a.ws=new WebSocket("wss://"+a.bk_svr.split(":")[0]+"/")}else{a.ws=new WebSocket("ws://"+a.bk_svr+"/")}}}catch(d){console.log("caught",d)}a.ws.onopen=f;a.ws.onmessage=g;a.ws.onclose=c},250)};SecondScreen.prototype.set_name=function(a){var c=SecondScreenUtils.$;var b=this;b.chat_frame.find("div.gmg_prechat_name input.gmg_input").val(a);b.chat_frame.find("div.gmg_chat_name input.gmg_input").val(a);_ss_track.options.visitor_name=a;_ss_track.options.visitor_email=_ss_track.options.visitor_email||"";SecondScreen._write_local_data("vne",SecondScreenUtils.base64encode(JSON.stringify({name:a,email:_ss_track.options.visitor_email})))};SecondScreen.prototype.set_email=function(b){var c=SecondScreenUtils.$;var a=this;a.chat_frame.find("div.gmg_prechat_email input.gmg_input").val(b);a.chat_frame.find("div.gmg_chat_email input.gmg_input").val(b);_ss_track.options.visitor_email=b;_ss_track.options.visitor_name=_ss_track.options.visitor_name||"";SecondScreen._write_local_data("vne",SecondScreenUtils.base64encode(JSON.stringify({name:_ss_track.options.visitor_name,email:b})))};SecondScreen.prototype.set_prechat_answer=function(a,c){var d=SecondScreenUtils.$;var b=this;b.chat_frame.find('[data-pcs-name="'+a+'"]').val(c)};SecondScreen.prototype.update_online_depts=function(){var c=SecondScreenUtils.$;var b=this;if(!b.chat_enabled){return}var a=b.chat_frame.find(".gmg_route");c(a).each(function(){var f=c(this);var g=f.text();if(b.online_depts[f.attr("data-route")]){f.removeAttr("disabled");var d=g.indexOf(" (not available)");if(d!=-1){f.text(g.substr(0,d))}}else{f.attr("disabled","disabled");var d=g.indexOf(" (not available)");if(d==-1){f.text(g+" (not available)")}}});c(a).parent().each(function(){if(c(this).find("option:checked").is(":disabled")&&c(this).find("option:checked").val()!=""){c(this).val(c(this).find("option:enabled").text());c(this).trigger("change")}})};SecondScreen.prototype.play_notification=function(a){(function(){var b=0;var d=a;var c=window.setInterval(function(){try{$("div.gmg_chat_outer audio")[0].play()}catch(f){}if(++b===d){window.clearInterval(c)}},500)})()};SecondScreen.prototype.play_and_flick=function(a){var d=SecondScreenUtils.$;var b=this;if(a==="call"){b.play_notification(5)}else{b.play_notification(1)}if(!b.chat_frame.find("textarea.gmg_chat_textarea").is(":focus")){if(!b.flick_title_interval){b.orig_title=document.title;var c=true;b.flick_title_interval=setInterval(function(){if(c){if(a==="call"){document.title="Incoming call from "+b.last_chat_agent+"..."}else{document.title=b.last_chat_agent+" says..."}}else{document.title=b.orig_title}c=!c},1000)}}};SecondScreen.prototype.stop_flick=function(){var b=SecondScreenUtils.$;var a=this;if(a.flick_title_interval){clearInterval(a.flick_title_interval);a.flick_title_interval=null;document.title=a.orig_title}};SecondScreen.prototype.update_last_chat_recv_at=function(){var b=SecondScreenUtils.$;var a=this;if(a.last_chat_recv_at){a.chat_frame.find(".gmg_chat_info").html("Last message received at "+a.last_chat_recv_at.toLocaleTimeString())}else{a.chat_frame.find(".gmg_chat_info").html("&nbsp;")}};SecondScreen.prototype.push_event=function(b){var d=SecondScreenUtils.$;if(this.ws.readyState!=WebSocket.OPEN){this.pushed_evs.push(b);return}if(b[2]===undefined){b[2]=2}var c=3;var a="\u0002";if(_taq.id=="138080ef-4919-40af-a72e-6b75ea868631"&&b[0]=="started session"){b[1]["browser"]="---";b[1]["OS"]="---";b[1]["IP"]="---"}this.ws.send(String.fromCharCode(c)+b[0]+a+JSON.stringify(b[1])+a+b[2]);this.push_to_ga(b[0])};SecondScreen.prototype.push_to_ga=function(c){var b=this;var d=SecondScreenUtils.$;if(typeof b.sess_conf.gaid!="undefined"){var a=new Image(1,1);a.src=("https:"==window.location.protocol?"https://ssl":"http://www")+".google-analytics.com/collect?v=1&tid="+encodeURIComponent(b.sess_conf.gaid)+"&cid="+encodeURIComponent(b.user_data.cookie_id)+"&t=event&ec=ssevent&ea="+encodeURIComponent(c)+"&el="+encodeURIComponent(b.user_data.cookie_id)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)}};SecondScreen.prototype.push=SecondScreen.prototype.push_event;SecondScreen.prototype.push_handler=function(b){var a=this;if(b[0]=="connect"){if(a.ws.readyState==WebSocket.OPEN){setTimeout(function(){b[1](a.new_sess)},0)}else{a._onconnect.push(b[1])}}else{if(b[0]=="chatstart"){a._onchatstart.push(b[1])}else{if(b[0]=="chatend"){a._onchatend.push(b[1])}else{if(b[0]=="prochat"){a._onprochat.push(b[1])}else{if(b[0]=="agentchat"){a._onagentchat.push(b[1])}}}}}};SecondScreen.prototype._check_pending_tasks=function(){var b=this;for(var a=0;a<b.pending_tasks.length;a++){b.act_task(b.pending_tasks[a])}b.pending_tasks=[]};SecondScreen.prototype.act_task=function(a){var b=this;if(b.agent_present===null){b.pending_tasks.push(a);return}if(a[0]=="prochat_msg"){b.act_prochat_msg(a[1],a[2],a[3],a[4])}else{if(a[0]=="agent_alert"){b.act_agent_alert(a[1],a[2],a[3],a[4])}else{if(a[0]=="show_visitor"){b.act_show_visitor(a[1])}else{if(a[0]=="assign_dept"){b.act_assign_dept(a[1])}}}}};SecondScreen.prototype.agent_alarm=function(h,i,c,f){var d=this;var g=SecondScreenUtils.$;var b=12;var a="\u0002";if(f){d.ws.send(String.fromCharCode(b)+h+a+i+a+c+a+f)}else{d.ws.send(String.fromCharCode(b)+h+a+i+a+c)}};SecondScreen.prototype.act_prochat_msg=function(m,k,o,n){var p=this;var h=SecondScreenUtils.$;var c=32;var b=80;if(p.agent_present){if(!p.chat_enabled&&p.chat_enabled_by_agent){p.chat_enabled=true;p.add_chat_widget()}if(!p.chat_enabled){return}var j=SecondScreen._read_sess_data("__ss_support");if(typeof j=="undefined"||j=="0"){if(o!="0"){if(!p.online_depts[o]&&!(_ss_track.options.chat_spill_to[o]&&p.online_depts[_ss_track.options.chat_spill_to[o]])){return}else{p.ws.send(String.fromCharCode(c)+o)}}p.ws.send(String.fromCharCode(b)+n+"|"+m+"|"+k);if(p.chat_hist_recvd){var d=p.chat_frame.find(".gmg_chat_all");var f=p.chat_frame.find(".gmg_chat_wrap");var a=p.chat_frame.find(".gmg_chat_content");if(d.children().length>1){f.css("min-height",(d.height()+a.height())+"px")}p.add_chat_message(m,k);p.chat_show();p.last_chat_agent=m;p.last_chat_recv_at=new Date();p.update_last_chat_recv_at();p.play_and_flick("chat");SecondScreen._write_sess_data("chatafterprochat",0);for(var g=0;g<p._onprochat.length;g++){(function(){var i=g;setTimeout(function(){p._onprochat[i]()},0)})()}}else{p.pending_proactive_chats.push([m,k]);SecondScreen._write_sess_data("chatafterprochat",0)}p.taq_convs.pro_chat_atic(n);SecondScreen._write_sess_data("analytic_latest_trigger",n)}}};SecondScreen.prototype.act_agent_alert=function(f,g,d,a){var b=this;var c=SecondScreenUtils.$;if(b.agent_present){if(d!="0"){if(!b.online_depts[d]){return}b.agent_alarm(f,g,a,d);b.taq_convs.agent_alert_atic(a);SecondScreen._write_sess_data("analytic_latest_trigger",a)}else{b.agent_alarm(f,g,a);b.taq_convs.agent_alert_atic(a);SecondScreen._write_sess_data("analytic_latest_trigger",a)}}};SecondScreen.prototype.act_show_visitor=function(d){var b=this;var c=SecondScreenUtils.$;var a=34;if(!_ss_track.options.vis_dflt_show){b.ws.send(String.fromCharCode(a)+d)}};SecondScreen.prototype.act_assign_dept=function(d){var b=this;var c=SecondScreenUtils.$;var a=32;SecondScreen._write_sess_data("assign_dept",d);if(!b.online_depts[d]){return}else{b.ws.send(String.fromCharCode(a)+d)}};SecondScreen.prototype.ask_and_start_mirror=function(){var a=116;var b=this;var f=SecondScreenUtils.$;var g=f(window).width();var d=422;if(g>=320&&g<=380){d=280}else{if(g>=381&&g<=480){d=320}}var c='<div id="__gamooga_mirror_ask" style="background-color:#F0EFF0; box-shadow:0 0 4px #888; font-size:11px; font-weight:400; left:calc(50% - '+(d/2)+"px); margin:0; padding:0; position:fixed; top:0; width:"+d+'px; z-index:2147483647" bgcolor="#F0EFF0" width="'+d+'"><div style="margin:0; padding:0 20px 10px 20px"><div style="display:inline-block; float:left; margin:15px 15px 0 0; padding:0; position:relative"><img src="//'+_ss_track.FE_SERVER+'/static/images/support.png" style="max-height:65px; max-width:65px"></div><div style="color:#000; display:inline-block; line-height:1.4em; margin:0; padding:10px 0 0 0; position:relative; text-align:left; width:calc(100% - 80px)" align="left" width="calc(100% - 80px)"><span style="color:#000; font-family:\'Open Sans\', sans-serif; font-size:14px; font-weight:700; line-height:1.4em; margin-bottom:5px; text-align:left" align="left">Chat agent would like view your current browser tab for offering better support. Would you like to allow?</span><!--<p style="font-family:\'Open Sans\', sans-serif; font-size:12px; line-height:1.4em; margin:10px 0; padding:0; text-align:left" align="left">You can turn off notifications anytime from browser settings.</p>--></div><div style="clear: both;"><div style="float:right; margin:0; padding:0"><button style="background:linear-gradient(to bottom, #64b4f4, #0084f6); border:1px solid #42a2f2; border-radius:4px; box-shadow:none; box-sizing:border-box; color:#fff; cursor:pointer; display:inline-block; font-family:Arial; font-size:14px; font-weight:normal; height:26px; line-height:1.1em; margin:0; margin-right:20px; padding:5px; text-shadow:none; text-transform:none; width:90px" height="26" width="90" id="__gamooga_mirror_allow">Allow</button><button style="background:#FFF; border:1px solid #42a2f2; border-color:#CCC; border-radius:4px; box-shadow:none; box-sizing:border-box; color:#000; cursor:pointer; display:inline-block; font-family:Arial; font-size:14px; font-weight:normal; height:26px; line-height:1.1em; margin:0; padding:5px; text-shadow:none; text-transform:none; width:100px" height="26" width="100" id="__gamooga_mirror_deny">Deny</button></div><div style="clear:both"></div></div></div></div>';f("body").append(c);f("#__gamooga_mirror_deny").click(function(){f("#__gamooga_mirror_ask").remove();b.ws.send(String.fromCharCode(a))});f("#__gamooga_mirror_allow").click(function(){f("#__gamooga_mirror_ask").remove();b.start_mirror()})};SecondScreen.prototype.start_mirror=function(){var f=SecondScreenUtils.$;var j=101;var w=102;var r=103;var q=104;var v=105;var m=106;var k=107;var g=108;var i=109;var b=111;var o=116;var p=117;var n=118;var t=this;SecondScreen._write_sess_data("__ss_m",1);t.in_mirror=true;if(typeof WebKitMutationObserver=="function"||typeof WebKitMutationObserver=="object"||typeof MozMutationObserver=="function"||typeof MutationObserver=="function"){if(f("base").length>0){t.ws.send(String.fromCharCode(j)+f("base").attr("href"))}else{t.ws.send(String.fromCharCode(j)+location.href.match(/^(.*\/)[^\/]*$/)[1])}var d=false;var h=[];t.mirror_client=new TreeMirrorClient(document,{initialize:function(A,B){var C=JSON.stringify([A,B]);SecondScreenUtils.lzw_encode(SecondScreenUtils.unicode_encode(C),function(D){t.ws.send(String.fromCharCode(w)+D);d=true;for(var E=0;E<h.length;E++){t.ws.send(String.fromCharCode(r)+h[E])}h=[]},function(E,D){t.ws.send(String.fromCharCode(n)+E+","+D)})},applyChanged:function(C,B,A,D){if(d){t.ws.send(String.fromCharCode(r)+JSON.stringify([C,B,A,D]))}else{h.push(JSON.stringify([C,B,A,D]))}}})}else{var c=document.documentElement.innerHTML;c=c.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");if(c.indexOf("<base")==-1){c=c.replace(/<head([^>]*)>/i,'<head$1><base href="'+location.href.match(/^(.*\/)[^\/]*$/)[1]+'">')}SecondScreenUtils.lzw_encode(SecondScreenUtils.unicode_encode(c),function(A){t.ws.send(String.fromCharCode(w)+String.fromCharCode(3)+A);t.old_html=c;t.diff_intr=setInterval(function(){var D=document.documentElement.innerHTML;D=D.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");if(D.indexOf("<base")==-1){D=D.replace(/<head([^>]*)>/i,'<head$1><base href="'+location.href.match(/^(.*\/)[^\/]*$/)[1]+'">')}if(D!=t.old_html){var C=new SecondScreenUtils.diff_match_patch();var E=C.diff_main(t.old_html,D);C.diff_cleanupEfficiency(E);var B=C.patch_toText(C.patch_make(t.old_html,E));t.ws.send(String.fromCharCode(r)+String.fromCharCode(3)+B);t.ws.send(String.fromCharCode(v)+JSON.stringify({x:f(window).scrollLeft(),y:f(window).scrollTop()}));t.old_html=D}},5000)},function(B,A){t.ws.send(String.fromCharCode(n)+B+","+A)})}f(window).on("resize.__ss",function(){t.ws.send(String.fromCharCode(q)+JSON.stringify({h:f(window).height(),w:f(window).width()}))});f(window).resize();var a,z,y=false,u,s,x=false;t.mouse_scroll_intr=setInterval(function(){if(y){t.ws.send(String.fromCharCode(v)+JSON.stringify({x:a,y:z}));y=false}if(x){t.ws.send(String.fromCharCode(m)+JSON.stringify({x:u,y:s}));x=false}},100);f(window).on("scroll.__ss",function(){a=f(window).scrollLeft();z=f(window).scrollTop();y=true});f(window).scroll();f(document).on("mousemove.__ss",function(A){u=A.pageX;s=A.pageY;x=true});f(window).on("click.__ss",function(A){t.ws.send(String.fromCharCode(p)+JSON.stringify({x:A.pageX,y:A.pageY}))});f(document).on("input.__ss propertychange.__ss",'input[type="text"]',function(){var A=f("input").index(this);if(f(this).is(_ss_track.options.mask_fields)){var B=new Array(this.value.length+1).join("x")+" (masked)";t.ws.send(String.fromCharCode(k)+JSON.stringify([A,B]))}else{t.ws.send(String.fromCharCode(k)+JSON.stringify([A,this.value]))}});f(document).on("change.__ss",'input[type="radio"], input[type="checkbox"]',function(){var A=f("input").index(this);t.ws.send(String.fromCharCode(k)+JSON.stringify([A,this.checked]))});f(document).on("input.__ss propertychange.__ss","textarea",function(){var A=f("textarea").index(this);if(f(this).is(_ss_track.options.mask_fields)){var B=new Array(this.value.length+1).join("x")+" (masked)";t.ws.send(String.fromCharCode(g)+JSON.stringify([A,B]))}else{t.ws.send(String.fromCharCode(g)+JSON.stringify([A,this.value]))}});f(document).on("change.__ss","select",function(){var A=f("select").index(this);t.ws.send(String.fromCharCode(i)+JSON.stringify([A,this.selectedIndex]))})};SecondScreen.prototype.add_chat_widget=function(){var a="\u0002";var u=81;var T=82;var p=83;var U=84;var f=33;var v=32;var A=77;var E=SecondScreenUtils.$;var m=this;var S={normal:{widget_w:"280px",chat_head_fs:"12px",greet_fs:"11px",power_fs:"9px",text_fs:"12px",input_fs:"13px",input_w:"270px",textarea_w:"270px",input_pad_w:"253px",chat_cont_h:"253px",off_msg_h:"107px",pic_h_w:"40px"},large:{widget_w:"280px",chat_head_fs:"12px",greet_fs:"12px",power_fs:"10px",text_fs:"14px",input_fs:"14px",input_w:"440px",textarea_w:"440px",input_pad_w:"423px",chat_cont_h:"360px",off_msg_h:"287px",pic_h_w:"40px"},mobile:{widget_w:"98%",chat_head_fs:"1em",greet_fs:"0.9em",power_fs:"0.7em",text_fs:"1em",input_fs:"1em",input_w:"99%",textarea_w:"100%",input_pad_w:"94%",chat_cont_h:"180px",off_msg_h:"107px",pic_h_w:"2.5em"}};var D;if(m.mobile){E("iframe.gmg_chat").contents().find("html,body").css("width","100%");D=S.mobile;m.chat_cont_h=D.chat_cont_h;var N=(0.7*(E(window).height()-150))+"px";if(parseInt(N)<parseInt(D.chat_cont_h)){m.chat_cont_h=N}}else{D=_ss_track.options.chat_size==0?S.normal:S.large;m.chat_cont_h=D.chat_cont_h}E(window).on("resize.__cw",function(){var i=(0.7*(E(window).height()-150))+"px";if(parseInt(i)<parseInt(D.chat_cont_h)){M.find(".gmg_chat_content").css("height",i);if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}m.chat_cont_h=i}else{i=D.chat_cont_h;M.find(".gmg_chat_content").css("height",i);if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}m.chat_cont_h=i}});var C="";var y=m.sess_conf.settings.pcs;var H=false;for(var Q=0;Q<y.length;Q++){C+="<div class='gmg_prechat_srvy gmg_inp_div'"+(y[Q][5]?" id='pcs_wrap_"+y[Q][0]+"' style='display:none'":"")+">";var V="";if(y[Q][3]){V=" grq";C+="<span class='error'></span>"}var w=null;if(y[Q][2]==0){if(y[Q][6]!=""){w=JSON.parse(y[Q][6])}C+="<select data-pcs-name='"+y[Q][7]+"' data-set='"+y[Q][6]+"' id='"+y[Q][0]+"' class='gmg_select"+V+"'>";C+="<option value='' disabled='disabled' selected='selected'>"+y[Q][1]+"</option>";var s=y[Q][4].split("\r\n");for(var P=0;P<s.length;P++){var B="";if(w&&w.route&&w.route[s[P]]){B="class='gmg_route' data-route='"+w.route[s[P]]+"' disabled='disabled' ";H=true}var r="";if(w&&w.show&&w.show[s[P]]){r="data-show='"+w.show[s[P]]+"' "}C+="<option "+B+r+"value='"+s[P]+"'>"+s[P]+(B?" (not available)":"")+"</option>"}C+="</select></div>"}else{C+="<input data-pcs-name='"+y[Q][7]+"' id='"+y[Q][0]+"' type='text' class='gmg_input"+V+"' placeholder='"+y[Q][1]+"'></div>"}}var t="";var n=m.sess_conf.settings.ofs;var x=false;for(var Q=0;Q<n.length;Q++){t+="<div class='gmg_offline_srvy gmg_inp_div'"+(n[Q][5]?" id='offs_wrap_"+n[Q][0]+"' style='display:none'":"")+">";var V="";if(n[Q][3]){V=" grq";t+="<span class='error'></span>"}var w=null;if(n[Q][2]==0){if(n[Q][6]!=""){w=JSON.parse(n[Q][6])}t+="<select data-offs-name='"+n[Q][7]+"' data-set='"+n[Q][6]+"' id='"+n[Q][0]+"' class='gmg_select"+V+"'>";t+="<option value='' disabled='disabled' selected='selected'>"+n[Q][1]+"</option>";var s=n[Q][4].split("\r\n");for(var P=0;P<s.length;P++){var B="";if(w&&w.route&&w.route[s[P]]){B="class='' data-route='"+w.route[s[P]]+"'";x=true}var r="";if(w&&w.show&&w.show[s[P]]){r="data-show='"+w.show[s[P]]+"' "}t+="<option "+B+r+"value='"+s[P]+"'>"+s[P]+"</option>"}t+="</select></div>"}else{t+="<input data-offs-name='"+n[Q][7]+"' id='"+n[Q][0]+"' type='text' class='gmg_input"+V+"' placeholder='"+n[Q][1]+"'></div>"}}var O="";if(m.sess_conf.settings.depts.length>0){O="<div class='gmg_prechat_dept gmg_inp_div'><select class='gmg_select'><option value='' disabled='disabled' selected='selected'>Chat with</option>";var b=m.sess_conf.settings.depts;for(var Q=0;Q<b.length;Q++){O+='<option disabled="disabled" class="gmg_route" data-route="'+b[Q][0]+'" value="'+b[Q][0]+'">'+b[Q][1]+"</option>"}O+="</select></div>"}var k="";if(m.sess_conf.settings.depts.length>0){k="<div class='gmg_offline_dept gmg_inp_div'><select class='gmg_select'><option value='' disabled='disabled' selected='selected'>Chat with</option>";var b=m.sess_conf.settings.depts;for(var Q=0;Q<b.length;Q++){k+='<option data-route="'+b[Q][0]+'" value="'+b[Q][0]+'">'+b[Q][1]+"</option>"}k+="</select></div>"}var d="";if(!_ss_track.options.chat_no_min&&_ss_track.options.chat_close){d="<div class='gmg_chat_close' style='float:right;padding-right:5px;color:"+_ss_track.options.title_text_color+"'>&#x2715;</div>"}var I="";var L="";if(_ss_track.options.chat_css_url!=""){I="<link rel='stylesheet' type='text/css' href='"+_ss_track.options.chat_css_url+"' />"}if(_ss_track.id=="20865ce1-6c61-4713-8fef-ac507207d84a"||_ss_track.id=="076ae345-1772-45dc-ba71-2b7292bc845b"){var z="First Name Last Name";var o="Let&apos;s talk"}else{var z="Name";var o="Start chat"}var g="<!DOCTYPE html><html><head>"+I+"<style type='text/css'>* {padding:0;margin:0;}"+(m.mobile?"* {-webkit-text-size-adjust:100%;-ms-text-size-adjust:none;}.gmg_chat_textarea{box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box} body {font-size:16px !important;}":"")+" .gmg_chat_line {margin:3px 0;font-size:"+D.input_fs+";} .gmg_chat_line table {border:0;border-collapse:collapse;} .gmg_chat_line table th {background-color:#ccc;border:1px solid #666;padding:2px;text-align:left;} .gmg_chat_line table td {border:1px solid #666;padding:2px;} .gmg_chat_line ul {padding-left:20px;} .gmg_chat_line ol {padding-left:20px;} .gmg_info_msg {color:#555;background-color:#eee;padding:3px;font-size:"+D.greet_fs+";margin:7px -1px 7px 0px;display:block;clear:both;} .gmg_inp_div {font-size:"+D.text_fs+";margin:6px 4px;color:#000;} .gmg_input {width:"+D.input_pad_w+";height:23px;padding: 4px 5px 4px 10px;border-radius: 4px;border:1px solid #ccc;font-size:"+D.input_fs+";} .gmg_select {width:"+D.input_w+";padding: 4px 5px 4px 10px;border-radius: 4px;height:30px;border:1px solid #ccc;font-size:"+D.input_fs+";background:#fff;} .error {color:red;font-size:"+D.greet_fs+";display:none;}"+_ss_track.options.chat_css+"</style></head><body style='background-color:transparent;overflow:hidden;font-family:tahoma,arial,sans-serif;font-size:12px'><div style='background-color:#eee;border-bottom:1px solid "+_ss_track.options.title_color+";border-left:1px solid "+_ss_track.options.title_color+";border-right:1px solid "+_ss_track.options.title_color+";'><div class='gmg_chat_head' style='padding:8px 0 8px 10px;background:"+_ss_track.options.title_color+";border:1px solid "+_ss_track.options.title_color+";color:"+_ss_track.options.title_text_color+";cursor:pointer;font-size:"+D.chat_head_fs+"'><span class='chat_head_icon'></span><b>"+_ss_track.options.online_title+"</b>"+d+(_ss_track.options.chat_no_min?"":"<div class='gmg_chat_arrow' style='float:right;padding-right:5px;color:"+_ss_track.options.title_text_color+"'>&#x25B2;</div>")+"</div><div class='gmg_prechat_online' style='display:none'><div style='color:#000;background-color:#fff;padding:4px;font-size:"+D.greet_fs+";'>"+_ss_track.options.pre_greet+"</div><form action='javascript:void(0)' class='gmg_prechat_form'><div class='gmg_prechat_name gmg_inp_div'><input placeholder='"+z+"' type='text' class='gmg_input' value='"+_ss_track.options.visitor_name+"'></div><div class='gmg_prechat_email gmg_inp_div'><span class='error'></span><input placeholder='Email' type='text' class='gmg_input' value='"+_ss_track.options.visitor_email+"'></div>"+C+((!H)?O:"")+"<div class='gmg_prechat_sub' style='text-align:center'><input type='submit' value='"+o+"' style='font-size:"+D.greet_fs+";height:27px;padding:0 10px;margin:3px 0 20px;background:"+_ss_track.options.title_color+";border:1px solid "+_ss_track.options.title_color+";color:"+_ss_track.options.title_text_color+";border-radius:4px;-moz-border-radius:4px;-webkit-border-radius:4px'></div></form></div><div class='gmg_chat_online'><div class='gmg_agent_info' style='"+(_ss_track.options.img_enable?"":"display:none;")+"padding:5px 5px 7px 5px;background-color:#eee;border-bottom:1px solid #ccc;'><div style='background: url("+location.protocol+"//"+_ss_track.FE_SERVER+"/agent_img/0/"+_taq.id+"/) no-repeat 50% 50%;float:left;margin-right:5px;width:"+D.pic_h_w+";height:"+D.pic_h_w+";background-size: contain;' class='gmg_agent_img'> </div><div style='background:url("+location.protocol+"//"+_ss_track.FE_SERVER+"/company_logo/"+_ss_track.id+"/) no-repeat 50% 50%;float:right;width:100px;height:40px'></div><span class='gmg_agent_name' style='display:block;padding-top:5px;font-weight:bold;font-size:"+D.text_fs+";overflow:hidden;text-overflow:ellipsis;white-space:nowrap;' title='Agent'>"+_ss_track.options.dflt_ag_nm+"</span><span class='gmg_agent_des' style='display:block;padding-top:3px;font-size:9px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-height:14px;' title=''></span></div><div class='visitorcall-outer' style='width:100%;height:40px;background-color:rgba(0,0,0,0.7);display:none;'><div class='call-inner' style='margin:0px;display:block;'><span class='connect' style='color:#fff;font-size:14px;margin:12px 0 0 10px;float:left;'><img style='width:14px;height:14px;vertical-align:middle;' src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/call.png'/> Connecting...</span><div class='circle video' style='float:right;display:inline-block;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/startvideo.png' style='margin:8px 17px 0px 0px;width:24px;height:24px;vertical-align: middle;'/></div><div class='circle audio' style='float:right;display:inline-block;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/startcall.png' style='margin:8px 17px 0px 0px;width:24px;height:24px;vertical-align: middle;'/></div><div class='circle ft' style='float:right;display:inline-block;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/filetransfer/livechat-send-file.png' style='margin:8px 17px 0px 0px;width:24px;height:24px;vertical-align: middle;'/></div></div></div><div class='agentcall-outer' style='position:absolute;z-index:99999;width:70%;height:auto;margin: 12%;z-index:999999;background-color:rgba(0,0,0,0.8);box-shadow:0px 0px 5px rgba(0,0,0,0.6);border-radius:10px;padding-bottom:10px;display:none;'><div class='video-call-inner' style='margin:0px;display:block;'><p align='center' style='margin:0px;color:#fff;font-size:14px;padding:7px 0 7px 10px;border-bottom:1px solid;'>Incoming Call</p><div align='center' style='width:33%;display:inline-block;'><div class='circle green answer_audio' style='display:inline-block;width:33px;height:33px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/startcall.png' style='margin:8px 7px;width: 28px;height: 28px;'/></div></div><div align='center' style='width:33%;display:inline-block;'><div class='circle green answer_video' style='display:inline-block;width:33px;height:33px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/startvideo.png' style='margin:8px 7px;width: 32px;height: 32px;'/></div></div><div align='center' style='width:33%;display:inline-block;'><div class='circle red call_reject' style='display:inline-block;width:33px;height:33px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/reject.png' style='margin:8px 7px;width: 32px;height: 32px;'/></div></div></div><div class='audio-call-inner' style='margin:0px;display:block;'><p align='center' style='margin:0px;color:#fff;font-size:14px;padding:7px 0 7px 10px;border-bottom:1px solid;'>Incoming Call</p><div align='center' style='width:50%;display:inline-block;'><div class='circle green answer_audio' style='display:inline-block;width:33px;height:33px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/startcall.png' style='margin:8px 7px;width: 28px;height: 28px;'/></div></div><div align='center' style='width:40%;display:inline-block;'><div class='circle red call_reject' style='display:inline-block;width:33px;height:33px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/reject.png' style='margin:8px 7px;width: 32px;height: 32px;'/></div></div></div></div><div class='oncall-outer' style='margin-top:-3px;width:100%;height:auto;background-color: rgba(0,0,0,0.7);display:none;padding-bottom:40px;'><div class='oncall_videobox'><video autoplay class='agent_video_box' poster='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/video_default.png' style='width: 100%;background-color: #7A7A7A;height: 145px;'></video><br><video autoplay muted class='visitor_video_box' poster='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/video_default.png' style='background-color: #383838;position: absolute;width:30%;height:50px;margin-top:-55px;border-top: 2px solid rgba(255,255,255,0.5);border-right: 2px solid rgba(255,255,255,0.5);'></video><div class='circle video_fullscreen' style='position: absolute;weight:28px;height:28px;border-radius:50px;margin: -40px 7px 0 0;border: 2px solid rgba(255,255,255,0.5);background-color: rgba(0,0,0,0.6);right: 0;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/maximize.png' style='margin:7px 7px;width: 14px;height: 14px;vertical-align: middle;'/></div></div><div class='oncall-inner' style='margin:0px;display:block;'><div align='center' style='display:inline-block;float:right;'><div class='circle red end_call' style='display:inline-block;width:25px;height:25px;padding:3px;margin: 4px 8px 0px 5px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/reject.png' style='width:24px;height:24px;'/></div></div><div class='oncall_video_btn' align='center' style='display:inline-block;float:right;display:block;'><div class='circle green video-toggle' style='display:inline-block;width:25px;height:25px;padding:3px;margin: 4px 5px 0px 5px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/video_hide.png' style='width:24px;height:24px;'/></div></div><div class='oncall_audio_btn' align='center' style='display:inline-block;float:right;'><div class='circle green audio-toggle' style='display:inline-block;width:25px;height:25px;padding:5px;margin: 0px 5px 0px 5px;'><img src='"+location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/mute.png' style='width: 24px;height: 24px;'/></div></div></div></div><div class='gmg_chat_content' style='font-family:arial,sans-serif;height:"+m.chat_cont_h+"!important;width:100%;overflow:auto;background-color:#fff;color:#000;'><div class='gmg_chat_wrap' style='padding:3px;margin:1px;'><div class='gmg_chat_all'><div class='gmg_info_msg gmg_info_msg_top'>"+_ss_track.options.online_greet+"</div></div></div></div><div class='gmg_chat_info' style='font-family:arial,sans-serif;font-size:9px;text-align:right;padding:2px;padding-right:4px;background-color:#fff;color:#777;'>&nbsp;</div><textarea class='gmg_chat_textarea' style='height:48px;width:"+D.textarea_w+";border:0;border-top:1px solid #bbb;border-bottom:1px solid #bbb;padding:4px;color:#000;font-size:"+D.input_fs+" !important;background-color:#fff;resize:none' placeholder='"+_ss_track.options.msg_hint+"'></textarea></div><div class='gmg_offline gmg_chat_offline' style='display:none'><div style='color:#000;background-color:#fff;padding:4px;font-size:"+D.greet_fs+";'>"+_ss_track.options.offline_greet+"</div><form action='javascript:void(0)' class='gmg_chat_form'><div class='gmg_chat_name gmg_inp_div'><input placeholder='Name' type='text' class='gmg_input' value='"+_ss_track.options.visitor_name+"'></div><div class='gmg_chat_email gmg_inp_div'><span class='error'></span><input placeholder='Email' type='text' class='gmg_input' value='"+_ss_track.options.visitor_email+"'></div>"+t+((!x)?k:"")+"<div class='gmg_chat_msg gmg_inp_div'><span class='error'></span><textarea placeholder='Type your message here' style='height:"+D.off_msg_h+";' class='gmg_input'></textarea></div><div class='gmg_chat_sub' style='text-align:center;'><input type='submit' value='Submit' style='font-size:"+D.greet_fs+";height:27px;padding:0 10px;margin:0 0 6px;background:"+_ss_track.options.title_color+";border:1px solid "+_ss_track.options.title_color+";color:"+_ss_track.options.title_text_color+";border-radius:4px;-moz-border-radius:4px;-webkit-border-radius:4px;cursor:pointer;'></div></form></div><div class='gmg_chat_unavail' style='display:none'><div style='color:#000;background-color:#fff;padding:4px 4px 15px 4px;font-size:"+D.greet_fs+";'>"+_ss_track.options.unavail_greet+"</div></div>";if(window.location.host=="zestim.com"){g+="<div style='color:#000;height:12px;text-align:center;font-size:"+D.power_fs+";background-color:#eee'>Powered by <a href='http://www.zestim.com/?utm_medium=chat_widget&utm_source="+window.location.hostname+"' target='_new' style='color:#000;'>Zestim</a></div></div></body></html>"}else{g+="<div style='color:#000;height:12px;text-align:center;font-size:"+D.power_fs+";background-color:#eee'>Powered by <a href='http://www.gsecondscreen.com/?utm_medium=chat_widget&utm_source="+window.location.hostname+"' target='_new' style='color:#000;'>Gamooga Second Screen</a></div></div></body></html>"}var R;if(_ss_track.options.chat_pos==0){R="bottom:0;right:"+_ss_track.options.chat_pos_off+"px"}else{if(_ss_track.options.chat_pos==1){R="bottom:0;left:"+_ss_track.options.chat_pos_off+"px"}else{if(_ss_track.options.chat_pos==2){R="left:0;top:"+_ss_track.options.chat_pos_off+"px;transform:rotate(90deg) translate(0,-100%);transform-origin:0 0;-moz-transform:rotate(90deg) translate(0,-100%);-moz-transform-origin:0 0;-ms-transform:rotate(90deg) translate(0,-100%);-ms-transform-origin:0 0;-webkit-transform:rotate(90deg) translate(0,-100%);-webkit-transform-origin:0 0;-o-transform:rotate(90deg) translate(0,-100%);-o-transform-origin:0 0;filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1)"}else{if(_ss_track.options.chat_pos==3){var G=-1*_ss_track.options.chat_pos_off-250;R="left:0;top:100%;margin-top:"+G+"px;transform:rotate(90deg) translate(0,-100%);transform-origin:0 0;-moz-transform:rotate(90deg) translate(0,-100%);-moz-transform-origin:0 0;-ms-transform:rotate(90deg) translate(0,-100%);-ms-transform-origin:0 0;-webkit-transform:rotate(90deg) translate(0,-100%);-webkit-transform-origin:0 0;-o-transform:rotate(90deg) translate(0,-100%);-o-transform-origin:0 0;filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1)"}else{if(_ss_track.options.chat_pos==4){R="right:0;top:"+_ss_track.options.chat_pos_off+"px;transform:rotate(270deg) translate(0,-100%);transform-origin:250px 0;-moz-transform:rotate(270deg) translate(0,-100%);-moz-transform-origin:250px 0;-ms-transform:rotate(270deg) translate(0,-100%);-ms-transform-origin:250px 0;-webkit-transform:rotate(270deg) translate(0,-100%);-webkit-transform-origin:250px 0;-o-transform:rotate(270deg) translate(0,-100%);-o-transform-origin:250px 0;filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3);-ms-writing-mode:bt-rl"}else{if(_ss_track.options.chat_pos==5){var G=-1*_ss_track.options.chat_pos_off-250;R="right:0;top:100%;margin-top:"+G+"px;transform:rotate(270deg) translate(0,-100%);transform-origin:250px 0;-moz-transform:rotate(270deg) translate(0,-100%);-moz-transform-origin:250px 0;-ms-transform:rotate(270deg) translate(0,-100%);-ms-transform-origin:250px 0;-webkit-transform:rotate(270deg) translate(0,-100%);-webkit-transform-origin:250px 0;-o-transform:rotate(270deg) translate(0,-100%);-o-transform-origin:250px 0;filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3);-ms-writing-mode:bt-rl"}}}}}}var J="<div class='gmg_chat_outer'><audio preload='none'><source src='//"+_ss_track.FE_SERVER+"/static/swf/chat.mp3' type='audio/mpeg'><source src='//"+_ss_track.FE_SERVER+"/static/swf/chat.wav' type='audio/wav'></audio><iframe allowfullscreen='true' webkitallowfullscreen='true' mozallowfullscreen='true' class='gmg_chat' style='width:"+D.widget_w+(m.mobile?" !important; max-width:500px":"")+";max-height:100%;height:0;position:fixed;"+R+";text-align:left;z-index:9999999999;border:0;-webkit-border-radius:4px 4px 0 0;-moz-border-radius:4px 4px 0 0;border-radius:4px 4px 0 0;box-shadow: 0 0 5px #333' marginheight='0' marginwidth='0' frameborder='0'";var q="></iframe></div>";if(false&&E.browser.webkit){_ss_track.__srcfn=function(){return g};E("body").append(J+" src='javascript:if(parent._ss_track)parent._ss_track.__srcfn()'"+q)}else{E("body").append(J+q);var h=E("iframe.gmg_chat")[0];h.contentWindow.document.open();h.contentWindow.document.write(g);h.contentWindow.document.close()}E("iframe.gmg_chat").load(function(){if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}});var M=m.chat_frame=E("iframe.gmg_chat").contents().find("body");if(!_ss_track.options.hide_on_min){E("iframe.gmg_chat").stop().animate({height:m.chat_frame.find(".gmg_chat_head").outerHeight()+"px"},250,"linear")}m.chat_shown=false;var c=function(i,j){return function(){return j.apply(i,arguments)}};if(_ss_track.options.chat_close){M.find(".gmg_chat_close").click(function(){m.stop_flick();m.remove_chat_widget()})}if(!_ss_track.options.chat_no_min){M.find(".gmg_chat_head").click(c(m,m.chat_clicked))}var F=null;M.find(".gmg_chat_textarea").keypress(c(m,function(j){var i=this;if(j.which=="13"){i.chat_posted();i.ws.send(String.fromCharCode(U));clearTimeout(F);F=null;if(i.mobile){M.find(".gmg_chat_textarea").blur();if(window.AndroidInterface){window.AndroidInterface.hideKeyboard()}}return false}if(F==null){i.ws.send(String.fromCharCode(T))}clearTimeout(F);F=setTimeout(function(){i.ws.send(String.fromCharCode(U));F=null},5000)}));var K=null;M.find(".gmg_prechat_srvy select").change(function(){var X=E(this).attr("data-set");var Z=E(this).val();var W=E(this).find("option:checked").attr("data-show");var i=E(this).find("option:checked").attr("data-route");var j=E(this);while(true){var Y=j.data("dep");if(!Y){break}j.removeAttr("dep");Y.hide();j=Y}if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}if(W){M.find(".gmg_prechat_form #pcs_wrap_"+W).show();E(this).data("dep",M.find(".gmg_prechat_form #pcs_wrap_"+W));if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}}if(i){K=i}});M.find(".gmg_offline_srvy select").change(function(){var X=E(this).attr("data-set");var Z=E(this).val();var W=E(this).find("option:checked").attr("data-show");var i=E(this).find("option:checked").attr("data-route");var j=E(this);while(true){var Y=j.data("dep");if(!Y){break}j.removeAttr("dep");Y.hide();j=Y}if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}if(W){M.find(".gmg_chat_form #offs_wrap_"+W).show();E(this).data("dep",M.find(".gmg_chat_form #offs_wrap_"+W));if(m.chat_shown){E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}}if(i){K=i}});if(K=="0"){K=null}if(m.sess_conf.settings.depts.length>0){m.update_online_depts()}M.find(".gmg_prechat_form").submit(function(Z){var j=M.find(".gmg_prechat_name input").val();var i=M.find(".gmg_prechat_email input").val();var Y=false;M.find(".gmg_prechat_srvy .grq").css("border","1px solid #ccc").prev().hide();M.find(".gmg_prechat_srvy .grq").each(function(){if(E(this).is(":visible")&&(E(this).val()==null||E(this).val()=="")){E(this).css("border","1px solid red");E(this).prev().html(" (required)").show();Y=true}});M.find(".gmg_prechat_email input").css("border","1px solid #ccc");M.find(".gmg_prechat_email span.error").hide();if(i==""){M.find(".gmg_prechat_email input").css("border","1px solid red");M.find(".gmg_prechat_email span.error").html(" (required)").show();Y=true}else{if(!/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]+/i.test(i)){M.find(".gmg_prechat_email input").css("border","1px solid red");M.find(".gmg_prechat_email span.error").html(" (valid email required)").show();Y=true}}M.find(".gmg_prechat_dept select").css("border","1px solid #ccc");if(M.find(".gmg_prechat_dept select").length>0){if(!M.find(".gmg_prechat_dept select").val()){M.find(".gmg_prechat_dept select").css("border","1px solid red");Y=true}}if(!Y){m.finish_prechat();if(M.find(".gmg_prechat_dept select").length>0){m.ws.send(String.fromCharCode(v)+M.find(".gmg_prechat_dept select").val());m.ws.send(String.fromCharCode(A)+"(has filled prechat form and started chat)")}else{if(K&&K!="0"){m.ws.send(String.fromCharCode(v)+K);m.ws.send(String.fromCharCode(A)+"(has filled prechat form and started chat)")}else{m.ws.send(String.fromCharCode(A)+"(has filled prechat form and started chat)")}}var X=[];var W=[];M.find(".gmg_prechat_srvy input,.gmg_prechat_srvy select").each(function(){if(E(this).val()!=""){X.push([E(this).attr("id"),E(this).val()])}if(E(this).prop("tagName")=="INPUT"){W.push([E(this).attr("placeholder"),E(this).val()])}else{if(E(this).prop("tagName")=="SELECT"){W.push([E("option:eq(0)",this).text(),E(this).val()])}}});m.pc_name=j;m.pc_email=i;m.pc_data=W;m.ws.send(String.fromCharCode(f)+j+a+i+a+JSON.stringify(W));if(j!=_ss_track.options.visitor_name||i!=_ss_track.options.visitor_email||X.length>0){E.ajax({type:"GET",url:"//"+_ss_track.GMG_SERVER+"/vnameemail_post/",data:{cid:_ss_track.id,vid:m.user_data.cookie_id,name:j,email:i,pcsdj:JSON.stringify(X)},dataType:"jsonp",success:function(aa){if(aa=="0"){SecondScreen._write_local_data("vne",SecondScreenUtils.base64encode(JSON.stringify({name:j,email:i})));_ss_track.options.visitor_name=j;_ss_track.options.visitor_email=i}}})}}E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))});M.find(".gmg_chat_form").submit(function(Y){var W=E(this).find(".gmg_chat_name input").val();var j=E(this).find(".gmg_chat_email input").val();var aa=E(this).find(".gmg_chat_msg textarea").val();var X=false;E(this).find(".gmg_chat_email input").css("border","1px solid #ccc");E(this).find(".gmg_chat_msg textarea").css("border","1px solid #ccc");E(this).find(".gmg_chat_email span.error").hide();E(this).find(".gmg_chat_msg span.error").hide();E(this).find(".gmg_offline_srvy .grq").css("border","1px solid #ccc").prev().hide();E(this).find(".gmg_offline_srvy .grq").each(function(){if(E(this).is(":visible")&&(E(this).val()==null||E(this).val()=="")){E(this).css("border","1px solid red");E(this).prev().html(" (required)").show();X=true}});E(this).find(".gmg_chat_email input").css("border","1px solid #ccc");E(this).find(".gmg_chat_email span.error").hide();if(j==""){E(this).find(".gmg_chat_email input").css("border","1px solid red");E(this).find(".gmg_chat_email span.error").html(" (required)").show();X=true}else{if(!/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]+/i.test(j)){E(this).find(".gmg_chat_email input").css("border","1px solid red");E(this).find(".gmg_chat_email span.error").html(" (valid email required)").show();X=true}}E(this).find(".gmg_offline_dept select").css("border","1px solid #ccc");if(E(this).find(".gmg_offline_dept select").length>0){if(!E(this).find(".gmg_offline_dept select").val()){E(this).find(".gmg_offline_dept select").css("border","1px solid red");X=true}}E("iframe.gmg_chat").css("height",m.chat_frame.css("height"));if(!X){var i={};E(this).find(".gmg_offline_srvy input").each(function(ad,ac,ab){i[E(this).attr("placeholder")]=E(this).val()});E(this).find(".gmg_chat_sub input").val("Sending...");E(this).find(".gmg_chat_sub input").attr("disabled","disabled");var Z=0;E(this).find(".gmg_offline_srvy select").each(function(){var ab=(JSON.parse(E(this).attr("data-set")));if(!E.isEmptyObject(ab.route)){Z=E(this).find("option:selected").attr("data-route")}});if(!x){Z=E(this).find(".gmg_offline_dept select").val()}E.ajax({type:"GET",url:"//"+_ss_track.GMG_SERVER+"/offline_mail/",data:{id:_ss_track.id,n:W,e:j,m:aa,l:location.href,d:Z,extra_data:JSON.stringify(i)},dataType:"jsonp",success:function(ac){if(ac[0]=="0"){M.find(".gmg_chat_sub input").val("Sent!");setTimeout(function(){M.find(".gmg_chat_name input").val("");M.find(".gmg_chat_email input").val("");M.find(".gmg_chat_msg textarea").val("");M.find(".gmg_chat_sub input").val("Submit");M.find(".gmg_chat_sub input").removeAttr("disabled")},4000)}else{if(ac[0]=="-1"){var ab=ac[1];if(ab.e){M.find(".gmg_chat_email span.error").html(" "+ab.e).show();M.find(".gmg_chat_email input").css("border","1px solid red")}if(ab.m){M.find(".gmg_chat_msg span.error").html(" "+ab.m).show();M.find(".gmg_chat_msg textarea").css("border","1px solid red")}M.find(".gmg_chat_sub input").val("Error! Try again.");setTimeout(function(){M.find(".gmg_chat_sub input").val("Submit");M.find(".gmg_chat_sub input").removeAttr("disabled")},4000);E("iframe.gmg_chat").css("height",m.chat_frame.css("height"))}}}}).error(function(){E(this).find(".gmg_chat_sub input").val("Error! Try again.");setTimeout(function(){E(this).find(".gmg_chat_sub input").val("Submit");E(this).find(".gmg_chat_sub input").removeAttr("disabled")},4000)})}Y.preventDefault()});M.click(function(){m.stop_flick()});m.visitor_calloption()};SecondScreen.prototype.is_chatting=function(){var b=SecondScreenUtils.$;var a=this;return SecondScreen._read_sess_data("__ss_support")=="1"};SecondScreen.prototype.attach_altid=function(b,a){var d=SecondScreenUtils.$;var c=this;d.ajax({type:"GET",url:"//"+_ss_track.GMG_SERVER+"/valtid_post/",data:{cid:_ss_track.id,vid:c.user_data.cookie_id,altid:b},dataType:"jsonp",success:function(f){if(f=="0"){if(a){a(true)}}else{if(a){a(false)}}}})};SecondScreen.prototype.show_chat_widget=function(){var b=SecondScreenUtils.$;var a=this;if(!a.chat_enabled){return}b(".gmg_chat_outer").show()};SecondScreen.prototype.hide_chat_widget=function(){var b=SecondScreenUtils.$;var a=this;if(!a.chat_enabled){return}b(".gmg_chat_outer").hide()};SecondScreen.prototype.remove_chat_widget=function(){var b=SecondScreenUtils.$;var a=this;if(!a.chat_enabled){return}SecondScreen._del_sess_data("__ss_chat");a.chat_enabled=false;b(".gmg_chat_outer").remove()};SecondScreen.prototype.prefill_chat=function(c){var d=89;var f=SecondScreenUtils.$;var b=this;for(var a=0;a<c.length;a++){var g=c[a];if(g.who=="visitor"){b.add_chat_message("You",g.chat)}else{b.add_chat_message(g.who,g.chat);b.last_chat_recv_at=new Date(g.epoch*1000);b.last_chat_agent=g.who}}b.update_last_chat_recv_at();b.ws.send(String.fromCharCode(d)+JSON.stringify(c))};SecondScreen.prototype.live_chat_click=function(f,g,c,b){var d=SecondScreenUtils.$;var a=this;if(!a.chat_enabled){if(a.chat_enabled_by_agent){a.chat_enabled=true;a.add_chat_widget();if(a.prechat_enabled){a.chat_frame.find(".gmg_chat_online").hide();a.chat_frame.find(".gmg_prechat_online").show()}if(a.offline_message_disabled&&!a.unavail_greet_enabled){a.hide_chat_widget()}}else{return}}if(a.agent_present){if(a.offline_message_disabled&&!a.unavail_greet_enabled){a.show_chat_widget();a.chat_show();if(b){a.prefill_chat(b)}return}if(a.prechat_enabled){a.chat_frame.find(".gmg_prechat_online").show()}else{a.chat_frame.find(".gmg_chat_online").show()}if(!a.offline_message_disabled){a.chat_frame.find(".gmg_chat_offline").hide()}else{a.chat_frame.find(".gmg_chat_unavail").hide()}if(a.chat_shown){d("iframe.gmg_chat").css("height",a.chat_frame.css("height"))}a.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.online_title);a.chat_show();if(c){a.finish_prechat();if(b){a.prefill_chat(b)}}if(a.prechat_enabled&&(f||g)){if(f){a.chat_frame.find(".gmg_prechat_name input").val(f)}if(g){a.chat_frame.find(".gmg_prechat_email input").val(g)}a.chat_frame.find(".gmg_prechat_form").submit()}}else{if(a.offline_message_disabled&&!a.unavail_greet_enabled){a.hide_chat_widget();return}if(a.prechat_enabled){a.chat_frame.find(".gmg_prechat_online").hide()}else{a.chat_frame.find(".gmg_chat_online").hide()}if(!a.offline_message_disabled){a.chat_frame.find(".gmg_chat_offline").show();a.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.offline_title)}else{a.chat_frame.find(".gmg_chat_unavail").show();a.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.unavail_title)}if(a.chat_shown){d("iframe.gmg_chat").css("height",a.chat_frame.css("height"))}a.chat_show()}};SecondScreen.prototype.chat_toggle=function(){var b=SecondScreenUtils.$;var a=this;if(!a.chat_enabled){return}if(a.chat_shown){a.chat_frame.find(".gmg_chat_arrow").html("&#x25B2;");b("iframe.gmg_chat").stop().css("height",a.chat_frame.find(".gmg_chat_head").outerHeight()+"px");if(_ss_track.options.chat_size==1){b("iframe.gmg_chat").css("width","300px")}if(_ss_track.options.chat_pos==2||_ss_track.options.chat_pos==3){b("iframe.gmg_chat").css({transform:"rotate(90deg) translate(0,-100%)","-webkit-transform":"rotate(90deg) translate(0,-100%)","-moz-transform":"rotate(90deg) translate(0,-100%)","-ms-transform":"rotate(90deg) translate(0,-100%)","-o-transform":"rotate(90deg) translate(0,-100%)",filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)"})}else{if(_ss_track.options.chat_pos==4||_ss_track.options.chat_pos==5){b("iframe.gmg_chat").css({transform:"rotate(270deg) translate(0,-100%)","-webkit-transform":"rotate(270deg) translate(0,-100%)","-moz-transform":"rotate(270deg) translate(0,-100%)","-ms-transform":"rotate(270deg) translate(0,-100%)","-o-transform":"rotate(270deg) translate(0,-100%)",filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)"})}}a.chat_shown=false;SecondScreen._write_sess_data("__ss_chat","0");if(_ss_track.options.hide_on_min){b("iframe.gmg_chat").stop().css("height","0")}}else{if(a.ws.readyState==a.ws.CLOSED){a.reconnect_count=0;a.reconnect()}a.chat_frame.find(".gmg_chat_arrow").html("&#x25BC;");if(_ss_track.options.chat_size==1){b("iframe.gmg_chat").css("width","450px")}b("iframe.gmg_chat").stop().css("height",a.chat_frame.css("height"));if(_ss_track.options.chat_pos>=2){b("iframe.gmg_chat").css({transform:"none","-webkit-transform":"none","-moz-transform":"none","-ms-transform":"none","-o-transform":"none",filter:"none"})}a.chat_shown=true;var c=a.chat_frame.find(".gmg_chat_content");c.stop().scrollTop(c[0].scrollHeight);SecondScreen._write_sess_data("__ss_chat","1");if(a.unread_chat_show_interval!==null){a.unread_chat_count=0;clearInterval(a.unread_chat_show_interval);a.unread_chat_show_interval=null;a.unread_chat_show_helper=0;a.chat_frame.find(".gmg_chat_head b").html(_ss_track.options.online_title)}}};SecondScreen.prototype.init_call=function(c){var d=SecondScreenUtils.$;var b=this;if(!util.supports.audioVideo){b.add_info_message("Sorry, your browser does not support "+c+" call.");return}var a=(c==="video")?true:false;navigator.getUserMedia({audio:true,video:a},function(g){window.localStream=g;if(b.peer==null){b.initializePeer()}console.log("Sending call init "+c);var f=95;b.ws.send(String.fromCharCode(f));b.calltype=c;b.after_visitor_calloption(c)},function(){console.log("Couldn't get media");b.add_info_message("Unable to access your microphone/camera. Sorry, you cannot make call.");b.visitor_calloption()})};SecondScreen.prototype.end_call=function(){var b=SecondScreenUtils.$;var a=this;if(window.existingCall){window.existingCall.close()}a.peer.destroy();if(window.localStream.getAudioTracks()[0]){window.localStream.getAudioTracks()[0].stop()}if(window.localStream.getVideoTracks()[0]){window.localStream.getVideoTracks()[0].stop()}a.calltype=null;a.peer=null;a.webrtc_key=null;a.visitor_calloption()};SecondScreen.prototype.chat_audio_off=function(){var b=SecondScreenUtils.$;var a=this;window.localStream.getAudioTracks()[0].enabled=false;a.chat_frame.find(".oncall-outer .oncall_audio_btn").css({"background-color":"rgb(233,152,33)"});a.chat_frame.find(".oncall-outer .audio-toggle").click(function(){a.chat_audio_on()})};SecondScreen.prototype.chat_video_off=function(){var b=SecondScreenUtils.$;var a=this;window.localStream.getVideoTracks()[0].enabled=false;a.chat_frame.find(".oncall-outer .oncall_video_btn").css({"background-color":"rgb(233,152,33)"});a.chat_frame.find(".oncall-outer .video-toggle").click(function(){a.chat_video_on()})};SecondScreen.prototype.chat_audio_on=function(){var b=SecondScreenUtils.$;var a=this;window.localStream.getAudioTracks()[0].enabled=true;a.chat_frame.find(".oncall-outer .oncall_audio_btn").css({"background-color":"transparent"});a.chat_frame.find(".oncall-outer .audio-toggle").click(function(){a.chat_audio_off()})};SecondScreen.prototype.chat_video_on=function(){var b=SecondScreenUtils.$;var a=this;window.localStream.getVideoTracks()[0].enabled=true;a.chat_frame.find(".oncall-outer .oncall_video_btn").css({"background-color":"transparent"});a.chat_frame.find(".oncall-outer .video-toggle").click(function(){a.chat_video_off()})};SecondScreen.prototype.chat_clicked=function(){var b=SecondScreenUtils.$;var a=this;a.chat_toggle()};SecondScreen.prototype.chat_show=function(){var b=SecondScreenUtils.$;var a=this;a.chat_shown=false;a.chat_toggle()};SecondScreen.prototype.chat_hide=function(){var b=SecondScreenUtils.$;var a=this;a.chat_shown=true;a.chat_toggle()};SecondScreen.prototype.chat_posted=function(){var f=SecondScreenUtils.$;var d=this;if(!d.chat_enabled){return}var c=77;var g=d.chat_frame.find(".gmg_chat_textarea").val();g=g.trim();if(g==""){return}g=g.substr(0,1024);d.chat_frame.find(".gmg_chat_textarea").val("");d.add_chat_message("You",g);if((_ss_track.id=="a6ac3e6e-c86b-4536-aedd-105a3df85b16"||_ss_track.id=="90a5d6f0-53a1-49ee-94f9-a388cd636831")&&!_ss_track.___simpli_trigger_timeout){var b=SecondScreen._read_sess_data("__ss_support");if(typeof b=="undefined"||b=="0"){if(SecondScreen._read_sess_data("chatafterprochat")===undefined){_ss_track.___simpli_trigger_timeout=setTimeout(function(){var h=SecondScreen._read_sess_data("__ss_support");if(typeof h=="undefined"||h=="0"){d.add_chat_message("System","We have made you wait for long! Seems all our consultants are busy chatting with other customers. We have your details and will get in touch with you shortly.")}},180000)}else{_ss_track.___simpli_trigger_timeout=setTimeout(function(){var h=SecondScreen._read_sess_data("__ss_support");if(typeof h=="undefined"||h=="0"){d.add_chat_message("System",'We have made you wait for long! Seems all our consultants are busy chatting with other customers. We request you to leave your details on "request a call back" section on our site.')}},180000)}}}d.ws.send(String.fromCharCode(c)+g);var a=SecondScreen._read_sess_data("analytic_latest_trigger");if(a){d.taq_convs.chat_start_atic(a);SecondScreen._del_sess_data("analytic_latest_trigger")}};SecondScreen.prototype.add_info_message=function(c){var b=SecondScreenUtils.$;var a=this;a._add_message("<div class='gmg_info_msg'>"+c+"</div>")};SecondScreen.prototype.add_status_message=function(c){var b=SecondScreenUtils.$;var a=this;a._add_message("<i>"+c+"</i>")};SecondScreen.prototype.agent_calling=function(a){var b=this;b.chat_frame.find(".gmg_info_msg_top").css("margin-top","0px");if(b.prechat_enabled){b.finish_prechat()}b.chat_show();b.chat_frame.find(".oncall-outer").hide();b.chat_frame.find(".visitorcall-outer div.audio").hide();b.chat_frame.find(".visitorcall-outer div.video").hide();if(a==="audio"){b.chat_frame.find(".agentcall-outer > div.audio-call-inner").show();b.chat_frame.find(".agentcall-outer > div.video-call-inner").hide()}else{b.chat_frame.find(".agentcall-outer > div.audio-call-inner").hide();b.chat_frame.find(".agentcall-outer > div.video-call-inner").show()}b.chat_frame.find(".agentcall-outer").show();b.chat_frame.find(".agentcall-outer .answer_audio").unbind("click").bind("click",function(){b.answer_call("audio")});b.chat_frame.find(".agentcall-outer .call_reject").unbind("click").bind("click",function(){b.answer_call("reject")});if(a==="video"){b.chat_frame.find(".agentcall-outer .answer_video").unbind("click").bind("click",function(){b.answer_call("video")})}};SecondScreen.prototype.on_calling_option=function(){var a=this;a.chat_frame.find(".gmg_info_msg_top").css("margin-top","0px");a.chat_frame.find(".agentcall-outer").hide();a.chat_frame.find(".visitorcall-outer").hide();a.chat_frame.find(".oncall-outer").show();a.chat_frame.find(".oncall-outer .audio-toggle").unbind("click").bind("click",function(){a.chat_audio_off()});a.chat_frame.find(".oncall-outer .video-toggle").unbind("click").bind("click",function(){a.chat_video_off()});a.chat_frame.find(".oncall-outer .end_call").unbind("click").bind("click",function(){window.existingCall.close()});a.addVideoFrame()};SecondScreen.prototype.addVideoFrame=function(){var a=this;a.chat_frame.find(".gmg_chat_content").css("height","150px");$("iframe.gmg_chat").css("height",a.chat_frame.css("height"));a.chat_frame.find(".toggle_calloption").unbind("click");a.chat_frame.find(".video_fullscreen").click(function(b){a.toggleFullScreen()})};SecondScreen.prototype.toggleFullScreen=function(){var a=this;var b=a.chat_frame.find(".agent_video_box")[0];if(b.requestFullscreen){b.requestFullscreen()}else{if(b.mozRequestFullScreen){b.mozRequestFullScreen()}else{if(b.webkitRequestFullscreen){b.webkitRequestFullscreen()}else{if(b.msRequestFullscreen){b.msRequestFullscreen()}}}}};SecondScreen.prototype.bind=function(a,b){return function(){return b.apply(a,arguments)}};SecondScreen.prototype.initializePeer=function(){var b=this;var a=_ss_track.options.peerjs_svr.split(":");if(location.protocol=="https:"){a=[a[0],"443"]}else{if(a.length==1){a.push("80")}}var c=new Peer({host:a[0],port:a[1],path:"/",debug:4,config:{iceServers:[{url:"stun:stun.l.google.com:19302"}]}});c.on("open",function(){console.log("peer connection opened - "+c.id);b.webrtc_key=c.id});c.on("call",function(d){console.log("receiving a new call");window.existingCall=d;b.play_and_flick("call");b.agent_calling(d.metadata.calltype)});c.on("error",function(d){alert(d.message);console.log(d.message);b.visitor_calloption()});b.peer=c};SecondScreen.prototype.answer_call=function(b){var d=this;d.stop_flick();if(b!=="reject"){var c=(b==="video")?true:false;navigator.getUserMedia({audio:true,video:c},function(f){window.localStream=f;window.existingCall.answer(window.localStream);d.handle_call(window.existingCall)},function(){console.log("Couldn't get media");d.add_info_message("Unable to access your microphone/camera. Call cannot be connected.");d.answer_call("reject")})}else{var a=97;d.ws.send(String.fromCharCode(a));window.existingCall.close();d.visitor_calloption()}};SecondScreen.prototype.handle_call=function(b){var a=this;window.existingCall=b;b.on("stream",function(c){a.on_calling_option();a.chat_frame.find(".oncall-outer .agent_video_box").prop("src",URL.createObjectURL(c));a.chat_frame.find(".oncall-outer .visitor_video_box").prop("src",URL.createObjectURL(window.localStream))});b.on("close",function(){a.end_call()})};SecondScreen.prototype.visitor_calloption=function(){var b=SecondScreenUtils.$;var a=this;a.chat_frame.find(".agentcall-outer").hide();a.chat_frame.find(".oncall-outer").hide();if(_ss_track.options.audio_video>0||_ss_track.options.file_transfer==true){a.chat_frame.find(".gmg_info_msg_top").css("margin-top","0px");a.chat_frame.find(".visitorcall-outer .connect").hide();a.chat_frame.find(".visitorcall-outer div.audio").hide();a.chat_frame.find(".visitorcall-outer div.video").hide();a.chat_frame.find(".visitorcall-outer div.ft").hide();if(_ss_track.options.audio_video>0){a.chat_frame.find(".visitorcall-outer div.audio").unbind("click").bind("click",function(){a.init_call("audio")});a.chat_frame.find(".visitorcall-outer div.audio").show();if(_ss_track.options.audio_video==2){a.chat_frame.find(".visitorcall-outer div.video").unbind("click").bind("click",function(){a.init_call("video")});a.chat_frame.find(".visitorcall-outer div.video").show()}}if(_ss_track.options.file_transfer==true){a.chat_frame.find(".visitorcall-outer div.ft").unbind("click").bind("click",function(){var c=window.open(location.protocol+"//"+_ss_track.FE_SERVER+"/livechat/filetransfer/?comp_id="+_ss_track.id,"child","height=250,width=500");return false;c.focus()});a.chat_frame.find(".visitorcall-outer div.ft").show()}a.chat_frame.find(".visitorcall-outer").show()}a.chat_frame.find(".gmg_chat_content").css("height",a.chat_cont_h);if(a.chat_shown){b("iframe.gmg_chat").css("height",a.chat_frame.css("height"))}};function sendFilename(a){var c="[file_transfer "+a+" ]";var b=77;_ss_track.api.ws.send(String.fromCharCode(b)+c);_ss_track.api.add_chat_message("You",c)}SecondScreen.prototype.after_visitor_calloption=function(b){var a=this;a.chat_frame.find(".visitorcall-outer div.video").hide();a.chat_frame.find(".visitorcall-outer div.audio").hide();if(b=="audio"){a.chat_frame.find(".visitorcall-outer .connect").attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/call.png")}else{if(b=="video"){a.chat_frame.find(".visitorcall-outer .connect").attr("src",location.protocol+"//"+_ss_track.FE_SERVER+"/static/images/audiovideo/video.png")}}a.chat_frame.find(".visitorcall-outer .connect").show()};SecondScreen.prototype.add_chat_message=function(c,f){var d=SecondScreenUtils.$;var b=this;c=c.replace(/<|>/g,function(g){return g=="<"?"&lt;":"&gt;"});var a;if(f.lastIndexOf("[file transfer",0)===0){a=f.replace("[file_transfer ","");a=a.substring(0,a.length-1);f=a.replace(/^.*[\\\/]/,"")}else{f=f.replace(/<|>/g,function(g){return g=="<"?"&lt;":"&gt;"}).replace(b.url_regex,function(h,j){var i="";if(!j){i="http://"}var g=document.createElement("a");g.href=i+h;if(g.host==""){g.href=g.href}if(g.host==window.location.host){return'<a target="_top" href="'+i+h+'">'+h+"</a>"}else{return'<a target="_new" href="'+i+h+'">'+h+"</a><small>&#x279A;</small>"}}).replace(/\[(\/?)((b)|(i)|(u)|(table)|(tr)|(td)|(th)|(ul)|(ol)|(li)|(br))\]/g,"<$1$2>")}if(!_ss_track.options.img_enable){b.agent_id=0}if(b.agent_id==null){b.agent_id=0}if(c=="You"){msg='<div style="clear:both;"><img src="'+location.protocol+"//"+_ss_track.FE_SERVER+'/static/images/user_chat_icon.png" style="float: right;margin:8px 4px 0 0;width:24px;height:24px;border-radius:24px;"><span style="border: 5px solid #e5e5e5;float: right;right: 0;-ms-transform: rotate(45deg);-webkit-transform: rotate(45deg);transform: rotate(45deg);margin: 12px 4px 0 -9px;"></span><span style="border: 5px solid #fbfbfb;float: right;right: 0;-ms-transform: rotate(45deg); -webkit-transform: rotate(45deg);transform: rotate(45deg);margin: 12px 0 0 -9px;"></span><p style="float:right;background-color:#fbfbfb;padding: 4px 10px 4px 5px;border:1px solid #e5e5e5;border-radius:4px;margin:3px 3px 0 0;max-width:70%;word-wrap:break-word;margin-bottom:10px;"><b>'+c+"</b><br><span>"+f+"</span></p></div>"}else{msg='<div style="clear:both;"><div class="chat_agent_img_ico" style="background: url('+location.protocol+"//"+_ss_track.FE_SERVER+"/agent_img/"+b.agent_id+"/"+_taq.id+'/) 50% 50% / contain no-repeat;float:left;margin:8px 4px 0 3px;width:24px;height:24px;border-radius:24px;"></div><span style="border: 5px solid #cbe7f5;float:left;right: 0;-ms-transform: rotate(45deg);-webkit-transform: rotate(45deg);transform: rotate(45deg);margin: 12px 0 0 1px;"></span><span style="border: 5px solid #E4F1FA;float:left;right: 0;-ms-transform: rotate(45deg); -webkit-transform: rotate(45deg);transform: rotate(45deg);margin: 12px 0 0 -9px;"></span><p style="background-color:#e4f1fa;padding: 4px 5px 4px 10px;border:1px solid #cbe7f5;border-radius:4px;margin:0 0 0 -6px;max-width:70%;word-wrap:break-word;margin-bottom:10px;float:left;"><b>'+(c!=""?c:"Agent")+"</b><br><span>"+f+"</span></p></div>"}if(a){msg=d(msg);msg.find("br").before('<a href="'+a+'" target="_blank" style="display:inline; cursor:pointer;"><img src="'+location.protocol+"//"+_ss_track.FE_SERVER+'/static/images/filetransfer/ft-chatmsg.png" width="20px" height="20px" style="vertical-align:bottom; float:right; opacity:.7; margin-left:10px; display:inline-block; margin-top:-4px;"></a>');msg.find("span").last().text("");msg.find("span").last().append('<a target="_blank" href="'+a+'">'+f+"</a>");b._add_message(msg[0].outerHTML)}else{b._add_message(msg)}if(b.latest_chat_id!==null){b.latest_chat_id=null;b.feedback_status()}};SecondScreen.prototype._add_message=function(c){var b=SecondScreenUtils.$;var a=this;if(!a.chat_enabled){return}if(a.prechat_enabled){a.finish_prechat()}a.chat_frame.find(".gmg_chat_content .gmg_chat_all").append("<div class='gmg_chat_line'>"+c+"</div>");a.chat_frame.find(".gmg_chat_content").stop().animate({scrollTop:a.chat_frame.find(".gmg_chat_content")[0].scrollHeight},"slow")};SecondScreen.prototype.finish_prechat=function(){var b=SecondScreenUtils.$;var a=this;a.prechat_enabled=false;if(a.agent_present){a.chat_frame.find(".gmg_chat_online").show();a.chat_frame.find(".gmg_prechat_online").hide();if(a.chat_shown){b("iframe.gmg_chat").css("height",a.chat_frame.css("height"))}}SecondScreen._write_sess_data("__ss_prechat","1")};var _ss_track=_ss_track||{};_ss_track.id=_taq.id;if(_ss_track.api){_ss_track.events=_ss_track.api}else{_ss_track.events=_ss_track.events||[]}_ss_track.handlers=_ss_track.handlers||[];_ss_track.options=_ss_track.options||{};_ss_track.options.pre_greet="Please provide your details.";_ss_track.options.online_title="Chat with us!";_ss_track.options.online_greet="Enter your message and one of our agents will attend to you right away.";_ss_track.options.offline_title="Leave us a message!";_ss_track.options.offline_greet="We are now offline. Please leave a message and we will get back to you.";_ss_track.options.unavail_title="We are offline";_ss_track.options.unavail_greet="Live chat is now offline. Please check back later when we are online and our support team will be happy to assist you.";_ss_track.options.msg_hint="Type your message and press ENTER";_ss_track.options.title_color="#3C3B37";_ss_track.options.title_text_color="#fff";_ss_track.options.chat_pos=0;_ss_track.options.chat_pos_off=3;_ss_track.options.chat_close=false;_ss_track.options.mask_fields="";_ss_track.options.vdataprops=[];_ss_track.options.vis_dflt_show=true;_ss_track.options.chat_css="";_ss_track.options.chat_size=0;_ss_track.options.img_enable=false;_ss_track.options.chat_no_min=_ss_track.options.chat_no_min||false;_ss_track.options.audio_video=0;_ss_track.options.file_transfer=false;_ss_track.options.peerjs_svr="127.0.0.1:9000";_ss_track.options.busy_msg="All our agents are busy. Please wait and one of our agents will attend to you shortly.";_ss_track.options.dflt_ag_nm="Agent";_ss_track.options.chat_css_url="";_ss_track.options.hide_on_min=false;if(document.getElementById("__ta")){var l=document.createElement("a");l.href=document.getElementById("__ta").src;if(l.host==""){l.href=l.href}_ss_track.FE_SERVER=l.host;_ss_track.GMG_SERVER=_ss_track.GMG_SERVER||"www.gsecondscreen.com";_ss_track.VI_SERVER="ae.gsecondscreen.com";if(l.host.search("gamooga.com")==-1&&l.host.search("cloudfront.net")==-1&&l.host.search("gsecondscreen.com")==-1){_ss_track.DEV=true;_ss_track.GMG_SERVER=_ss_track.FE_SERVER;_ss_track.VI_SERVER=_ss_track.FE_SERVER}}WEB_SOCKET_SWF_LOCATION="//"+_ss_track.FE_SERVER+"/static/js/WebSocketMainInsecure.swf";_ss_track.ajax_conf=function(){return SecondScreenUtils.$.ajax({type:"GET",url:"//"+_ss_track.FE_SERVER+"/conf/"+_ss_track.id+"/",dataType:"jsonp",jsonpCallback:"_ss_on_ajax_conf"})};_ss_track.init=function(o,b,f,q,r,a,h,n,s,c,j){var i=SecondScreenUtils.$;SecondScreen._read_sess_data=r;SecondScreen._write_sess_data=a;SecondScreen._del_sess_data=h;SecondScreen._read_local_data=n;SecondScreen._write_local_data=s;SecondScreen._del_local_data=c;var g=function(v){var w=v[0];if(typeof _ss_track.options.disable_chat=="undefined"&&typeof _ss_track.options.chat_show=="undefined"){if(w.settings["dcw"]){_ss_track.options.disable_chat=w.settings["dcw"];if(w.settings["eca"]){_ss_track.options.enable_chat_by_agent=w.settings["eca"]}}if(w.settings["ep"]){_ss_track.options.enable_prechat=true}if(w.settings["dom"]){_ss_track.options.disable_offline_message=w.settings["dom"];if(w.settings["enoffun"]){_ss_track.options.enable_unavail_greet=w.settings["enoffun"]}}var x=function(B){return i("<div/>").text(B).html()};_ss_track.options.pre_greet=x(w.settings["prgrt"]);_ss_track.options.online_title=x(w.settings["ontit"]);_ss_track.options.online_greet=x(w.settings["ongrt"]);_ss_track.options.offline_title=x(w.settings["offtit"]);_ss_track.options.offline_greet=x(w.settings["offgrt"]);_ss_track.options.msg_hint=x(w.settings["msghint"]);_ss_track.options.unavail_title=x(w.settings["offuntitle"]);_ss_track.options.unavail_greet=x(w.settings["offungreet"]);_ss_track.options.chat_pos=parseInt(w.settings["chps"]);_ss_track.options.chat_pos_off=parseInt(w.settings["chpsoff"]);_ss_track.options.chat_close=w.settings["cc"];_ss_track.options.mask_fields=w.settings["mskfl"];_ss_track.options.vdataprops=w.settings["vdp"];_ss_track.options.vis_dflt_show=w.settings["vds"];_ss_track.options.chat_css=w.settings["chcss"];_ss_track.options.chat_size=w.settings["chsize"];_ss_track.options.img_enable=w.settings["imen"];_ss_track.options.audio_video=w.settings["av"];_ss_track.options.file_transfer=w.settings["ft"];_ss_track.options.peerjs_svr=w.settings["pjs"];_ss_track.options.busy_msg=w.settings["bmsg"];_ss_track.options.dflt_ag_nm=w.settings["dfagn"];_ss_track.options.chat_css_url=w.settings["chcssurl"];_ss_track.options.hide_on_min=w.settings["hom"];_ss_track.options.chat_spill_to=w.settings["dept_spill_to"];var A=_ss_track.options.title_color=w.settings["titcl"];var z=parseInt(A.substr(1,2),16);var y=parseInt(A.substr(3,2),16);var t=parseInt(A.substr(5,2),16);var u=1-(0.299*z+0.587*y+0.114*t)/255;if(u<0.5){_ss_track.options.title_text_color="#000"}else{_ss_track.options.title_text_color="#fff"}}return w};var p=SecondScreen._read_local_data("vne");if(p){var d=JSON.parse(SecondScreenUtils.base64decode(p));_ss_track.options.visitor_name=d.name;_ss_track.options.visitor_email=d.email}else{_ss_track.options.visitor_name="";_ss_track.options.visitor_email=""}var m=g(q);if(window!=window.top){return}if(_ss_track.options.chat_pos>=2&&/(Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone)/g.test(navigator.userAgent)){_ss_track.options.chat_pos=0}_ss_track.api=new SecondScreen(o,b,f,_ss_track.id,m,_ss_track.events,_ss_track.handlers,j);var k=function(t,u){return function(){return u.apply(t,arguments)}};_ss_track.events={};_ss_track.handlers={};_ss_track.events.push=k(_ss_track.api,_ss_track.api.push_event);_ss_track.handlers.push=k(_ss_track.api,_ss_track.api.push_handler);if(window.location.hash.indexOf("chatpopup")!=-1){_ss_track.handlers.push(["connect",function(){_ss_track.api.live_chat_click()}])}};window.addEventListener("message",receiveMessage,false);function receiveMessage(b){var a=b.origin||b.originalEvent.origin;if(a.indexOf(_ss_track.FE_SERVER)>-1){var c=JSON.parse(b.data);if("filename" in c){sendFilename(c.filename)}}}var _taq=_taq||{};(function(){_taq.fns=_taq.fns||{};var a={};_taq.init=function(b){setTimeout(function(){b(a)},0)};a.id=_taq.id;a.convs={};a.is_ready=false;if(typeof _taq.handlers=="undefined"){a.handlers=[];_taq.handlers=a.handlers}else{a.handlers=_taq.handlers}_taq.is_mobile=(function(b){return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))})(navigator.userAgent||navigator.vendor||window.opera);(function(d){if(typeof JSON=="undefined"||typeof localStorage=="undefined"||typeof sessionStorage=="undefined"){return}if(window!=window.top&&window.location.search!="?__gmg_force_embed"){return}if(document.getElementById("__ta")){var b=document.createElement("a");b.href=document.getElementById("__ta").src;if(b.host==""){b.href=b.href}a.FE_SERVER=b.host;a.BE_SERVER=a.BE_SERVER||"www.gsecondscreen.com";a.VI_SERVER="ae.gsecondscreen.com";if(b.host.search("gsecondscreen.com")==-1){a.DEV=true;a.BE_SERVER=a.FE_SERVER;a.VI_SERVER=a.FE_SERVER;_taq._int=a}else{a.DEV=false}}if(typeof jQuery==="undefined"||jQuery.fn.jquery!="1.7.2"){var c=document.createElement("SCRIPT");c.type="text/javascript";c.src="//"+a.FE_SERVER+"/static/jquery-noamd.min.js";if(c.readyState){c.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){this.onreadystatechange=null;_taq.$=$.noConflict(true);d(_taq.$)}}}else{c.onload=function(){_taq.$=$.noConflict(true);d(_taq.$)}}document.getElementsByTagName("HEAD")[0].appendChild(c)}else{_taq.$=jQuery;d(jQuery)}})(function(d){function b(f){return(document.cookie.match("(^|; )"+f+"=([^;]*)")||0)[2]}if(typeof Prototype!=="undefined"&&Prototype.Version.substr(0,3)=="1.6"){var c=JSON.stringify;JSON.stringify=function(h){var f=Array.prototype.toJSON;delete Array.prototype.toJSON;var g=c(h);Array.prototype.toJSON=f;return g}}if(window.XDomainRequest){d.ajaxTransport(function(g){if(g.crossDomain&&g.async){if(g.timeout){g.xdrTimeout=g.timeout;delete g.timeout}var f;return{send:function(i,h){function j(k,o,n,m){f.onload=f.onerror=f.ontimeout=d.noop;f=undefined;h(k,o,n,m)}f=new XDomainRequest();f.onload=function(){j(200,"OK",{text:f.responseText},"Content-Type: "+f.contentType)};f.onerror=function(){j(404,"Not Found")};f.onprogress=d.noop;f.ontimeout=function(){j(0,"timeout")};f.timeout=g.xdrTimeout||Number.MAX_VALUE;f.open(g.type,g.url);f.send((g.hasContent&&g.data)||null)},abort:function(){if(f){f.onerror=d.noop;f.abort()}}}}})}if(a.DEV){a.xds=new _taq.libs.xds("http://"+a.BE_SERVER+"/static/xds-serve.html")}else{a.xds=new _taq.libs.xds("https://xds.gsecondscreen.com/xds2/")}d.when((function(){var f=d.Deferred();a.xds.getLSPrefixItems(a.id,function(g){a.local_store=g;a.setLSItem=function(i,h){a.local_store[a.id+":"+i]=h;a.xds.setLSItem(a.id+":"+i,h)};_taq.setLSItem=a.setLSItem;a.getLSItem=function(h){return a.local_store[a.id+":"+h]};_taq.getLSItem=a.getLSItem;a.removeLSItem=function(h){delete a.local_store[a.id+":"+h];a.xds.removeLSItem(a.id+":"+h)};_taq.removeLSItem=a.removeLSItem;f.resolve()});return f})(),(function(){var f=d.Deferred();a.xds.getSSPrefixItems(a.id,function(g){a.sess_store=g;a.setSSItem=function(i,h){a.sess_store[a.id+":"+i]=h;a.xds.setSSItem(a.id+":"+i,h)};_taq.setSSItem=a.setSSItem;a.getSSItem=function(h){return a.sess_store[a.id+":"+h]};_taq.getSSItem=a.getSSItem;a.removeSSItem=function(h){delete a.sess_store[a.id+":"+h];a.xds.removeSSItem(a.id+":"+h)};_taq.removeSSItem=a.removeSSItem;f.resolve()});return f})(),(function(){var g=function(j){if(typeof j==="number"){return j}j=j.replace(/^[^\d]*/,"").replace(/[^\d]*$/,"").replace(/[^\d\.]/g,"");var k=j.charAt(j.length-3);var i=j.charAt(j.length-2);var h=parseInt(j.replace(/[^\d]/g,""));if(k==","||k=="."){h=h/100}else{if(i==","||i=="."){h=h/10}}return h};var f=d.Deferred();d.ajax({type:"GET",url:"//"+a.FE_SERVER+"/newconf/"+a.id+"/",dataType:"jsonp",jsonpCallback:"_ta_on_conf",success:function(n){a.config=n;if(n.pst){_taq.webpush_set=n.pst}if(typeof n.custom_event_script!="undefined"){var m=document.createElement("script");m.type="text/javascript";m.text=n.custom_event_script;m.id="__ta_ces";var j=document.getElementsByTagName("script")[0];j.parentNode.insertBefore(m,j)}if(typeof n.evt!="undefined"){var p=function(B,D){var A={};var s=false;for(var u=0;u<B.kv.length;u++){var z=B.kv[u];var C=z[0];var r="???";if(z[1]=="1"){r=z[2]}else{if(z[1]=="5"){try{r=new Function("return ("+z[2]+")();")()}catch(y){s=true;break}}else{if(z[1]>="2"){var x;if(z[1]=="3"){var v=z[2].split("|");var w=d(D);for(var t=0;t<v[0]-0;t++){w=w.parent()}if(v[1]==""){x=d(w)}else{x=d(v[1],w)}}else{x=d(z[2])}if(x.length>0){if(x.prop("tagName")=="SELECT"){r=d("option:selected",x).text()}else{r=x.val()||x.text()}}else{s=true;break}}}}r=d.trim(r);if(r.length>102){r=r.substr(0,100)+"..."}if(z.length==4){if(z[3]=="n"){r=g(r)}else{if(z[3]=="b"){var q=r.toLowerCase();if(q=="false"||q=="no"||q=="0"){r=false}else{r=true}}}}A[C]=r}if(!s){_taq.events.push([B.n,A,B.t])}};var k=function(i,q){(function(){var s=i;var r=q;if(typeof s.p!="undefined"){setTimeout(function(){if(d(s.p).filter(":visible").length>0){p(s,r)}},s.wt*1000)}else{p(s,r)}})()};for(var o=0;o<n.evt.length;o++){var h=n.evt[o];(function(){var q=h;var i=window.location.pathname+window.location.search+window.location.hash;if((q.ut==1&&i==q.u)||(q.ut==2&&i.indexOf(q.u)==0)||(q.ut==3&&i.indexOf(q.u)!=-1)||(q.ut==5&&i.indexOf(q.u)==-1)||(q.ut==4&&new RegExp(q.u).test(i))){if(q.w==1){d(document).ready(function(){k(q)})}else{if(q.w>=2&&q.w<=5){d(document).on("mousedown.__ta_ec",q.c,function(){k(q,this)})}else{if(q.w==6){d(document).ready(function(){setTimeout(function(){k(q)},parseInt(q.c)*1000)})}else{if(q.w==7){d(document).ready(function(){var u=parseInt(q.c)*1000;var s=new Date().getTime()+u;var t=function(v){setTimeout(function(){var w=new Date().getTime()-s;if(w>=0){k(q)}else{t(-w)}},v)};var r=function(){s=new Date().getTime()+u};d(document).on("mousedown.__ta_ec keydown.__ta_ec",r);t(u)})}}}}}})()}}f.resolve()}});return f})()).done(function(){if(typeof a.getLSItem("vid")=="undefined"){var f=a.DEV?"_ssd_v":"_ss_v";var g=b(f)||"";if(g!=""){var h=g.split("|")[0];a.setLSItem("vid",h)}}a.newvisitor=(typeof a.getLSItem("vid")=="undefined");d.when((function(){var i=d.Deferred();a.EV_SERVER=a.config.evbk;if(typeof a.getLSItem("vid")=="undefined"||a.getLSItem("vid")=="pKQDA7RSJZ6xsvjh"||a.getLSItem("vid")=="DOWBA7Ym87eZ11mT"||(a.getLSItem("vid")=="zazYBXoeNPeslF3i"&&a.id=="96148074-8fb3-4e8c-94a0-13f2012c5623")){a.newvisitor=true;d.ajax({type:"GET",url:"//"+a.EV_SERVER+"/nv/",dataType:"jsonp",jsonpCallback:"_ta_on_nv",success:function(j){a.setLSItem("vid",j);_taq.vid=j;a.vid=j;i.resolve()}})}else{a.newvisitor=false;a.vid=a.getLSItem("vid");_taq.vid=a.vid;i.resolve()}return i})(),(function(){var k=d.Deferred();var m;var n;var o=false;if(typeof a.getLSItem("sid")!="undefined"){var j=a.getLSItem("sid");var i=JSON.parse(j);m=i.sid;n=i.to;if(n<new Date().getTime()){o=true}}else{o=true}if(o){m=parseInt(new Date().getTime()+""+parseInt(Math.random()*10000)).toString(36)}n=new Date().getTime()+1800*1000;var j=JSON.stringify({sid:m,to:n});a.setLSItem("sid",j);_taq.sid=m;a.sid=m;a.newsessid=o;if(o){d.ajax({type:"GET",url:"//"+a.VI_SERVER+"/vi/",dataType:"jsonp",jsonpCallback:"_ss_on_ajax_vi",success:function(r){var q="";if(document.referrer){try{q=document.referrer.match(/:\/\/(.+)/)[1]}catch(v){q="(none)"}}else{q="(none)"}var u={location:r.location,IP:r.IP,browser:r.browser,OS:r.OS,referrer:q,repeat:!a.newvisitor};u.domain=location.host;var s=r.browser.split(" ");s.splice(s.length-1,1);var x=s.join(" ")||r.browser;var p=r.OS.split(" ");p.splice(p.length-1,1);var t=p.join(" ")||r.OS;u["base OS"]=t;u["base browser"]=x;u.country=r.location.split(", ")[1];var y=function(z){z=z.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var B=new RegExp("[\\?&]"+z+"=([^&#]*)"),A=B.exec(location.search);return A==null?"":decodeURIComponent(A[1].replace(/\+/g," "))};var w=function(z){var A=b("__utmz");if(A){var B=(function(){var E=A.split(".").slice(4).join(".").split("|");var F={};for(var D=0;D<E.length;D++){var C=E[D].split("=");F[C[0]]=C[1]}return F})();return B[z]}else{return null}};u["utm campaign"]=w("utmccn")||y("utm_campaign")||"(none)";u["utm medium"]=w("utmcmd")||y("utm_medium")||"(none)";u["utm source"]=w("utmcsr")||y("utm_source")||"(none)";u["utm term"]=w("utmctr")||y("utm_term")||"(none)";u.from_mobile=_taq.is_mobile;a.setLSItem("sess_data",JSON.stringify(u));_taq.events.push(["started session",u]);k.resolve()}})}else{k.resolve()}return k})(),(function(){if(typeof _ss_track!="undefined"&&typeof _ss_track.ajax_conf!="undefined"){SecondScreenUtils.$=_taq.$;return _ss_track.ajax_conf()}else{var i=d.Deferred();i.resolve();return i}})()).done(function(w,s,v){if(a.config.bvids.join(",").indexOf(a.vid)!=-1){return}try{if(typeof a.getLSItem("sess_data")!="undefined"){if(a.config.bips.join(",").indexOf(JSON.parse(a.getLSItem("sess_data"))["IP"])!=-1){return}}}catch(q){}var j;if(typeof a.getSSItem("tid")!="undefined"&&window.opener==null){j=a.getSSItem("tid")}else{j=parseInt(Math.random()*10000).toString(36);a.setSSItem("tid",j);if(typeof _ss_track!="undefined"&&typeof _ss_track.events!="undefined"&&a.id!="f1b1c3ef-7239-49c1-a695-55b29f5003a5"){_ss_track.events.push(["started session",JSON.parse(a.getLSItem("sess_data")),-1])}}_taq.tid=j;a.tid=j;if(window.location.hash.indexOf("#__taq_debug=")==0||a.getLSItem("debug")){_taq.debug=true;a.setLSItem("debug",1)}if(window.location.hash.indexOf("#__ss_notif_view=")==0){(function(){var i=JSON.parse(decodeURIComponent(window.location.hash.split("=")[1]));setTimeout(function(){a.notifications.show(null,null,i)},0)})()}if(window.location.hash.indexOf("#__ss_event_conf=")==0){var k=parseInt(window.location.hash.split("=")[1]);a.setSSItem("event_conf",k);window.location.href=window.location.href.split("#")[0];return}if(typeof a.getSSItem("event_conf")!="undefined"){(function(){var y=document.createElement("script");y.type="text/javascript";y.async=true;y.id="__taevcf";y.src="//"+a.BE_SERVER+"/static/sseventconf.min.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(y,i)})();_ss_track={};_ss_track.DEV=a.DEV;_ss_track.event_conf=a.config.evt;_ss_track.GMG_SERVER=a.BE_SERVER;SecondScreenUtils={};SecondScreenUtils.$=_taq.$;SecondScreen={};SecondScreen._read_sess_data=function(i){return a.getSSItem(i)};SecondScreen._write_sess_data=function(y,i){a.setSSItem(y,i)};return}if(typeof _ss_track!="undefined"&&typeof _ss_track.init!="undefined"){_ss_track.init(a.vid,a.sid,a.tid,v,a.getSSItem,a.setSSItem,a.removeSSItem,a.getLSItem,a.setLSItem,a.removeLSItem,a.convs)}a.get_data_task=function(){a.get_data_xhr=d.ajax({type:"GET",url:"//"+a.EV_SERVER+"/pm/?c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000),async:true,cache:false,success:function(y){var B=y;if(B){for(var A=0;A<B.length;A++){for(var z=0;z<B[A]["a"].length;z++){a.actions.process(B[A]["t"],B[A]["a"][z],B[A]["d"])}}setTimeout(a.get_data_task,100)}else{setTimeout(a.get_data_task,1000)}},error:function(i,z,y){if(z==="abort"){setTimeout(a.get_data_task,100)}else{setTimeout(a.get_data_task,10000)}}})};a.get_data_task();a.onevent={};a.onready=[];var n=a.handlers;a.handlers={};a.handlers.push=function(i){if(i[0]=="event"){a.onevent[i[1]]=i[2]}else{if(i[0]=="ready"){if(a.is_ready){setTimeout(i[1],0)}else{a.onready.push(i[1])}}}};_taq.handlers=a.handlers;for(var p=0;p<n.length;p++){a.handlers.push(n[p])}a.events={push:function(A){if(typeof(_taq._DONT_PUSH_EVENTS_)!="undefined"&&_taq._DONT_PUSH_EVENTS_==true){return}if(typeof a.onevent[A[0]]!="undefined"){A=a.onevent[A[0]](A);if(!A){return}}var z="";if(_taq.debug){z=parseInt(Math.random()*10000);console.log("%c Gamooga %cevent "+z+" %c "+A[0]+" %c "+JSON.stringify(A[1]),"color:#ff3333","color:blue","background:#ff3333;color:white","");z="&rid="+z}var y=new Image(1,1);var C="//"+a.EV_SERVER+"/mev/?c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000);var B=window.btoa(unescape(encodeURIComponent(JSON.stringify(A))));B=B.replace(/\+/g,"-").replace(/\//g,"_");C+="&data="+B+z;y.src=C;if(typeof _ss_track!="undefined"&&typeof _ss_track.events!="undefined"&&(A[0]=="started session"||a.config.dashevs.length==0||a.config.dashevs.indexOf(A[0])!=-1)){_ss_track.events.push(A)}}};var x=_taq.events;_taq.events=a.events;var u=-1;var o=-1;for(var p=0;p<x.length;p++){if(x[p][0]=="started session"){u=p}else{if(x[p][0]=="visited page"){o=p}}}if(u!=-1){_taq.events.push(x[u])}if(o!=-1){_taq.events.push(x[o])}for(var p=0;p<x.length;p++){if(p!=u&&p!=o){_taq.events.push(x[p])}}a.property={push:function(D){var B="";if(_taq.debug){B=parseInt(Math.random()*10000);console.log("%c Gamooga %cvisitor property "+B+" %c "+D[0]+" %c "+JSON.stringify(D[1]),"color:#ff3333","color:blue","background:#ff3333;color:white","");B="&rid="+B}var A=new Image(1,1);var C="//"+a.EV_SERVER+"/vpr/?p="+encodeURIComponent(D[0])+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000);var y=D[1];var z=typeof(y);if(z=="number"){tp="n"}else{if(z=="boolean"){tp="b"}else{if(typeof y=="undefined"||y==""||y==null){tp="u"}else{tp="s"}}}C+="&vl="+encodeURIComponent(y)+"&tp="+tp+B;A.src=C}};var t=[];if(typeof _taq.property!="undefined"){t=_taq.property}_taq.property=a.property;for(var p=0;p<t.length;p++){_taq.property.push(t[p])}a.identify={push:function(y){var z;var i;if(typeof(y)=="string"){z=y;i=null}else{z=y[0];i=y[1]}var A=1;if(!a.getLSItem("dvid")){A=0}d.ajax({type:"GET",url:"//"+a.EV_SERVER+"/id/?c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&p="+A+"&u="+encodeURIComponent(z)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000),async:true,cache:false,success:function(B){if(B.result=="success"){var D=B.vid;a.setLSItem("dvid",a.vid);a.setLSItem("vid",D);var C=_taq.vid;_taq.vid=D;a.vid=D;if(C!=D){a.get_data_xhr.abort()}if(i){setTimeout(i,0)}}},error:function(B,D,C){setTimeout(function(){a.identify.push(z)},10000)}})}};var r=[];if(typeof _taq.identify!="undefined"){r=_taq.identify}_taq.identify=a.identify;for(var p=0;p<r.length;p++){_taq.identify.push(r[p])}var m="(none)";try{m=document.referrer.match(/:\/\/[^\/]+(.+)/)[1]}catch(q){m="(none)"}if(a.id!="7357fe2f-816e-41e4-b5b9-e5a1ab6da323"){if(a.id=="f7ca3cdc-108f-498a-8b89-3097ef91fcd2"||a.id=="7be7d6a8-f0c2-444a-87e9-5010f121ee4e"||a.id=="3502ff1e-371e-4f30-b3b3-b690e5c5710e"||a.id=="fd15aa02-6922-41d1-b46d-250ad8e35d31"||a.id=="fc0f4120-f635-4120-a30f-cdeaaa40593c"||a.id=="4bf13e52-1dac-4651-9ead-774bca37cea2"||a.id=="dee8ce7e-747a-4b21-a97a-40fda1ae2007"){if(a.id=="7be7d6a8-f0c2-444a-87e9-5010f121ee4e"&&a.newsessid){setTimeout(function(){_taq.events.push(["visited page",{title:document.title,url:location.href.replace(/^.*\/\/[^\/]+/,""),from_page:m,domain:location.host}])},1000)}else{setTimeout(function(){_taq.events.push(["visited page",{title:document.title,url:location.href.replace(/^.*\/\/[^\/]+/,""),from_page:m,domain:location.host}])},300)}}else{if(a.id=="5be773f5-7851-4baf-9b97-837b3de59c12"){_taq.events.push(["visited page",{title:document.title,url:location.href.replace(/^.*\/\/[^\/]+/,""),from_page:m,from_mobile:_taq.is_mobile}])}else{_taq.events.push(["visited page",{title:document.title,url:location.href.replace(/^.*\/\/[^\/]+/,""),from_page:m}])}}}a.convs.chat_start_atic=function(A){var y=new Image(1,1);var z="//"+a.EV_SERVER+"/ev/?e="+encodeURIComponent("^chat start - "+A)+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=-&vl=-&tp=s";y.src=z};a.convs.pro_chat_atic=function(A){var y=new Image(1,1);var z="//"+a.EV_SERVER+"/ev/?e="+encodeURIComponent("^proactive chat - "+A)+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=-&vl=-&tp=s";y.src=z};a.convs.agent_alert_atic=function(A){var y=new Image(1,1);var z="//"+a.EV_SERVER+"/ev/?e="+encodeURIComponent("^agent alert - "+A)+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=-&vl=-&tp=s";y.src=z};a.actions={};a.actions.process=function(D,i,A){var F=null;if(i.r=="message_visitor"){var y=i.args["msg"];var z=i.args["name"];var E=i.args["dept"];(function(){var G=z;var I=y;var H=E;var J=D;F=function(){if(typeof _ss_track!="undefined"){_ss_track.api.act_task(["prochat_msg",G,I,H,J])}}})()}else{if(i.r=="alert_agent"){var B=i.args["reason"];var C=i.args["desc"];var E=i.args["dept"];(function(){var G=B;var I=C;var H=E;var J=D;F=function(){if(typeof _ss_track!="undefined"){_ss_track.api.act_task(["agent_alert",G,I,H,J])}}})()}else{if(i.r=="show_notif"){(function(){var I=D;var H=i.args["notif"];var G=i.args["nid"];F=function(J){a.notifications.show(I,G,H,J)}})()}else{if(i.r=="show_visitor"){var E=i.args["dept"];(function(){var G=E;F=function(){if(typeof _ss_track!="undefined"){_ss_track.api.act_task(["show_visitor",G])}}})()}else{if(i.r=="assign_dept"){var E=i.args["dept"];(function(){var G=E;F=function(){if(typeof _ss_track!="undefined"){_ss_track.api.act_task(["assign_dept",G])}}})()}}}}}if(A.r==2){(function(){var H=A.args["opg"]*1000;var G=F;setTimeout(function(){G()},H)})()}else{if(A.r==3){(function(){var G=new Date().getTime();var J=A.args["opgidl"]*1000;var H=F;var I=parseInt(Math.random()*10000);d(document).on("mousedown.__ta_ip_"+I+" keydown.__ta_ip_"+I,function(){G=new Date().getTime()});var K=function(){var L=new Date().getTime();if(L-G>J){d(document).off("mousedown.__ta_ip_"+I+" keydown.__ta_ip_"+I);H()}else{setTimeout(K,J-(L-G))}};K()})()}else{if(A.r==4){(function(){var G=F;var H=parseInt(Math.random()*10000);d("body").on("mouseleave._ta_lit_"+H,function(I){if(I.clientY<50){d("body").off("mouseleave._ta_lit_"+H);G()}})})()}else{if(A.r==5){(function(){var G=new Date().getTime();var K=G;var J=A.args["opgact"]*1000;var H=F;var I=parseInt(Math.random()*10000);d(document).on("mousemove.__ta_ap_"+I+" mousedown.__ta_ap_"+I+" keydown.__ta_ap_"+I,function(){var L=new Date().getTime();if(L-K>5000){G=L}K=L;if(K-G>=J){H();d(document).off("mousemove.__ta_ap_"+I+" mousedown.__ta_ap_"+I+" keydown.__ta_ap_"+I)}})})()}else{F()}}}}};a.notifications={};a.notifications.atic_view=function(z,y){var A=new Image(1,1);var B="//"+a.EV_SERVER+"/ev/?e="+encodeURIComponent("^notif view - "+z)+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=notif&vl="+encodeURIComponent(y)+"&tp=s";A.src=B};a.notifications.atic_click=function(z,y){var A=new Image(1,1);var B="//"+a.EV_SERVER+"/ev/?e="+encodeURIComponent("^notif click - "+z)+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=notif&vl="+encodeURIComponent(y)+"&tp=s";A.src=B};a.notifications.atic_close=function(z,y){var A=new Image(1,1);var B="//"+a.EV_SERVER+"/ev/?e="+encodeURIComponent("^notif close - "+z)+"&c="+encodeURIComponent(a.id)+"&v="+encodeURIComponent(a.vid)+"&s="+encodeURIComponent(a.sid)+"&t="+encodeURIComponent(a.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=notif&vl="+encodeURIComponent(y)+"&tp=s";A.src=B};a.notifications.on_click=function(z,y,i){if(z!==null){a.notifications.atic_click(z,y)}if(i){var A=d(i).attr("href");if(A){setTimeout(function(){window.location.href=A},300)}return false}else{return true}};_taq.fns.__notifclick=a.notifications.on_click;a.notifications.close=function(z,y,i){if(y){a.notifications.atic_close(y,i)}if(z==3){clearInterval(d("#__ta_notif_frame_"+z).data("updateint"))}d("#__ta_notif_frame_"+z).parent().remove();if(z==2){d("#__ta_notif_pad").remove()}};_taq.fns.__notifclose=_taq.fns.__notifclose||a.notifications.close;a.notifications._preload={};a.notifications.show=function(O,L,z,B){if(B){a.notifications._preload[L]="to_load"}else{if(a.notifications._preload[L]=="loaded"){var K=d("#__ta_notif_frame_"+z.nst);if(K&&K.css("visibility")=="hidden"){var T=K.height();if(z.nst==2&&z.pos=="1"){d("#__ta_notif_pad").height(T+2)}K.css("visibility","visible");if(z.nst==1){d(".gmg_notif_overlay").css("display","block")}a.notifications.atic_view(O,L)}else{console.log("ERROR: Preloaded notif not in DOM or is already visible.")}delete a.notifications._preload[L];return}else{if(a.notifications._preload[L]=="to_load"){a.notifications._preload[L]="should_show";return}}}if(z.nst==3){if(z.w!=""){d(z.jqid).css("width",z.w+"px")}if(z.h!=""){d(z.jqid).css("height",z.h+"px")}d(z.jqid).html(z.ctext);_taq.$(document).trigger(_taq.$.Event("gmg_inpage_render"));a.notifications.atic_view(O,L);(function(){d(z.jqid).click(function(){var Z=O;var Y=L;a.notifications.atic_click(Z,Y)})})()}else{if(z.nact==1){if(O){if(a.getSSItem("__ss_support")){return}if(typeof _ss_track!="undefined"&&typeof _ss_track.api!="undefined"){if(_ss_track.api.agent_present===false){return}if(_ss_track.api.agent_present===null){(function(){var aa=O;var Y=L;var Z=z;_ss_track.handlers.push(["connect",function(){a.notifications.show(aa,Y,Z,B)}])})();return}}}if(z.hpcs==true){z.lnk="javascript:parent._ss_track.api.live_chat_click(null,null,true);"}else{z.lnk="javascript:parent._ss_track.api.live_chat_click();"}}if(O!==null&&!B){a.notifications.atic_view(O,L)}var E=["","arial, helvetica, sans-serif",'"times new roman", serif','"arial black", sans-serif','"arial narrow", sans-serif','"courier new", monospace',"garamond, serif","georgia, serif","tahoma, sans-serif",'"trebuchet ms", sans-serif',"verdana, sans-serif"];var D=z.lnk;if(D!=""){if(D.substr(0,4)!="http"&&D.substr(0,11)!="javascript:"){D="http://"+D}}var C="<!DOCTYPE html><html><head><base target='_top'><style type='text/css'>* {padding:0;margin:0;} a {text-decoration:none;} ul,ol {margin-left:30px;padding-left:10px;} .gmgbutton {padding:5px 10px;display:inline;background:#777 url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAABkCAYAAABHLFpgAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAALdJREFUeNrEjkEWwiAQQyGlwOAN3Hv/m3UnA62vONF2p25lkfeTwAx+CuEWYgguxBgdYoo7YkwDOWeKDEjOO6TQStlRXlkRIylGl3JQYSaFJGxJIq9M2No9OYbuSOncYXuHWZN5Nglhcm6M4eDsfJDrt+Jv8vO7hyzL4rFtD8rmsPbu0bcOtEZq6tG0eVSKqlqhldao1grL2NY728qMhdozfbfqz3sc1dpBnYvMeqyrbet99U8BBgCRTXT4kGguQQAAAABJRU5ErkJggg==) repeat-x bottom;border: none;color:#fff;cursor:pointer;font-weight:bold;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px;} .gmgbutton:hover {background-position:0 center;} .gmgbutton:active {position: relative;top: 1px;}</style></head><body style='background-color:transparent;overflow:hidden;'>";var G=d("<div/>");if(z.io){G.append("<div class='close' style='color:#fff;cursor:pointer;font-size:13px;position:absolute;right:0;background:#000;border-bottom-left-radius:5px;padding:1px 3px' onclick='parent._taq.fns.__notifclose("+z.nst+',"'+O+'","'+L+"\")'>&#x2715;</div>")}else{G.append("<div class='close' style='color:"+z.tc+";cursor:pointer;font-size:13px;float:right;padding:1px 3px' onclick='parent._taq.fns.__notifclose("+z.nst+',"'+O+'","'+L+"\")'>&#x2715;</div>")}if(z.nst!=2&&!z.io&&z.ttl!=""){G.append("<div class='title' style='color:"+z.tc+";font-size:"+(z.ts||20)+"px;font-family:"+E[(z.tf||1)]+";padding:5px 10px;'>"+z.ttl+"</div>")}if(z.io){G.append("<div class='content' style='padding:0;'><img src='"+z.cimgurl+"' style='height:"+z.cimgh+"px;width:"+z.cimgw+'px;display:block\' onerror=\'this.src="/static/images/notif_image_error.png";this.onerror="";\'></div>')}else{var J=z.ctext;J=J.replace(/<script /g,"<dontremovescript ");J=J.replace(/<\/script>/g,"</dontremovescript>");G.append("<div class='content' style='color:"+z.cc+";font-size:"+(z.cs||13)+"px;font-family:"+E[(z.cf||1)]+";padding:5px 10px;'>"+J+"</div>")}if(z.cta!=""&&!z.io){if(D==""){D="javascript:void(0)"}var N="'background-color:"+z.ctabc+";color:"+z.ctatc+";font-size:"+z.ctas+"px;font-family:"+E[z.ctaf]+";padding:5px 10px;margin:10px;display:inline-block;'";var U="";if(D.substr(0,11)=="javascript:"){var U="";G.append("<div class='cta'><a "+(z.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+z.nst+',"'+O+'","'+L+"\")},150)' ":"")+(O!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+O+'","'+L+"\")' ":"")+"style="+N+" class='gmgbutton' href='"+D+"'>"+z.cta+"</a></div>")}else{var W=z.ltrg;if(W=="1"){G.append("<div class='cta'><a "+(z.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+z.nst+',"'+O+'","'+L+"\")},150)' ":"")+(O!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+O+'","'+L+"\",this)' ":"")+"style="+N+" class='gmgbutton' href='"+D+"' target='_top'>"+z.cta+"</a></div>")}else{G.append("<div class='cta'><a "+(z.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+z.nst+',"'+O+'","'+L+"\")},150)' ":"")+(O!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+O+'","'+L+"\")' ":"")+"style="+N+" class='gmgbutton' href='"+D+"' target='_blank'>"+z.cta+"</a></div>")}}}if(!z.io){if(z.nst!=2){if(z.ctaa==2){G.find("div.cta").css("text-align","center")}else{if(z.ctaa==3){G.find("div.cta").css("text-align","right")}else{if(z.ctaa>=4){G.find("div.cta").detach().insertBefore(G.find("div.content"));if(z.ctaa==4){G.find("div.cta").css({"float":"left",margin:"8px 3px 0 0"})}else{if(z.ctaa==5){G.find("div.cta").css({"float":"right",margin:"8px 0 0 3px"})}else{if(z.ctaa==6){G.find("div.cta").css("text-align","center")}}}}}}}else{G.find("div.cta").css("display","inline-block")}}if(z.cta==""||z.io){if(D!=""){if(D.substr(0,11)=="javascript:"){G.wrapInner("<a "+(z.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+z.nst+',"'+O+'","'+L+"\")},150)' ":"")+(O!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+O+'","'+L+"\")' ":"")+"href='"+D+"'></a>")}else{var W=z.ltrg;if(W=="1"){G.wrapInner("<a "+(z.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+z.nst+',"'+O+'","'+L+"\")},150)' ":"")+(O!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+O+'","'+L+"\",this)' ":"")+"href='"+D+"' target='_top'></a>")}else{G.wrapInner("<a "+(z.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+z.nst+',"'+O+'","'+L+"\")},150)' ":"")+(O!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+O+'","'+L+"\")' ":"")+"href='"+D+"' target='_blank'></a>")}}}else{G.wrapInner("<div "+(z.ctac?"onmouseup='javascript:setTimeout(function() { parent._taq.fns.__notifclose("+z.nst+',"'+O+'","'+L+"\")},150)' ":"")+(O!==null?"onclick='javascript:return parent._taq.fns.__notifclick(\""+O+'","'+L+"\")' ":"")+"></a>")}}if(z.nst==1||z.nst==3){G.find("div.close").css({"font-size":"15px"})}else{if(z.nst==2){G.find("div.close").css({padding:"2px 10px","font-size":"15px",color:z.cc});G.find("a.gmgbutton").css({display:"inline-block"});G.find("div.content").css({display:"inline-block"});G.find("div.title").css({display:"inline-block"});G.find("div.cta").css({display:"inline-block"});G.wrapInner("<div class='centerwrap' style='text-align:center'></div>")}}if(d("#__ta_notif_frame_"+z.nst).length!=0){if(z.nst==3){clearInterval(d("#__ta_notif_frame_"+z.nst).data("updateint"))}d("#__ta_notif_frame_"+z.nst).parent().remove();if(z.nst==2){d("#__ta_notif_pad").remove()}}var F="<div style='position:absolute;top:0;left:0'><iframe style='position:fixed;display:block;bottom:-3px;text-align:left;z-index:9999999999;border:0;background-color:#fff;overflow:hidden;border:1px solid #666;height:0;box-sizing:content-box' marginheight='0' marginwidth='0' frameborder='0' id='__ta_notif_frame_"+z.nst+"'></iframe>";var M=d(window).width();if(z.cimgw>=M){z.cimgw=(M*90)/100;G.find("div.close").css({position:"fixed",right:"0px"})}else{if(z.w>=M){z.w=(M*90)/100;G.find("div.close").css({position:"fixed",right:"0px"})}}d("body").append(F);var K=d("#__ta_notif_frame_"+z.nst);K.css("border-color",z.bc);K.css("background-color",z.bgc);if(typeof z.nst=="undefined"||z.nst==0){if(z.io){K.css("width",z.cimgw+"px")}else{K.css("width",z.w+"px")}if(typeof z.br=="undefined"||z.br==true){K.css({"-webkit-border-radius":"5px","-moz-border-radius":"5px","border-radius":"5px"})}if(typeof z.bs=="undefined"||z.bs==true){K.css({"box-shadow":"0 0 5px #999"})}if(z.pos=="1"){K.css("left","10px");K.css("right","auto")}else{if(z.pos=="2"){K.css("right","10px");K.css("left","auto")}}}else{if(z.nst==1){if(z.io){K.css("width",z.cimgw+"px")}else{K.css("width",z.w+"px")}K.css("border-width","1px");if(typeof z.br=="undefined"||z.br==true){K.css({"-webkit-border-radius":"5px","-moz-border-radius":"5px","border-radius":"5px"})}if(typeof z.bs=="undefined"||z.bs==true){K.css({"box-shadow":"0 0 5px #999"})}K.parent().prepend('<div style="position:fixed;top:0;right:0;height:100%;width:100%;background:#000;opacity:0.8;z-index:9999999998" class="gmg_notif_overlay">&nbsp;</div>');K.css({bottom:"auto",top:"50%",left:"50%",right:"auto","margin-top":"-100px"});if(!z.io){K.css({"margin-left":"-"+(z.w/2)+"px"})}else{K.css({"margin-left":"-"+(z.cimgw/2)+"px"})}}else{if(z.nst==2){K.css("width","100%");G.find(".gmgbutton").css("margin","4px");K.css({"border-left":"0","border-right":"0"});if(z.pos=="1"){K.css({bottom:"auto","border-bottom-width":"2px","border-top":"0",position:"fixed",top:"0"});d("body").prepend("<div id='__ta_notif_pad' style='position:static;height:0px;'></div>")}else{if(z.pos=="2"){K.css({"border-top-width":"2px","border-bottom":"0",position:"fixed",bottom:"0"})}}}else{if(z.nst==3){if(z.io){K.css("width",z.cimgw+"px")}else{K.css("width",z.w+"px")}K.css("border-width","1px");if(typeof z.br=="undefined"||z.br==true){K.css({"-webkit-border-radius":"5px","-moz-border-radius":"5px","border-radius":"5px"})}if(typeof z.bs=="undefined"||z.bs==true){K.css({"box-shadow":"0 0 5px #999"})}K.css({bottom:"auto"});var i=10;var H=10;var A=d(z.coe);if(A.length==0){if(console&&console.log){console.log("Element not found: "+z.coe)}return}var S=A.offset();var y,I,R,Q;if(z.cop==1){y=S.left+A.outerWidth()/2+(z.col-0);I=S.top-10-H+(z.cot-0);if(z.io){R=y-z.cimgw/2}else{R=y-z.w/2}Q=I;K.css({position:"absolute",top:Q+"px",left:R+"px"});K.after('<div style="position:absolute;left:'+(y-i/2)+"px;top:"+(I-1)+"px;border-top:"+H+"px solid "+z.bgc+";border-left:"+(i/2)+"px solid transparent;border-right:"+(i/2)+'px solid transparent;height:0;width:0;z-index:99999999999;">&nbsp;</div>');var V=2;var X=1;K.after('<div style="position:absolute;left:'+(y-(i/2)-X)+"px;top:"+(I-1)+"px;border-top:"+(H+V)+"px solid "+z.bc+";border-left:"+(i/2+X)+"px solid transparent;border-right:"+(i/2+X)+'px solid transparent;height:0;width:0;z-index:99999999999;"></div>')}else{if(z.cop==2){y=S.left-i-10+(z.col-0);I=S.top+A.outerHeight()/2+(z.cot-0);if(z.io){R=y-2-z.cimgw}else{R=y-2-z.w}Q=I;K.css({position:"absolute",top:Q+"px",left:R+"px"});K.after('<div style="position:absolute;left:'+(y-1)+"px;top:"+(I-H/2)+"px;border-left:"+i+"px solid "+z.bgc+";border-bottom:"+(H/2)+"px solid transparent;border-top:"+(H/2)+'px solid transparent;height:0;width:0;z-index:99999999999;">&nbsp;</div>');var X=2;var V=1;K.after('<div style="position:absolute;left:'+(y-1)+"px;top:"+(I-H/2-V)+"px;border-left:"+(i-0+X)+"px solid "+z.bc+";border-bottom:"+(H/2+V)+"px solid transparent;border-top:"+(H/2+V)+'px solid transparent;height:0;width:0;z-index:99999999999;"></div>')}else{if(z.cop==3){y=S.left+A.outerWidth()+10+(z.col-0);I=S.top+A.outerHeight()/2+(z.cot-0);R=y+i;Q=I;K.css({position:"absolute",top:Q+"px",left:R+"px"});K.after('<div id="__ta_notif_arr1" style="position:absolute;left:'+(y+1)+"px;top:"+(I-H/2)+"px;border-right:"+i+"px solid "+z.bgc+";border-bottom:"+(H/2)+"px solid transparent;border-top:"+(H/2)+'px solid transparent;height:0;width:0;z-index:99999999999;">&nbsp;</div>');var X=2;var V=1;K.after('<div id="__ta_notif_arr2" style="position:absolute;left:'+(y+1-X)+"px;top:"+(I-H/2-V)+"px;border-right:"+(i-0+X)+"px solid "+z.bc+";border-bottom:"+(H/2+V)+"px solid transparent;border-top:"+(H/2+V)+'px solid transparent;height:0;width:0;z-index:99999999999;"></div>');K.on("updatepos",function(){A=d(z.coe);if(A.length==0){return}S=A.offset();y=S.left+A.outerWidth()+10+(z.col-0);I=S.top+A.outerHeight()/2+(z.cot-0);R=y+i;Q=I;Q=I;K.css({position:"absolute",top:Q+"px",left:R+"px"});d("#__ta_notif_arr1").css({left:(y+1)+"px",top:(I-H/2)+"px"});d("#__ta_notif_arr2").css({left:(y+1-X)+"px",top:(I-H/2-V)+"px"})})}else{if(z.cop==4){y=S.left+A.outerWidth()/2+(z.col-0);I=S.top+A.outerHeight()+10+(z.cot-0);if(z.io){R=y-z.cimgw/2}else{R=y-z.w/2}Q=I+H;K.css({position:"absolute",top:Q+"px",left:R+"px"});K.after('<div style="position:absolute;left:'+(y-i/2)+"px;top:"+(I+1)+"px;border-bottom:"+H+"px solid "+z.bgc+";border-left:"+(i/2)+"px solid transparent;border-right:"+(i/2)+'px solid transparent;height:0;width:0;z-index:99999999999;">&nbsp;</div>');var V=2;var X=1;K.after('<div style="position:absolute;left:'+(y-(i/2)-X)+"px;top:"+(I+1-V)+"px;border-bottom:"+(H+V)+"px solid "+z.bc+";border-left:"+(i/2+X)+"px solid transparent;border-right:"+(i/2+X)+'px solid transparent;height:0;width:0;z-index:99999999999;"></div>')}}}}}}}}K.data("srchtml",C+G.html().replace(/<dontremovescript /g,"<script ").replace(/<\/dontremovescript>/g,"<\/script>")+"</body></html>");var P=function(){for(var aa=0;aa<K.contents().find("img").length;aa++){if(!K.contents().find("img")[aa].complete){setTimeout(P,250);return}}var Z=K.contents().find("body").height();var Y=d(window).height();if(Z>=Y){Z=(Y*90)/100;K.contents().find("body").css("overflow","scroll")}K.height(Z);if(z.nst==1){K.css("margin-top","-"+(Z/2)+"px")}else{if(z.nst==3){if(z.cop==1){K.css("margin-top","-"+(Z+2)+"px")}else{if(z.cop==2||z.cop==3){K.css("margin-top","-"+(Z/2)+"px")}else{if(z.cop==4){K.css("margin-top","0")}}}K.data("updateint",setInterval(function(){K.trigger("updatepos")},250))}}if(!B||a.notifications._preload[L]=="should_show"){if(z.nst==2&&z.pos=="1"){d("#__ta_notif_pad").height(Z+2)}K.css("visibility","visible");if(z.nst==1){d(".gmg_notif_overlay").css("display","block")}delete a.notifications._preload[L]}else{if(B){a.notifications._preload[L]="loaded"}}};K.css("visibility","hidden");if(d(".gmg_notif_overlay").length>0){d(".gmg_notif_overlay").css("display","none")}K.load(P);K.get(0).src='javascript:parent._taq.$("#__ta_notif_frame_'+z.nst+'").data("srchtml")'}};_taq.fns.__notifshow=a.notifications.show;for(var p=0;p<a.onready.length;p++){setTimeout(a.onready[p],0)}a.onready=[];a.is_ready=true})})})})();var _taq=_taq||{};_taq.init(function(m){var b=604800000;function d(){var p,q=navigator.userAgent,s=q.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],r=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return/trident/i.test(s[1])?(p=/\brv[ :]+(\d+)/g.exec(q)||[],{name:"IE",version:p[1]||""}):"Chrome"===s[1]&&(p=q.match(/\bOPR\/(\d+)/),null!=p)?{name:"Opera",version:p[1]}:(s=s[2]?[s[1],s[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(p=q.match(/version\/(\d+)/i))&&s.splice(1,1,p[1]),r&&(s[0]="iOS"),s[0]=s[0].toLowerCase(),{name:s[0],version:s[1]})}function a(q,t){var s=0,r=50,p=!1,u=window.setInterval(function(){q()&&(window.clearInterval(u),t(p)),s++>r&&(window.clearInterval(u),p=!0,t(p))},10)}function h(q){var r=q.toLowerCase();if(0===r.indexOf("msie")&&0===r.indexOf("trident")){return !1}var p=/(?:msie|rv:)\s?([\d\.]+)/.exec(r);return p&&parseInt(p[1],10)>=10?!0:!1}function c(s){var q;if(window.webkitRequestFileSystem){window.webkitRequestFileSystem(window.TEMPORARY,1,function(){q=!1},function(t){q=!0})}else{if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var p;try{p=window.indexedDB.open("___test")}catch(r){q=!0}"undefined"==typeof q&&a(function(){return"done"===p.readyState?!0:!1},function(t){t||(q=p.result?!1:!0)})}else{if(h(window.navigator.userAgent)){q=!1;try{window.indexedDB||(q=!0)}catch(r){q=!0}}else{if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("___test",1)}catch(r){q=!0}"undefined"==typeof q&&(q=!1,window.localStorage.removeItem("___test"))}}}}a(function(){return"undefined"!=typeof q?!0:!1},function(t){s(q)})}function o(){return(location.hostname.search("pushmessage.co")!=-1)||(m.DEV&&location.pathname.search("/webpush-register")==0)}function k(){if(o()){setTimeout(window.close,500)}}function f(q){var p=new Image(1,1);var r="//"+m.EV_SERVER+"/ev/?e="+encodeURIComponent(q)+"&c="+encodeURIComponent(m.id)+"&v="+encodeURIComponent(m.vid)+"&s="+encodeURIComponent(m.sid)+"&t="+encodeURIComponent(m.tid)+"&z="+(new Date().getTime())+""+parseInt(Math.random()*10000)+"&ky=-&vl=-&tp=s";p.src=r}function j(q){if(q.endpoint.indexOf("https://android.googleapis.com/gcm/send")!==0){return q.endpoint}var p=q.endpoint;if(q.subscriptionId&&q.endpoint.indexOf(q.subscriptionId)===-1){p=q.endpoint+"/"+q.subscriptionId}return p}function n(s){if(s.endpoint.indexOf("push.services.mozilla.com")!=-1){var u=s.endpoint;var r=s.getKey("p256dh");var t=btoa(String.fromCharCode.apply(null,new Uint8Array(r)));var q=u+"$"+t;if(_taq.property){_taq.property.push(["_push_regid","4:"+q])}}else{var p=j(s);var v=p.split("/");var q=v[v.length-1];if(_taq.property){_taq.property.push(["_push_regid","3:"+q])}}f("^webpush allow");_taq.setLSItem("webpush_status","registered");k()}function g(){navigator.serviceWorker.ready.then(function(p){f("^webpush show");Notification.requestPermission(function(){if(Notification.permission=="granted"){p.pushManager.subscribe({userVisibleOnly:true}).then(function(q){return n(q)},function(q){console.log(q);f("^webpush block");_taq.setLSItem("webpush_status","denied");k()});if(o()){setTimeout(function(){f("^webpush timeout");_taq.setLSItem("webpush_status","timeout");_taq.setLSItem("webpush_ask_again",(new Date().getTime()+b)+"");k()},4000)}}else{if(Notification.permission=="denied"){f("^webpush block");_taq.setLSItem("webpush_status","denied");k()}else{if(Notification.permission=="default"){f("^webpush close");k()}}}})})}function i(){if(!("showNotification" in ServiceWorkerRegistration.prototype)){return}if(Notification.permission==="denied"){return}if(!("PushManager" in window)){return}navigator.serviceWorker.ready.then(function(p){p.pushManager.getSubscription().then(function(q){if(!q){g();return}else{if(_taq.id=="92ca38ca-4ccb-4804-b2a9-a839c170b430"){p.update()}}n(q)},function(q){console.log(q);k()})})}_taq.do_webpush_registration=function(p){var r="/manifest.json";var q="/sw.js?cid="+_taq.id;if(p){r="/webpush-manifest-"+_taq.id+".json";q="/webpush-sw.js?cid="+_taq.id}if(_taq.$('link[rel="manifest"]').length==0){_taq.$("head").append('<link rel="manifest" href="'+r+'">')}if("serviceWorker" in navigator){navigator.serviceWorker.register(q).then(i)}else{console.log("Service workers aren't supported in this browser.")}};_taq.do_webpush_reg_without_sw=function(p){var q="/manifest.json";if(p){q="/webpush-manifest-"+_taq.id+".json"}if(_taq.$('link[rel="manifest"]').length==0){_taq.$("head").append('<link rel="manifest" href="'+q+'">')}if("serviceWorker" in navigator){i()}else{console.log("Service workers aren't supported in this browser.")}};_taq.has_webpush_registration=function(){return !!_taq.getLSItem("webpush_status")};_taq.do_popup_webpush_registration=function(){var q=m.config.pst;var r=_taq.getLSItem("webpush_status");var t=_taq.getLSItem("webpush_ask_again");if(r=="denied"||r=="registered"||((r=="timeout"||r=="premature_close"||r=="default"||r=="popup_denied")&&t>(new Date().getTime())+"")){console.log("GAMOOGA: Cannot start registration, current status: "+r+", timeout: "+new Date(t-0));return}else{if(!q||!q.nm||!q.img||!((q.st==2)||(q.st==0&&q.msg)||(q.st==1&&q.bcfg))){console.log("GAMOOGA: Incomplete webpush settings, cannot start registration.");return}}var s="chrome" in window&&"serviceWorker" in navigator&&d().version>=42;var p=/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&"serviceWorker" in navigator&&d().version>=44;if(!s&&!p){console.log("GAMOOGA: Unsupported browser/version, cannot start registration.");return}if((!("showNotification" in ServiceWorkerRegistration.prototype))||Notification.permission==="denied"||(!("PushManager" in window))||(!("serviceWorker" in navigator))){console.log("GAMOOGA: Incompatible browser.");return}c(function(D){var x=_taq.$;if(!D){if(q.st==2){var u;if(m.DEV){u="/webpush-notif-perm-"+_taq.id}else{u="https://"+q.nm+".pushmessage.co/webpush-notif-perm-"+_taq.id}function C(J){var G=J.origin||J.originalEvent.origin;if(m.DEV||G.indexOf("pushmessage.co")!=-1){if(window.removeEventListener){window.removeEventListener("message",C,false)}else{if(window.detachEvent){window.detachEvent("onmessage",C)}}var F=JSON.parse(J.data)["status"];if(F=="default"){_taq.setLSItem("webpush_status","default");_taq.setLSItem("webpush_ask_again",(new Date().getTime()+b)+"")}else{if(F=="denied"){_taq.setLSItem("webpush_status","denied");f("^webpush onestep block")}else{f("^webpush onestep allow");var K;if(m.DEV){K="/webpush-register-"+_taq.id}else{K="https://"+q.nm+".pushmessage.co/webpush-register-"+_taq.id}var I=x(window).width();var H=422;if(I>=320&&I<=380){H=280}else{if(I>=381&&I<=480){H=320}}var E;if(_taq.id=="093ba2ea-bc0f-4b85-a9e2-f294cf2338a0"||_taq.id=="96148074-8fb3-4e8c-94a0-13f2012c5623"||_taq.id=="107a3b41-1aa3-45c6-a324-f0399a2aa2af"||_taq.id=="2b06bddd-3a87-4378-b812-3a92862f8eab"){E="<div id=\"__gamooga_webpush_thanks\" onclick=\"_taq.$('#__gamooga_webpush_thanks').remove();_taq.setLSItem('webpush_status','premature_close');_taq.setLSItem('webpush_ask_again','"+(new Date().getTime()+b)+"');window.open('"+K+"','_blank','top=10,left=10,height=100,width=100');\" style=\"background-color:#F0EFF0; box-shadow:0 0 4px #888; font-size:11px; font-weight:400; left:calc(50% - "+(H/2)+"px); margin:0; padding:0; position:fixed; top:50px; width:"+H+'px; z-index:2147483647" bgcolor="#F0EFF0" width="'+H+'">'+q.raw_html_onestep.replace("__FE_SERVER__",m.FE_SERVER)+"</div>"}else{E="<div id=\"__gamooga_webpush_thanks\" onclick=\"_taq.$('#__gamooga_webpush_thanks').remove();_taq.setLSItem('webpush_status','premature_close');_taq.setLSItem('webpush_ask_again','"+(new Date().getTime()+b)+"');window.open('"+K+"','_blank');\" style=\"background-color:#F0EFF0; box-shadow:0 0 4px #888; font-size:11px; font-weight:400; left:calc(50% - "+(H/2)+"px); margin:0; padding:0; position:fixed; top:50px; width:"+H+'px; z-index:2147483647" bgcolor="#F0EFF0" width="'+H+'">'+q.raw_html_onestep.replace("__FE_SERVER__",m.FE_SERVER)+"</div>"}x("body").append(E);x("#__gamooga_webpush_thanks").click(function(){f("^webpush onestep ok")})}}}}if(window.addEventListener){window.addEventListener("message",C,false)}else{if(window.attachEvent){window.attachEvent("onmessage",C)}}var v='<iframe style="width:0px;height:0px;position:absolute;left:-999px;top:-999px" src="'+u+'">';x("body").append(v);f("^webpush onestep show")}else{if(q.st==0){if(x("#__gamooga_webpush_ask").length==0){var w=x(window).width();var B=422;if(w>=320&&w<=380){B=280}else{if(w>=381&&w<=480){B=320}}var z='<div id="__gamooga_webpush_ask" style="background-color:#F0EFF0; box-shadow:0 0 4px #888; font-size:11px; font-weight:400; left:calc(50% - '+(B/2)+"px); margin:0; padding:0; position:fixed; top:0; width:"+B+'px; z-index:2147483647" bgcolor="#F0EFF0" width="'+B+'"><div style="margin:0; padding:0 20px 10px 20px"><div style="display:inline-block; float:left; margin:15px 15px 0 0; padding:0; position:relative"><img src="'+(q.img)+'" style="max-height:65px; max-width:65px"></div><div style="color:#000; display:inline-block; line-height:1.4em; margin:0; padding:10px 0 0 0; position:relative; text-align:left; width:calc(100% - 80px)" align="left" width="calc(100% - 80px)"><span style="color:#000; font-family:\'Open Sans\', sans-serif; font-size:14px; font-weight:700; line-height:1.4em; margin-bottom:5px; text-align:left" align="left">'+(q.msg)+'</span><p style="font-family:\'Open Sans\', sans-serif; font-size:12px; line-height:1.4em; margin:10px 0; padding:0; text-align:left" align="left">You can turn off notifications anytime from browser settings.</p></div><div style="clear: both;"><div style="float:right; margin:0; padding:0"><button style="background:linear-gradient(to bottom, #64b4f4, #0084f6); border:1px solid #42a2f2; border-radius:4px; box-shadow:none; box-sizing:border-box; color:#fff; cursor:pointer; display:inline-block; font-family:Arial; font-size:14px; font-weight:normal; height:26px; line-height:1.1em; margin:0; margin-right:20px; padding:5px; text-shadow:none; text-transform:none; width:90px" height="26" width="90" id="__gamooga_webpush_allow">Allow</button><button style="background:#FFF; border:1px solid #42a2f2; border-color:#CCC; border-radius:4px; box-shadow:none; box-sizing:border-box; color:#000; cursor:pointer; display:inline-block; font-family:Arial; font-size:14px; font-weight:normal; height:26px; line-height:1.1em; margin:0; padding:5px; text-shadow:none; text-transform:none; width:100px" height="26" width="100" id="__gamooga_webpush_notnow">Block</button></div><div style="clear:both"></div></div></div></div>';x("body").append(z)}}else{if(q.st==1){if(x("#__gamooga_webpush_bell").length==0){var y="bottom:100px;right:100px;";if(q.bcfg["pos"]=="1"){y="top:"+q.bcfg["ofy"]+"px;left:"+q.bcfg["ofx"]+"px;"}else{if(q.bcfg["pos"]=="2"){y="top:"+q.bcfg["ofy"]+"px;right:"+q.bcfg["ofx"]+"px;"}else{if(q.bcfg["pos"]=="3"){y="bottom:"+q.bcfg["ofy"]+"px;left:"+q.bcfg["ofx"]+"px;"}else{if(q.bcfg["pos"]=="4"){y="bottom:"+q.bcfg["ofy"]+"px;right:"+q.bcfg["ofx"]+"px;"}}}}var A='<div id="__gamooga_webpush_bell" style="cursor:pointer;background:'+q.bcfg["bg"]+";border-radius: 50%;box-shadow: 0 0 4px #c4c4c4;color: #000;display: block;height: 59px;padding: 5px;position: fixed;"+y+'text-align: center;vertical-align: middle;width: 59px;z-index: 99999;"><style>@-moz-keyframes ring {0% {-moz-transform: rotate(0);}1% {-moz-transform: rotate(30deg);}3% {-moz-transform: rotate(-28deg);}5% {-moz-transform: rotate(34deg);}7% {-moz-transform: rotate(-32deg);}9% {-moz-transform: rotate(30deg);}11% {-moz-transform: rotate(-28deg);}13% {-moz-transform: rotate(26deg);}15% {-moz-transform: rotate(-24deg);}17% {-moz-transform: rotate(22deg);}19% {-moz-transform: rotate(-20deg);}21% {-moz-transform: rotate(18deg);}23% {-moz-transform: rotate(-16deg);}25% {-moz-transform: rotate(14deg);}27% {-moz-transform: rotate(-12deg);}29% {-moz-transform: rotate(10deg);}31% {-moz-transform: rotate(-8deg);}33% {-moz-transform: rotate(6deg);}35% {-moz-transform: rotate(-4deg);}37% {-moz-transform: rotate(2deg);}39% {-moz-transform: rotate(-1deg);}41% {-moz-transform: rotate(1deg);}43% {-moz-transform: rotate(0);}100% {-moz-transform: rotate(0);}}@keyframes ring {0% {transform: rotate(0);}1% {transform: rotate(30deg);}3% {transform: rotate(-28deg);}5% {transform: rotate(34deg);}7% {transform: rotate(-32deg);}9% {transform: rotate(30deg);}11% {transform: rotate(-28deg);}13% {transform: rotate(26deg);}15% {transform: rotate(-24deg);}17% {transform: rotate(22deg);}19% {transform: rotate(-20deg);}21% {transform: rotate(18deg);}23% {transform: rotate(-16deg);}25% {transform: rotate(14deg);}27% {transform: rotate(-12deg);}29% {transform: rotate(10deg);}31% {transform: rotate(-8deg);}33% {transform: rotate(6deg);}35% {transform: rotate(-4deg);}37% {transform: rotate(2deg);}39% {transform: rotate(-1deg);}41% {transform: rotate(1deg);}43% {transform: rotate(0);}100% {transform: rotate(0);}}</style><img src="//'+m.FE_SERVER+'/static/images/webpush_bell.png" style="z-index: 9999999;opacity: 1;-webkit-animation: ring 8s 1s ease-in-out infinite;-webkit-transform-origin: 50% 2px;-moz-animation: ring 8s 1s ease-in-out infinite;-moz-transform-origin: 50% 2px;animation: ring 8s 1s ease-in-out infinite;transform-origin: 50% 2px;margin-top: 10px;" alt="bell"></div>';x("body").append(A)}}}f("^webpush notif show");if(_taq.id=="f7ca3cdc-108f-498a-8b89-3097ef91fcd2"){x("#__gamooga_webpush_notnow").text("No");x("#__gamooga_webpush_allow").text("Yes")}x("#__gamooga_webpush_notnow").click(function(){x("#__gamooga_webpush_ask").remove();_taq.setLSItem("webpush_status","popup_denied");_taq.setLSItem("webpush_ask_again",(new Date().getTime()+b)+"");f("^webpush notif block")});x("#__gamooga_webpush_allow,#__gamooga_webpush_bell").click(function(){x("#__gamooga_webpush_ask").remove();x("#__gamooga_webpush_bell").remove();_taq.setLSItem("webpush_status","premature_close");_taq.setLSItem("webpush_ask_again",(new Date().getTime()+b)+"");f("^webpush notif allow");var H=600;var J=600;var G=window.screenLeft!=undefined?window.screenLeft:screen.left;var I=window.screenTop!=undefined?window.screenTop:screen.top;var F=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;var E=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;G=((F/2)-(H/2))+G;I=((E/2)-(J/2))+I;if(m.DEV){window.open("/webpush-register-"+_taq.id,"_blank");f("^webpush open")}else{window.open("https://"+q.nm+".pushmessage.co/webpush-register-"+_taq.id,"_blank");f("^webpush open")}})}}else{console.log("GAMOOGA: Incognito window, cannot start registration.")}})};_taq.handlers.push(["ready",function(){if(m.config.pst&&m.config.pst["bcfg"]&&m.config.pst["bcfg"]["sd"]){_taq.do_popup_webpush_registration()}}])});